"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{16524:function(t,e,r){r.d(e,{Co:function(){return ip}}),t=r.hmd(t);var n,i,a,o,s,l,c,u=Object.create,h=Object.defineProperty,f=Object.getOwnPropertyDescriptor,g=Object.getOwnPropertyNames,d=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty,y=(t,e,r)=>e in t?h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,w=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),b=(t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of g(e))p.call(t,i)||i===r||h(t,i,{get:()=>e[i],enumerable:!(n=f(e,i))||n.enumerable});return t},m=(t,e,r)=>(r=null!=t?u(d(t)):{},b(!e&&t&&t.__esModule?r:h(r,"default",{value:t,enumerable:!0}),t)),v=(t,e,r)=>(y(t,"symbol"!=typeof e?e+"":e,r),r),_=w(t=>{x(),t.byteLength=function(t){var e=s(t),r=e[0],n=e[1];return(r+n)*3/4-n},t.toByteArray=function(t){var e,r,n=s(t),o=n[0],l=n[1],c=new a((o+l)*3/4-l),u=0,h=l>0?o-4:o;for(r=0;r<h;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],c[u++]=e>>16&255,c[u++]=e>>8&255,c[u++]=255&e;return 2===l&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,c[u++]=255&e),1===l&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,c[u++]=e>>8&255,c[u++]=255&e),c},t.fromByteArray=function(t){for(var e,r=t.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(function(t,e,r){for(var i,a=[],o=e;o<r;o+=3)a.push(n[(i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]))>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}(t,o,o+16383>s?s:o+16383));return 1===i?a.push(n[(e=t[r-1])>>2]+n[e<<4&63]+"=="):2===i&&a.push(n[(e=(t[r-2]<<8)+t[r-1])>>10]+n[e>>4&63]+n[e<<2&63]+"="),a.join("")};var e,r,n=[],i=[],a="u">typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(e=0,r=o.length;e<r;++e)n[e]=o[e],i[o.charCodeAt(e)]=e;function s(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63}),E=w(t=>{x(),t.read=function(t,e,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=r?i-1:0,f=r?-1:1,g=t[e+h];for(h+=f,a=g&(1<<-u)-1,g>>=-u,u+=s;u>0;a=256*a+t[e+h],h+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+t[e+h],h+=f,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:(g?-1:1)*(1/0);o+=Math.pow(2,n),a-=c}return(g?-1:1)*o*Math.pow(2,a-n)},t.write=function(t,e,r,n,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,h=u>>1,f=23===i?5960464477539062e-23:0,g=n?0:a-1,d=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(s=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+h>=1?e+=f/l:e+=f*Math.pow(2,1-h),e*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(e*l-1)*Math.pow(2,i),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+g]=255&s,g+=d,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;t[r+g]=255&o,g+=d,o/=256,c-=8);t[r+g-d]|=128*p}}),T=w(t=>{x();var e=_(),r=E(),n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function i(t){if(t>2147483647)throw RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,a.prototype),e}function a(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return l(t)}return o(t,e,r)}function o(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!a.isEncoding(e))throw TypeError("Unknown encoding: "+e);var r=0|f(t,e),n=i(r),o=n.write(t,e);return o!==r&&(n=n.slice(0,o)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(O(t,Uint8Array)){var e=new Uint8Array(t);return u(e.buffer,e.byteOffset,e.byteLength)}return c(t)}(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(O(t,ArrayBuffer)||t&&O(t.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(O(t,SharedArrayBuffer)||t&&O(t.buffer,SharedArrayBuffer)))return u(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return a.from(n,e,r);var o=function(t){if(a.isBuffer(t)){var e,r=0|h(t.length),n=i(r);return 0===n.length||t.copy(n,0,0,r),n}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?i(0):c(t):"Buffer"===t.type&&Array.isArray(t.data)?c(t.data):void 0}(t);if(o)return o;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return a.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function s(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return s(t),i(t<0?0:0|h(t))}function c(t){for(var e=t.length<0?0:0|h(t.length),r=i(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function u(t,e,r){var n;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),a.prototype),n}function h(t){if(t>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function f(t,e){if(a.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||O(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return A(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return I(t).length;default:if(i)return n?-1:A(t).length;e=(""+e).toLowerCase(),i=!0}}function g(t,r,n){var i,a,o=!1;if((void 0===r||r<0)&&(r=0),r>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0)||(n>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=e;a<r;++a)i+=L[t[a]];return i}(this,r,n);case"utf8":case"utf-8":return w(this,r,n);case"ascii":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,r,n);case"latin1":case"binary":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,r,n);case"base64":return i=r,a=n,0===i&&a===this.length?e.fromByteArray(this):e.fromByteArray(this.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var n=t.slice(e,r),i="",a=0;a<n.length-1;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}(this,r,n);default:if(o)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),o=!0}}function d(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function p(t,e,r,n,i){var o;if(0===t.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(o=r=+r)!=o&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return -1;r=t.length-1}else if(r<0){if(!i)return -1;r=0}if("string"==typeof e&&(e=a.from(e,n)),a.isBuffer(e))return 0===e.length?-1:y(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):y(t,[e],r,n,i);throw TypeError("val must be string, number or Buffer")}function y(t,e,r,n,i){var a,o=1,s=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;o=2,s/=2,l/=2,r/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var u=-1;for(a=r;a<s;a++)if(c(t,a)===c(e,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===l)return u*o}else -1!==u&&(a-=a-u),u=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){for(var h=!0,f=0;f<l;f++)if(c(t,a+f)!==c(e,f)){h=!1;break}if(h)return a}return -1}function w(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var a,o,s,l,c=t[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(u=c);break;case 2:(192&(a=t[i+1]))==128&&(l=(31&c)<<6|63&a)>127&&(u=l);break;case 3:a=t[i+1],o=t[i+2],(192&a)==128&&(192&o)==128&&(l=(15&c)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:a=t[i+1],o=t[i+2],s=t[i+3],(192&a)==128&&(192&o)==128&&(192&s)==128&&(l=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}function b(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function m(t,e,r,n,i,o){if(!a.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function v(t,e,r,n,i,a){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function T(t,e,n,i,a){return e=+e,n>>>=0,a||v(t,e,n,4,34028234663852886e22,-34028234663852886e22),r.write(t,e,n,i,23,4),n+4}function S(t,e,n,i,a){return e=+e,n>>>=0,a||v(t,e,n,8,17976931348623157e292,-17976931348623157e292),r.write(t,e,n,i,52,8),n+8}t.Buffer=a,t.SlowBuffer=function(t){return+t!=t&&(t=0),a.alloc(+t)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=2147483647,a.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch{return!1}}(),!a.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(t,e,r){return o(t,e,r)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(t,e,r){return s(t),t<=0?i(t):void 0!==e?"string"==typeof r?i(t).fill(e,r):i(t).fill(e):i(t)},a.allocUnsafe=function(t){return l(t)},a.allocUnsafeSlow=function(t){return l(t)},a.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==a.prototype},a.compare=function(t,e){if(O(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),O(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(t)||!a.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var r,n=a.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(O(o,Uint8Array))i+o.length>n.length?a.from(o).copy(n,i):Uint8Array.prototype.set.call(n,o,i);else if(a.isBuffer(o))o.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=o.length}return n},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},a.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},a.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},a.prototype.toString=function(){var t=this.length;return 0===t?"":0==arguments.length?w(this,0,t):g.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(t){if(!a.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(t,e,r,n,i){if(O(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var o=i-n,s=r-e,l=Math.min(o,s),c=this.slice(n,i),u=t.slice(e,r),h=0;h<l;++h)if(c[h]!==u[h]){o=c[h],s=u[h];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},a.prototype.indexOf=function(t,e,r){return p(this,t,e,r,!0)},a.prototype.lastIndexOf=function(t,e,r){return p(this,t,e,r,!1)},a.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,a,o,s,l,c,u,h,f=this.length-e;if((void 0===r||r>f)&&(r=f),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var g=!1;;)switch(n){case"hex":return function(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=e.length;n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(e.substr(2*o,2),16);if(s!=s)break;t[r+o]=s}return o}(this,t,e,r);case"utf8":case"utf-8":return i=e,a=r,C(A(t,this.length-i),this,i,a);case"ascii":case"latin1":case"binary":return o=e,s=r,C(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(t),this,o,s);case"base64":return l=e,c=r,C(I(t),this,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=e,h=r,C(function(t,e){for(var r,n,i=[],a=0;a<t.length&&!((e-=2)<0);++a)n=(r=t.charCodeAt(a))>>8,i.push(r%256),i.push(n);return i}(t,this.length-u),this,u,h);default:if(g)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),g=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,a.prototype),n},a.prototype.readUintLE=a.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return n},a.prototype.readUintBE=a.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},a.prototype.readUint8=a.prototype.readUInt8=function(t,e){return t>>>=0,e||b(t,1,this.length),this[t]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},a.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=e,i=1,a=this[t+--n];n>0&&(i*=256);)a+=this[t+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*e)),a},a.prototype.readInt8=function(t,e){return t>>>=0,e||b(t,1,this.length),128&this[t]?-((255-this[t]+1)*1):this[t]},a.prototype.readInt16LE=function(t,e){t>>>=0,e||b(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt16BE=function(t,e){t>>>=0,e||b(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return t>>>=0,e||b(t,4,this.length),r.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return t>>>=0,e||b(t,4,this.length),r.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return t>>>=0,e||b(t,8,this.length),r.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return t>>>=0,e||b(t,8,this.length),r.read(this,t,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;m(this,t,e,r,i,0)}var a=1,o=0;for(this[e]=255&t;++o<r&&(a*=256);)this[e+o]=t/a&255;return e+r},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;m(this,t,e,r,i,0)}var a=r-1,o=1;for(this[e+a]=255&t;--a>=0&&(o*=256);)this[e+a]=t/o&255;return e+r},a.prototype.writeUint8=a.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,1,255,0),this[e]=255&t,e+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);m(this,t,e,r,i-1,-i)}var a=0,o=1,s=0;for(this[e]=255&t;++a<r&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},a.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);m(this,t,e,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},a.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},a.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeFloatLE=function(t,e,r){return T(this,t,e,!0,r)},a.prototype.writeFloatBE=function(t,e,r){return T(this,t,e,!1,r)},a.prototype.writeDoubleLE=function(t,e,r){return S(this,t,e,!0,r)},a.prototype.writeDoubleBE=function(t,e,r){return S(this,t,e,!1,r)},a.prototype.copy=function(t,e,r,n){if(!a.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},a.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!a.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){var i,o=t.charCodeAt(0);("utf8"===n&&o<128||"latin1"===n)&&(t=o)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{var s=a.isBuffer(t)?t:a.from(t,n),l=s.length;if(0===l)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=s[i%l]}return this};var k=/[^+/0-9A-Za-z-_]/g;function A(t,e){e=e||1/0;for(var r,n=t.length,i=null,a=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319||o+1===n){(e-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return a}function I(t){return e.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(k,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function C(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function O(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}var L=function(){for(var t="0123456789abcdef",e=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)e[n+i]=t[r]+t[i];return e}()}),S=w((t,e)=>{x();var r,n,i=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch{try{return r.call(null,t,0)}catch{return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch{r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch{n=o}}();var l,c=[],u=!1,h=-1;function f(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&g())}function g(){if(!u){var t=s(f);u=!0;for(var e=c.length;e;){for(l=c,c=[];++h<e;)l&&l[h].run();h=-1,e=c.length}l=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch{try{return n.call(null,t)}catch{return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}i.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new d(t,e)),1!==c.length||u||s(g)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(t){return[]},i.binding=function(t){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}),x=(a=()=>{s=m(T()),l=m(S()),c=function(t){function e(){var e=this||self;return delete t.prototype.__magic__,e}return"object"==typeof globalThis?globalThis:this?e():(t.defineProperty(t.prototype,"__magic__",{configurable:!0,get:e}),__magic__)}(Object)},()=>(a&&(o=a(a=0)),o)),k=w(t=>{x(),t.supports=function(...t){let e=t.reduce((t,e)=>Object.assign(t,e),{});return Object.assign(e,{snapshots:e.snapshots||!1,permanence:e.permanence||!1,seek:e.seek||!1,clear:e.clear||!1,getMany:e.getMany||!1,keyIterator:e.keyIterator||!1,valueIterator:e.valueIterator||!1,iteratorNextv:e.iteratorNextv||!1,iteratorAll:e.iteratorAll||!1,status:e.status||!1,createIfMissing:e.createIfMissing||!1,errorIfExists:e.errorIfExists||!1,deferredOpen:e.deferredOpen||!1,promises:e.promises||!1,streams:e.streams||!1,encodings:Object.assign({},e.encodings),events:Object.assign({},e.events),additionalMethods:Object.assign({},e.additionalMethods)})}}),A=w((t,e)=>{x(),e.exports=class extends Error{constructor(t,e){super(t||""),"object"==typeof e&&null!==e&&(e.code&&(this.code=String(e.code)),e.expected&&(this.expected=!0),e.transient&&(this.transient=!0),e.cause&&(this.cause=e.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}}),I=w((t,e)=>{x();var r=null;e.exports=function(){return null===r&&(r={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),r}}),C=w(t=>{x();var e=A(),r=new Set(["buffer","view","utf8"]),n=class{constructor(t){if(this.encode=t.encode||this.encode,this.decode=t.decode||this.decode,this.name=t.name||this.name,this.format=t.format||this.format,"function"!=typeof this.encode)throw TypeError("The 'encode' property must be a function");if("function"!=typeof this.decode)throw TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!=typeof this.name||""===this.name)throw TypeError("The 'name' property must be a string");if("string"!=typeof this.format||!r.has(this.format))throw TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");t.createViewTranscoder&&(this.createViewTranscoder=t.createViewTranscoder),t.createBufferTranscoder&&(this.createBufferTranscoder=t.createBufferTranscoder),t.createUTF8Transcoder&&(this.createUTF8Transcoder=t.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new e(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new e(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new e(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};t.Encoding=n}),O=w(t=>{x();var{Buffer:e}=T()||{},{Encoding:r}=C(),n=I(),i=class extends r{constructor(t){super({...t,format:"buffer"})}createViewTranscoder(){return new a({encode:this.encode,decode:t=>this.decode(e.from(t.buffer,t.byteOffset,t.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},a=class extends r{constructor(t){super({...t,format:"view"})}createBufferTranscoder(){return new i({encode:t=>{let r=this.encode(t);return e.from(r.buffer,r.byteOffset,r.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},o=class extends r{constructor(t){super({...t,format:"utf8"})}createBufferTranscoder(){return new i({encode:t=>e.from(this.encode(t),"utf8"),decode:t=>this.decode(t.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:t,textDecoder:e}=n();return new a({encode:e=>t.encode(this.encode(e)),decode:t=>this.decode(e.decode(t)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};t.BufferFormat=i,t.ViewFormat=a,t.UTF8Format=o}),L=w(t=>{x();var{Buffer:e}=T()||{Buffer:{isBuffer:()=>!1}},{textEncoder:r,textDecoder:n}=I()(),{BufferFormat:i,ViewFormat:a,UTF8Format:o}=O(),s=t=>t;t.utf8=new o({encode:function(t){return e.isBuffer(t)?t.toString("utf8"):ArrayBuffer.isView(t)?n.decode(t):String(t)},decode:s,name:"utf8",createViewTranscoder(){return new a({encode:function(t){return ArrayBuffer.isView(t)?t:r.encode(t)},decode:function(t){return n.decode(t)},name:`${this.name}+view`})},createBufferTranscoder(){return new i({encode:function(t){return e.isBuffer(t)?t:ArrayBuffer.isView(t)?e.from(t.buffer,t.byteOffset,t.byteLength):e.from(String(t),"utf8")},decode:function(t){return t.toString("utf8")},name:`${this.name}+buffer`})}}),t.json=new o({encode:JSON.stringify,decode:JSON.parse,name:"json"}),t.buffer=new i({encode:function(t){return e.isBuffer(t)?t:ArrayBuffer.isView(t)?e.from(t.buffer,t.byteOffset,t.byteLength):e.from(String(t),"utf8")},decode:s,name:"buffer",createViewTranscoder(){return new a({encode:function(t){return ArrayBuffer.isView(t)?t:e.from(String(t),"utf8")},decode:function(t){return e.from(t.buffer,t.byteOffset,t.byteLength)},name:`${this.name}+view`})}}),t.view=new a({encode:function(t){return ArrayBuffer.isView(t)?t:r.encode(t)},decode:s,name:"view",createBufferTranscoder(){return new i({encode:function(t){return e.isBuffer(t)?t:ArrayBuffer.isView(t)?e.from(t.buffer,t.byteOffset,t.byteLength):e.from(String(t),"utf8")},decode:s,name:`${this.name}+buffer`})}}),t.hex=new i({encode:function(t){return e.isBuffer(t)?t:e.from(String(t),"hex")},decode:function(t){return t.toString("hex")},name:"hex"}),t.base64=new i({encode:function(t){return e.isBuffer(t)?t:e.from(String(t),"base64")},decode:function(t){return t.toString("base64")},name:"base64"})}),B=w(t=>{x();var e=A(),r=L(),{Encoding:n}=C(),{BufferFormat:i,ViewFormat:a,UTF8Format:o}=O(),s=Symbol("formats"),l=Symbol("encodings"),c=new Set(["buffer","view","utf8"]),u=class{constructor(t){if(Array.isArray(t)){if(!t.every(t=>c.has(t)))throw TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw TypeError("The first argument 'formats' must be an array");for(let e in this[l]=new Map,this[s]=new Set(t),r)try{this.encoding(e)}catch(t){if("LEVEL_ENCODING_NOT_SUPPORTED"!==t.code)throw t}}encodings(){return Array.from(new Set(this[l].values()))}encoding(t){let r=this[l].get(t);if(void 0===r){if("string"==typeof t&&""!==t){if(!(r=f[t]))throw new e(`Encoding '${t}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if("object"!=typeof t||null===t)throw TypeError("First argument 'encoding' must be a string or object");r=function(t){if(t instanceof n)return t;let e="type"in t&&"string"==typeof t.type?t.type:void 0,r=t.name||e||`anonymous-${g++}`;switch("format"in t&&void 0!==t.format?t.format:"buffer"in t&&"boolean"==typeof t.buffer?t.buffer?"buffer":"utf8":"code"in t&&Number.isInteger(t.code)?"view":"buffer"){case"view":return new a({...t,name:r});case"utf8":return new o({...t,name:r});case"buffer":return new i({...t,name:r});default:throw TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}(t)}let{name:c,format:u}=r;if(!this[s].has(u)){if(this[s].has("view"))r=r.createViewTranscoder();else if(this[s].has("buffer"))r=r.createBufferTranscoder();else if(this[s].has("utf8"))r=r.createUTF8Transcoder();else throw new e(`Encoding '${c}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}for(let e of[t,c,r.name,r.commonName])this[l].set(e,r)}return r}};t.Transcoder=u;var h={binary:r.buffer,"utf-8":r.utf8},f={...r,...h},g=0}),N=w((t,e)=>{x();var r,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(t,e){return new Promise(function(r,n){function i(r){t.removeListener(e,a),n(r)}function a(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}y(t,e,a,{once:!0}),"error"!==e&&"function"==typeof t.on&&y(t,"error",i,{once:!0})})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function l(t){if("function"!=typeof t)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,r,n){var i,a,o;if(l(r),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),a=t._events),o=a[e]),void 0===o)o=a[e]=r,++t._eventsCount;else if("function"==typeof o?o=a[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=c(t))>0&&o.length>i&&!o.warned){o.warned=!0;var s=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=o.length,console&&console.warn&&console.warn(s)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function g(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):p(i,i.length)}function d(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(t,e){for(var r=Array(e),n=0;n<e;++n)r[n]=t[n];return r}function y(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else if("function"==typeof t.addEventListener)t.addEventListener(e,function i(a){n.once&&t.removeEventListener(e,i),r(a)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||a(t))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),o.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,a=this._events;if(void 0!==a)n=n&&void 0===a.error;else if(!n)return!1;if(n){if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var o,s=Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var l=a[t];if(void 0===l)return!1;if("function"==typeof l)i(l,this,e);else for(var c=l.length,u=p(l,c),r=0;r<c;++r)i(u[r],this,e);return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){return l(e),this.on(t,f(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return l(e),this.prependListener(t,f(this,t,e)),this},o.prototype.removeListener=function(t,e){var r,n,i,a,o;if(l(e),void 0===(n=this._events)||void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===e||r[a].listener===e){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,o||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0==arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},o.prototype.listeners=function(t){return g(this,t,!0)},o.prototype.rawListeners=function(t){return g(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},o.prototype.listenerCount=d,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}}),U=w((t,e)=>{x(),e.exports="function"==typeof queueMicrotask?queueMicrotask:t=>Promise.resolve().then(t)}),R=w(t=>{x();var e=U();t.fromCallback=function(t,e){if(void 0===t){var r=new Promise(function(e,r){t=function(t,n){t?r(t):e(n)}});t[void 0!==e?e:"promise"]=r}else if("function"!=typeof t)throw TypeError("Callback must be a function");return t},t.fromPromise=function(t,r){if(void 0===r)return t;t.then(function(t){e(()=>r(null,t))}).catch(function(t){e(()=>r(t))})}}),$=w(t=>{x(),t.getCallback=function(t,e){return"function"==typeof t?t:e},t.getOptions=function(t,e){return"object"==typeof t&&null!==t?t:void 0!==e?e:{}}}),P=w(t=>{x();var{fromCallback:e}=R(),r=A(),{getOptions:n,getCallback:i}=$(),a=Symbol("promise"),o=Symbol("callback"),s=Symbol("working"),l=Symbol("handleOne"),c=Symbol("handleMany"),u=Symbol("autoClose"),h=Symbol("finishWork"),f=Symbol("returnMany"),g=Symbol("closing"),d=Symbol("handleClose"),p=Symbol("closed"),y=Symbol("closeCallbacks"),w=Symbol("keyEncoding"),b=Symbol("valueEncoding"),m=Symbol("abortOnClose"),v=Symbol("legacy"),_=Symbol("keys"),E=Symbol("values"),T=Symbol("limit"),S=Symbol("count"),k=Object.freeze({}),I=()=>{},C=!1,O=class{constructor(t,e,r){if("object"!=typeof t||null===t)throw TypeError(`The first argument must be an abstract-level database, received ${null===t?"null":typeof t}`);if("object"!=typeof e||null===e)throw TypeError("The second argument must be an options object");this[p]=!1,this[y]=[],this[s]=!1,this[g]=!1,this[u]=!1,this[o]=null,this[l]=this[l].bind(this),this[c]=this[c].bind(this),this[d]=this[d].bind(this),this[w]=e[w],this[b]=e[b],this[v]=r,this[T]=Number.isInteger(e.limit)&&e.limit>=0?e.limit:1/0,this[S]=0,this[m]=!!e.abortOnClose,this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get count(){return this[S]}get limit(){return this[T]}next(t){let e;if(void 0===t)e=new Promise((e,r)=>{t=(t,n,i)=>{t?r(t):this[v]?void 0===n&&void 0===i?e():e([n,i]):e(n)}});else if("function"!=typeof t)throw TypeError("Callback must be a function");return this[g]?this.nextTick(t,new r("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[s]?this.nextTick(t,new r("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[s]=!0,this[o]=t,this[S]>=this[T]?this.nextTick(this[l],null):this._next(this[l])),e}_next(t){this.nextTick(t)}nextv(t,l,u){return u=e(u=i(l,u),a),l=n(l,k),Number.isInteger(t)?(this[g]?this.nextTick(u,new r("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[s]?this.nextTick(u,new r("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(t<1&&(t=1),this[T]<1/0&&(t=Math.min(t,this[T]-this[S])),this[s]=!0,this[o]=u,t<=0?this.nextTick(this[c],null,[]):this._nextv(t,l,this[c])),u[a]):(this.nextTick(u,TypeError("The first argument 'size' must be an integer")),u[a])}_nextv(t,e,r){let n=[],i=(e,a,o)=>e?r(e):(this[v]?void 0===a&&void 0===o:void 0===a)?r(null,n):void(n.push(this[v]?[a,o]:a),n.length===t?r(null,n):this._next(i));this._next(i)}all(t,l){return l=e(l=i(t,l),a),t=n(t,k),this[g]?this.nextTick(l,new r("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[s]?this.nextTick(l,new r("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[s]=!0,this[o]=l,this[u]=!0,this[S]>=this[T]?this.nextTick(this[c],null,[]):this._all(t,this[c])),l[a]}_all(t,e){let r=this[S],n=[],i=()=>{let t=this[T]<1/0?Math.min(1e3,this[T]-r):1e3;t<=0?this.nextTick(e,null,n):this._nextv(t,k,a)},a=(t,a)=>{t?e(t):0===a.length?e(null,n):(n.push.apply(n,a),r+=a.length,i())};i()}[h](){let t=this[o];return this[m]&&null===t?I:(this[s]=!1,this[o]=null,this[g]&&this._close(this[d]),t)}[f](t,e,r){this[u]?this.close(t.bind(null,e,r)):t(e,r)}seek(t,e){if(e=n(e,k),!this[g]){if(this[s])throw new r("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{let r=this.db.keyEncoding(e.keyEncoding||this[w]),n=r.format;e.keyEncoding!==n&&(e={...e,keyEncoding:n});let i=this.db.prefixKey(r.encode(t),n);this._seek(i,e)}}}_seek(t,e){throw new r("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(t){return t=e(t,a),this[p]?this.nextTick(t):this[g]?this[y].push(t):(this[g]=!0,this[y].push(t),this[s]?this[m]&&this[h]()(new r("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[d])),t[a]}_close(t){this.nextTick(t)}[d](){this[p]=!0,this.db.detachResource(this);let t=this[y];for(let e of(this[y]=[],t))e()}async *[Symbol.asyncIterator](){try{let t;for(;void 0!==(t=await this.next());)yield t}finally{this[p]||await this.close()}}},L=class extends O{constructor(t,e){super(t,e,!0),this[_]=!1!==e.keys,this[E]=!1!==e.values}[l](t,e,r){let n=this[h]();if(t)return n(t);try{e=this[_]&&void 0!==e?this[w].decode(e):void 0,r=this[E]&&void 0!==r?this[b].decode(r):void 0}catch(t){return n(new U("entry",t))}void 0===e&&void 0===r||this[S]++,n(null,e,r)}[c](t,e){let r=this[h]();if(t)return this[f](r,t);try{for(let t of e){let e=t[0],r=t[1];t[0]=this[_]&&void 0!==e?this[w].decode(e):void 0,t[1]=this[E]&&void 0!==r?this[b].decode(r):void 0}}catch(t){return this[f](r,new U("entries",t))}this[S]+=e.length,this[f](r,null,e)}end(t){return!C&&"u">typeof console&&(C=!0,console.warn(new r("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(t)}},B=class extends O{constructor(t,e){super(t,e,!1)}[l](t,e){let r=this[h]();if(t)return r(t);try{e=void 0!==e?this[w].decode(e):void 0}catch(t){return r(new U("key",t))}void 0!==e&&this[S]++,r(null,e)}[c](t,e){let r=this[h]();if(t)return this[f](r,t);try{for(let t=0;t<e.length;t++){let r=e[t];e[t]=void 0!==r?this[w].decode(r):void 0}}catch(t){return this[f](r,new U("keys",t))}this[S]+=e.length,this[f](r,null,e)}},N=class extends O{constructor(t,e){super(t,e,!1)}[l](t,e){let r=this[h]();if(t)return r(t);try{e=void 0!==e?this[b].decode(e):void 0}catch(t){return r(new U("value",t))}void 0!==e&&this[S]++,r(null,e)}[c](t,e){let r=this[h]();if(t)return this[f](r,t);try{for(let t=0;t<e.length;t++){let r=e[t];e[t]=void 0!==r?this[b].decode(r):void 0}}catch(t){return this[f](r,new U("values",t))}this[S]+=e.length,this[f](r,null,e)}},U=class extends r{constructor(t,e){super(`Iterator could not decode ${t}`,{code:"LEVEL_DECODE_ERROR",cause:e})}};for(let t of["_ended property","_nexting property","_end method"])Object.defineProperty(L.prototype,t.split(" ")[0],{get(){throw new r(`The ${t} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new r(`The ${t} has been removed`,{code:"LEVEL_LEGACY"})}});L.keyEncoding=w,L.valueEncoding=b,t.AbstractIterator=L,t.AbstractKeyIterator=B,t.AbstractValueIterator=N}),M=w(t=>{x();var{AbstractKeyIterator:e,AbstractValueIterator:r}=P(),n=Symbol("iterator"),i=Symbol("callback"),a=Symbol("handleOne"),o=Symbol("handleMany"),s=class extends e{constructor(t,e){super(t,e),this[n]=t.iterator({...e,keys:!0,values:!1}),this[a]=this[a].bind(this),this[o]=this[o].bind(this)}},l=class extends r{constructor(t,e){super(t,e),this[n]=t.iterator({...e,keys:!1,values:!0}),this[a]=this[a].bind(this),this[o]=this[o].bind(this)}};for(let t of[s,l]){let e=t===s,r=e?t=>t[0]:t=>t[1];t.prototype._next=function(t){this[i]=t,this[n].next(this[a])},t.prototype[a]=function(t,r,n){let a=this[i];t?a(t):a(null,e?r:n)},t.prototype._nextv=function(t,e,r){this[i]=r,this[n].nextv(t,e,this[o])},t.prototype._all=function(t,e){this[i]=e,this[n].all(t,this[o])},t.prototype[o]=function(t,e){let n=this[i];t?n(t):n(null,e.map(r))},t.prototype._seek=function(t,e){this[n].seek(t,e)},t.prototype._close=function(t){this[n].close(t)}}t.DefaultKeyIterator=s,t.DefaultValueIterator=l}),D=w(t=>{x();var{AbstractIterator:e,AbstractKeyIterator:r,AbstractValueIterator:n}=P(),i=A(),a=Symbol("nut"),o=Symbol("undefer"),s=Symbol("factory"),l=class extends e{constructor(t,e){super(t,e),this[a]=null,this[s]=()=>t.iterator(e),this.db.defer(()=>this[o]())}},c=class extends r{constructor(t,e){super(t,e),this[a]=null,this[s]=()=>t.keys(e),this.db.defer(()=>this[o]())}},u=class extends n{constructor(t,e){super(t,e),this[a]=null,this[s]=()=>t.values(e),this.db.defer(()=>this[o]())}};for(let t of[l,c,u])t.prototype[o]=function(){"open"===this.db.status&&(this[a]=this[s]())},t.prototype._next=function(t){null!==this[a]?this[a].next(t):"opening"===this.db.status?this.db.defer(()=>this._next(t)):this.nextTick(t,new i("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},t.prototype._nextv=function(t,e,r){null!==this[a]?this[a].nextv(t,e,r):"opening"===this.db.status?this.db.defer(()=>this._nextv(t,e,r)):this.nextTick(r,new i("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},t.prototype._all=function(t,e){null!==this[a]?this[a].all(e):"opening"===this.db.status?this.db.defer(()=>this._all(t,e)):this.nextTick(e,new i("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},t.prototype._seek=function(t,e){null!==this[a]?this[a]._seek(t,e):"opening"===this.db.status&&this.db.defer(()=>this._seek(t,e))},t.prototype._close=function(t){null!==this[a]?this[a].close(t):"opening"===this.db.status?this.db.defer(()=>this._close(t)):this.nextTick(t)};t.DeferredIterator=l,t.DeferredKeyIterator=c,t.DeferredValueIterator=u}),K=w(t=>{x();var{fromCallback:e}=R(),r=A(),{getCallback:n,getOptions:i}=$(),a=Symbol("promise"),o=Symbol("status"),s=Symbol("operations"),l=Symbol("finishClose"),c=Symbol("closeCallbacks"),u=class{constructor(t){if("object"!=typeof t||null===t)throw TypeError(`The first argument must be an abstract-level database, received ${null===t?"null":typeof t}`);this[s]=[],this[c]=[],this[o]="open",this[l]=this[l].bind(this),this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get length(){return this[s].length}put(t,e,n){if("open"!==this[o])throw new r("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let i=this.db._checkKey(t)||this.db._checkValue(e);if(i)throw i;let a=n&&null!=n.sublevel?n.sublevel:this.db,l=n,c=a.keyEncoding(n&&n.keyEncoding),u=a.valueEncoding(n&&n.valueEncoding),h=c.format;n={...n,keyEncoding:h,valueEncoding:u.format},a!==this.db&&(n.sublevel=null);let f=a.prefixKey(c.encode(t),h),g=u.encode(e);return this._put(f,g,n),this[s].push({...l,type:"put",key:t,value:e}),this}_put(t,e,r){}del(t,e){if("open"!==this[o])throw new r("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let n=this.db._checkKey(t);if(n)throw n;let i=e&&null!=e.sublevel?e.sublevel:this.db,a=e,l=i.keyEncoding(e&&e.keyEncoding),c=l.format;return e={...e,keyEncoding:c},i!==this.db&&(e.sublevel=null),this._del(i.prefixKey(l.encode(t),c),e),this[s].push({...a,type:"del",key:t}),this}_del(t,e){}clear(){if("open"!==this[o])throw new r("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[s]=[],this}_clear(){}write(t,u){return u=e(u=n(t,u),a),t=i(t),"open"!==this[o]?this.nextTick(u,new r("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(u):(this[o]="writing",this._write(t,t=>{this[o]="closing",this[c].push(()=>u(t)),t||this.db.emit("batch",this[s]),this._close(this[l])})),u[a]}_write(t,e){}close(t){return t=e(t,a),"closing"===this[o]?this[c].push(t):"closed"===this[o]?this.nextTick(t):(this[c].push(t),"writing"!==this[o]&&(this[o]="closing",this._close(this[l]))),t[a]}_close(t){this.nextTick(t)}[l](){this[o]="closed",this.db.detachResource(this);let t=this[c];for(let e of(this[c]=[],t))e()}};t.AbstractChainedBatch=u}),j=w(t=>{x();var{AbstractChainedBatch:e}=K(),r=A(),n=Symbol("encoded"),i=class extends e{constructor(t){super(t),this[n]=[]}_put(t,e,r){this[n].push({...r,type:"put",key:t,value:e})}_del(t,e){this[n].push({...e,type:"del",key:t})}_clear(){this[n]=[]}_write(t,e){"opening"===this.db.status?this.db.defer(()=>this._write(t,e)):"open"===this.db.status?0===this[n].length?this.nextTick(e):this.db._batch(this[n],t,e):this.nextTick(e,new r("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};t.DefaultChainedBatch=i}),W=w((t,e)=>{x();var r=A(),n=Object.prototype.hasOwnProperty,i=new Set(["lt","lte","gt","gte"]);e.exports=function(t,e){let a={};for(let o in t)if(n.call(t,o)&&!("keyEncoding"===o||"valueEncoding"===o)){if("start"===o||"end"===o)throw new r(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new r("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});i.has(o)?a[o]=e.encode(t[o]):a[o]=t[o]}return a.reverse=!!a.reverse,a.limit=Number.isInteger(a.limit)&&a.limit>=0?a.limit:-1,a}}),F=w((t,e)=>{var r;x(),e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("u">typeof window?window:c):t=>(r||(r=Promise.resolve())).then(t).catch(t=>setTimeout(()=>{throw t},0))}),V=w((t,e)=>{x();var r=F();e.exports=function(t,...e){0===e.length?r(t):r(()=>t(...e))}}),G=w(t=>{x();var{AbstractIterator:e,AbstractKeyIterator:r,AbstractValueIterator:n}=P(),i=Symbol("unfix"),a=Symbol("iterator"),o=Symbol("handleOne"),s=Symbol("handleMany"),l=Symbol("callback"),c=class extends e{constructor(t,e,r,n){super(t,e),this[a]=r,this[i]=n,this[o]=this[o].bind(this),this[s]=this[s].bind(this),this[l]=null}[o](t,e,r){let n=this[l];if(t)return n(t);void 0!==e&&(e=this[i](e)),n(t,e,r)}[s](t,e){let r=this[l];if(t)return r(t);for(let t of e){let e=t[0];void 0!==e&&(t[0]=this[i](e))}r(t,e)}},u=class extends r{constructor(t,e,r,n){super(t,e),this[a]=r,this[i]=n,this[o]=this[o].bind(this),this[s]=this[s].bind(this),this[l]=null}[o](t,e){let r=this[l];if(t)return r(t);void 0!==e&&(e=this[i](e)),r(t,e)}[s](t,e){let r=this[l];if(t)return r(t);for(let t=0;t<e.length;t++){let r=e[t];void 0!==r&&(e[t]=this[i](r))}r(t,e)}},h=class extends n{constructor(t,e,r){super(t,e),this[a]=r}};for(let t of[c,u])t.prototype._next=function(t){this[l]=t,this[a].next(this[o])},t.prototype._nextv=function(t,e,r){this[l]=r,this[a].nextv(t,e,this[s])},t.prototype._all=function(t,e){this[l]=e,this[a].all(t,this[s])};for(let t of[h])t.prototype._next=function(t){this[a].next(t)},t.prototype._nextv=function(t,e,r){this[a].nextv(t,e,r)},t.prototype._all=function(t,e){this[a].all(t,e)};for(let t of[c,u,h])t.prototype._seek=function(t,e){this[a].seek(t,e)},t.prototype._close=function(t){this[a].close(t)};t.AbstractSublevelIterator=c,t.AbstractSublevelKeyIterator=u,t.AbstractSublevelValueIterator=h}),q=w((t,e)=>{x();var r=A(),{Buffer:n}=T()||{},{AbstractSublevelIterator:i,AbstractSublevelKeyIterator:a,AbstractSublevelValueIterator:o}=G(),s=Symbol("prefix"),l=Symbol("upperBound"),c=Symbol("prefixRange"),u=Symbol("parent"),h=Symbol("unfix"),f=new TextEncoder,g={separator:"!"};e.exports=function({AbstractLevel:t}){class e extends t{static defaults(t){if("string"==typeof t)throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(t&&t.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==t?g:t.separator?t:{...t,separator:"!"}}constructor(t,n,i){let{separator:a,manifest:o,...c}=e.defaults(i);n=b(n,a);let g=a.charCodeAt(0)+1,p=t[u]||t;if(!f.encode(n).every(t=>t>g&&t<127))throw new r(`Prefix must use bytes > ${g} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(d(p,o),c);let m=(t.prefix||"")+a+n+a,v=m.slice(0,-1)+String.fromCharCode(g);this[u]=p,this[s]=new y(m),this[l]=new y(v),this[h]=new w,this.nextTick=p.nextTick}prefixKey(t,e){if("utf8"===e)return this[s].utf8+t;if(0===t.byteLength)return this[s][e];if("view"===e){let e=this[s].view,r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r}{let e=this[s].buffer;return n.concat([e,t],e.byteLength+t.byteLength)}}[c](t,e){void 0!==t.gte?t.gte=this.prefixKey(t.gte,e):void 0!==t.gt?t.gt=this.prefixKey(t.gt,e):t.gte=this[s][e],void 0!==t.lte?t.lte=this.prefixKey(t.lte,e):void 0!==t.lt?t.lt=this.prefixKey(t.lt,e):t.lte=this[l][e]}get prefix(){return this[s].utf8}get db(){return this[u]}_open(t,e){this[u].open({passive:!0},e)}_put(t,e,r,n){this[u].put(t,e,r,n)}_get(t,e,r){this[u].get(t,e,r)}_getMany(t,e,r){this[u].getMany(t,e,r)}_del(t,e,r){this[u].del(t,e,r)}_batch(t,e,r){this[u].batch(t,e,r)}_clear(t,e){this[c](t,t.keyEncoding),this[u].clear(t,e)}_iterator(t){this[c](t,t.keyEncoding);let e=this[u].iterator(t),r=this[h].get(this[s].utf8.length,t.keyEncoding);return new i(this,t,e,r)}_keys(t){this[c](t,t.keyEncoding);let e=this[u].keys(t),r=this[h].get(this[s].utf8.length,t.keyEncoding);return new a(this,t,e,r)}_values(t){this[c](t,t.keyEncoding);let e=this[u].values(t);return new o(this,t,e)}}return{AbstractSublevel:e}};var d=function(t,e){return{...t.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...e,encodings:{utf8:p(t,"utf8"),buffer:p(t,"buffer"),view:p(t,"view")}}},p=function(t,e){return!!t.supports.encodings[e]&&t.keyEncoding(e).name===e},y=class{constructor(t){this.utf8=t,this.view=f.encode(t),this.buffer=n?n.from(this.view.buffer,0,this.view.byteLength):{}}},w=class{constructor(){this.cache=new Map}get(t,e){let r=this.cache.get(e);return void 0===r&&(r="view"===e?(function(t,e){return e.subarray(t)}).bind(null,t):(function(t,e){return e.slice(t)}).bind(null,t),this.cache.set(e,r)),r}},b=function(t,e){let r=0,n=t.length;for(;r<n&&t[r]===e;)r++;for(;n>r&&t[n-1]===e;)n--;return t.slice(r,n)}}),z=w(t=>{x();var{supports:e}=k(),{Transcoder:r}=B(),{EventEmitter:n}=N(),{fromCallback:i}=R(),a=A(),{AbstractIterator:o}=P(),{DefaultKeyIterator:s,DefaultValueIterator:l}=M(),{DeferredIterator:c,DeferredKeyIterator:u,DeferredValueIterator:h}=D(),{DefaultChainedBatch:f}=j(),{getCallback:g,getOptions:d}=$(),p=W(),y=Symbol("promise"),w=Symbol("landed"),b=Symbol("resources"),m=Symbol("closeResources"),v=Symbol("operations"),_=Symbol("undefer"),E=Symbol("deferOpen"),T=Symbol("options"),S=Symbol("status"),I=Symbol("defaultOptions"),C=Symbol("transcoder"),O=Symbol("keyEncoding"),L=Symbol("valueEncoding"),U=()=>{},K=class extends n{constructor(t,n){if(super(),"object"!=typeof t||null===t)throw TypeError("The first argument 'manifest' must be an object");let{keyEncoding:i,valueEncoding:a,passive:o,...s}=n=d(n);for(let n of(this[b]=new Set,this[v]=[],this[E]=!0,this[T]=s,this[S]="opening",this.supports=e(t,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==t.snapshots,permanence:!1!==t.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:t.encodings||{},events:Object.assign({},t.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[C]=new r(z(this)),this[O]=this[C].encoding(i||"utf8"),this[L]=this[C].encoding(a||"utf8"),this[C].encodings()))this.supports.encodings[n.commonName]||(this.supports.encodings[n.commonName]=!0);this[I]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[O].commonName,valueEncoding:this[L].commonName}),key:Object.freeze({keyEncoding:this[O].commonName})},this.nextTick(()=>{this[E]&&this.open({passive:!1},U)})}get status(){return this[S]}keyEncoding(t){return this[C].encoding(t??this[O])}valueEncoding(t){return this[C].encoding(t??this[L])}open(t,e){e=i(e=g(t,e),y),(t={...this[T],...d(t)}).createIfMissing=!1!==t.createIfMissing,t.errorIfExists=!!t.errorIfExists;let r=t=>{"closing"===this[S]||"opening"===this[S]?this.once(w,t?()=>r(t):r):"open"!==this[S]?e(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:t})):e()};return t.passive?"opening"===this[S]?this.once(w,r):this.nextTick(r):"closed"===this[S]||this[E]?(this[E]=!1,this[S]="opening",this.emit("opening"),this._open(t,t=>{if(t){this[S]="closed",this[m](()=>{this.emit(w),r(t)}),this[_]();return}this[S]="open",this[_](),this.emit(w),"open"===this[S]&&this.emit("open"),"open"===this[S]&&this.emit("ready"),r()})):"open"===this[S]?this.nextTick(r):this.once(w,()=>this.open(t,e)),e[y]}_open(t,e){this.nextTick(e)}close(t){t=i(t,y);let e=r=>{"opening"===this[S]||"closing"===this[S]?this.once(w,r?e(r):e):"closed"!==this[S]?t(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):t()};if("open"===this[S]){this[S]="closing",this.emit("closing");let t=t=>{this[S]="open",this[_](),this.emit(w),e(t)};this[m](()=>{this._close(r=>{if(r)return t(r);this[S]="closed",this[_](),this.emit(w),"closed"===this[S]&&this.emit("closed"),e()})})}else"closed"===this[S]?this.nextTick(e):this.once(w,()=>this.close(t));return t[y]}[m](t){if(0===this[b].size)return this.nextTick(t);let e=this[b].size,r=!0,n=()=>{0==--e&&(r?this.nextTick(t):t())};for(let t of this[b])t.close(n);r=!1,this[b].clear()}_close(t){this.nextTick(t)}get(t,e,r){if(r=i(r=g(e,r),y),e=d(e,this[I].entry),"opening"===this[S])return this.defer(()=>this.get(t,e,r)),r[y];if(G(this,r))return r[y];let n=this._checkKey(t);if(n)return this.nextTick(r,n),r[y];let o=this.keyEncoding(e.keyEncoding),s=this.valueEncoding(e.valueEncoding),l=o.format,c=s.format;return(e.keyEncoding!==l||e.valueEncoding!==c)&&(e=Object.assign({},e,{keyEncoding:l,valueEncoding:c})),this._get(this.prefixKey(o.encode(t),l),e,(t,e)=>{if(t)return("LEVEL_NOT_FOUND"===t.code||t.notFound||/NotFound/i.test(t))&&(t.code||(t.code="LEVEL_NOT_FOUND"),t.notFound||(t.notFound=!0),t.status||(t.status=404)),r(t);try{e=s.decode(e)}catch(t){return r(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:t}))}r(null,e)}),r[y]}_get(t,e,r){this.nextTick(r,Error("NotFound"))}getMany(t,e,r){if(r=i(r=g(e,r),y),e=d(e,this[I].entry),"opening"===this[S])return this.defer(()=>this.getMany(t,e,r)),r[y];if(G(this,r))return r[y];if(!Array.isArray(t))return this.nextTick(r,TypeError("The first argument 'keys' must be an array")),r[y];if(0===t.length)return this.nextTick(r,null,[]),r[y];let n=this.keyEncoding(e.keyEncoding),o=this.valueEncoding(e.valueEncoding),s=n.format,l=o.format;(e.keyEncoding!==s||e.valueEncoding!==l)&&(e=Object.assign({},e,{keyEncoding:s,valueEncoding:l}));let c=Array(t.length);for(let e=0;e<t.length;e++){let i=t[e],a=this._checkKey(i);if(a)return this.nextTick(r,a),r[y];c[e]=this.prefixKey(n.encode(i),s)}return this._getMany(c,e,(t,e)=>{if(t)return r(t);try{for(let t=0;t<e.length;t++)void 0!==e[t]&&(e[t]=o.decode(e[t]))}catch(t){return r(new a(`Could not decode one or more of ${e.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:t}))}r(null,e)}),r[y]}_getMany(t,e,r){this.nextTick(r,null,Array(t.length).fill(void 0))}put(t,e,r,n){if(n=i(n=g(r,n),y),r=d(r,this[I].entry),"opening"===this[S])return this.defer(()=>this.put(t,e,r,n)),n[y];if(G(this,n))return n[y];let a=this._checkKey(t)||this._checkValue(e);if(a)return this.nextTick(n,a),n[y];let o=this.keyEncoding(r.keyEncoding),s=this.valueEncoding(r.valueEncoding),l=o.format,c=s.format;(r.keyEncoding!==l||r.valueEncoding!==c)&&(r=Object.assign({},r,{keyEncoding:l,valueEncoding:c}));let u=this.prefixKey(o.encode(t),l),h=s.encode(e);return this._put(u,h,r,r=>{if(r)return n(r);this.emit("put",t,e),n()}),n[y]}_put(t,e,r,n){this.nextTick(n)}del(t,e,r){if(r=i(r=g(e,r),y),e=d(e,this[I].key),"opening"===this[S])return this.defer(()=>this.del(t,e,r)),r[y];if(G(this,r))return r[y];let n=this._checkKey(t);if(n)return this.nextTick(r,n),r[y];let a=this.keyEncoding(e.keyEncoding),o=a.format;return e.keyEncoding!==o&&(e=Object.assign({},e,{keyEncoding:o})),this._del(this.prefixKey(a.encode(t),o),e,e=>{if(e)return r(e);this.emit("del",t),r()}),r[y]}_del(t,e,r){this.nextTick(r)}batch(t,e,r){if(!arguments.length){if("opening"===this[S])return new f(this);if("open"!==this[S])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(r=i(r="function"==typeof t?t:g(e,r),y),e=d(e,this[I].empty),"opening"===this[S])return this.defer(()=>this.batch(t,e,r)),r[y];if(G(this,r))return r[y];if(!Array.isArray(t))return this.nextTick(r,TypeError("The first argument 'operations' must be an array")),r[y];if(0===t.length)return this.nextTick(r),r[y];let n=Array(t.length),{keyEncoding:o,valueEncoding:s,...l}=e;for(let e=0;e<t.length;e++){if("object"!=typeof t[e]||null===t[e])return this.nextTick(r,TypeError("A batch operation must be an object")),r[y];let i=Object.assign({},t[e]);if("put"!==i.type&&"del"!==i.type)return this.nextTick(r,TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[y];let a=this._checkKey(i.key);if(a)return this.nextTick(r,a),r[y];let l=null!=i.sublevel?i.sublevel:this,c=l.keyEncoding(i.keyEncoding||o),u=c.format;if(i.key=l.prefixKey(c.encode(i.key),u),i.keyEncoding=u,"put"===i.type){let t=this._checkValue(i.value);if(t)return this.nextTick(r,t),r[y];let e=l.valueEncoding(i.valueEncoding||s);i.value=e.encode(i.value),i.valueEncoding=e.format}l!==this&&(i.sublevel=null),n[e]=i}return this._batch(n,l,e=>{if(e)return r(e);this.emit("batch",t),r()}),r[y]}_batch(t,e,r){this.nextTick(r)}sublevel(t,e){return this._sublevel(t,F.defaults(e))}_sublevel(t,e){return new F(this,t,e)}prefixKey(t,e){return t}clear(t,e){if(e=i(e=g(t,e),y),t=d(t,this[I].empty),"opening"===this[S])return this.defer(()=>this.clear(t,e)),e[y];if(G(this,e))return e[y];let r=t,n=this.keyEncoding(t.keyEncoding);return(t=p(t,n)).keyEncoding=n.format,0===t.limit?this.nextTick(e):this._clear(t,t=>{if(t)return e(t);this.emit("clear",r),e()}),e[y]}_clear(t,e){this.nextTick(e)}iterator(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if((t=p(t,e)).keys=!1!==t.keys,t.values=!1!==t.values,t[o.keyEncoding]=e,t[o.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,"opening"===this[S])return new c(this,t);if("open"!==this[S])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(t)}_iterator(t){return new o(this,t)}keys(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if((t=p(t,e))[o.keyEncoding]=e,t[o.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,"opening"===this[S])return new u(this,t);if("open"!==this[S])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(t)}_keys(t){return new s(this,t)}values(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if((t=p(t,e))[o.keyEncoding]=e,t[o.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,"opening"===this[S])return new h(this,t);if("open"!==this[S])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(t)}_values(t){return new l(this,t)}defer(t){if("function"!=typeof t)throw TypeError("The first argument must be a function");this[v].push(t)}[_](){if(0===this[v].length)return;let t=this[v];for(let e of(this[v]=[],t))e()}attachResource(t){if("object"!=typeof t||null===t||"function"!=typeof t.close)throw TypeError("The first argument must be a resource object");this[b].add(t)}detachResource(t){this[b].delete(t)}_chainedBatch(){return new f(this)}_checkKey(t){if(null==t)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(t){if(null==t)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};K.prototype.nextTick=V();var{AbstractSublevel:F}=q()({AbstractLevel:K});t.AbstractLevel=K,t.AbstractSublevel=F;var G=function(t,e){return"open"!==t[S]&&(t.nextTick(e,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},z=function(t){return Object.keys(t.supports.encodings).filter(e=>!!t.supports.encodings[e])}}),H=w(t=>{x(),t.AbstractLevel=z().AbstractLevel,t.AbstractSublevel=z().AbstractSublevel,t.AbstractIterator=P().AbstractIterator,t.AbstractKeyIterator=P().AbstractKeyIterator,t.AbstractValueIterator=P().AbstractValueIterator,t.AbstractChainedBatch=K().AbstractChainedBatch}),J=w((t,e)=>{x(),e.exports=function(t,e,n){if("number"!=typeof e)throw Error("second argument must be a Number");let i,a,o,s,l,c=!0,u;function h(t){function e(){n&&n(t,i),n=null}c?r(e):e()}function f(e,r,n){if(i[e]=n,r&&(l=!0),0==--o||r)h(r);else if(!l&&u<a){let e;s?(e=s[u],u+=1,t[e](function(t,r){f(e,t,r)})):(e=u,u+=1,t[e](function(t,r){f(e,t,r)}))}}Array.isArray(t)?(i=[],o=a=t.length):(s=Object.keys(t),i={},o=a=s.length),u=e,o?s?s.some(function(r,n){return t[r](function(t,e){f(r,t,e)}),n===e-1}):t.some(function(t,r){return t(function(t,e){f(r,t,e)}),r===e-1}):h(null),c=!1};var r=F()}),Y=w((t,e)=>{x(),e.exports=function(t){let e=void 0!==t.gte?t.gte:void 0!==t.gt?t.gt:void 0,r=void 0!==t.lte?t.lte:void 0!==t.lt?t.lt:void 0,n=void 0===t.gte,i=void 0===t.lte;return void 0!==e&&void 0!==r?IDBKeyRange.bound(e,r,n,i):void 0!==e?IDBKeyRange.lowerBound(e,n):void 0!==r?IDBKeyRange.upperBound(r,i):null}}),Q=w((t,e)=>{x();var r=new TextEncoder;e.exports=function(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):r.encode(t)}}),X=w(t=>{x();var{AbstractIterator:e}=H(),r=Y(),n=Q(),i=Symbol("cache"),a=Symbol("finished"),o=Symbol("options"),s=Symbol("currentOptions"),l=Symbol("position"),c=Symbol("location"),u=Symbol("first"),h={},f=class extends e{constructor(t,e,r){super(t,r),this[i]=[],this[a]=0===this.limit,this[o]=r,this[s]={...r},this[l]=void 0,this[c]=e,this[u]=!0}_nextv(t,e,h){let f;if(this[u]=!1,this[a])return this.nextTick(h,null,[]);if(this[i].length>0)return t=Math.min(t,this[i].length),this.nextTick(h,null,this[i].splice(0,t));void 0!==this[l]&&(this[o].reverse?(this[s].lt=this[l],this[s].lte=void 0):(this[s].gt=this[l],this[s].gte=void 0));try{f=r(this[s])}catch{return this[a]=!0,this.nextTick(h,null,[])}let d=this.db.db.transaction([this[c]],"readonly"),p=d.objectStore(this[c]),y=[];if(this[o].reverse){let e=!this[o].values&&p.openKeyCursor?"openKeyCursor":"openCursor";p[e](f,"prev").onsuccess=e=>{let r=e.target.result;if(r){let{key:e,value:i}=r;this[l]=e,y.push([this[o].keys&&void 0!==e?n(e):void 0,this[o].values&&void 0!==i?n(i):void 0]),y.length<t?r.continue():g(d)}else this[a]=!0}}else{let e,r,i=()=>{if(void 0===e||void 0===r)return;let i=Math.max(e.length,r.length);0===i||t===1/0?this[a]=!0:this[l]=e[i-1],y.length=i;for(let t=0;t<i;t++){let i=e[t],a=r[t];y[t]=[this[o].keys&&void 0!==i?n(i):void 0,this[o].values&&void 0!==a?n(a):void 0]}g(d)};this[o].keys||t<1/0?p.getAllKeys(f,t<1/0?t:void 0).onsuccess=t=>{e=t.target.result,i()}:(e=[],this.nextTick(i)),this[o].values?p.getAll(f,t<1/0?t:void 0).onsuccess=t=>{r=t.target.result,i()}:(r=[],this.nextTick(i))}d.onabort=()=>{h(d.error||Error("aborted by user")),h=null},d.oncomplete=()=>{h(null,y),h=null}}_next(t){if(this[i].length>0){let[e,r]=this[i].shift();this.nextTick(t,null,e,r)}else if(this[a])this.nextTick(t);else{let e=Math.min(100,this.limit-this.count);this[u]&&(this[u]=!1,e=1),this._nextv(e,h,(e,r)=>{if(e)return t(e);this[i]=r,this._next(t)})}}_all(t,e){this[u]=!1;let r=this[i].splice(0,this[i].length),n=this.limit-this.count-r.length;if(n<=0)return this.nextTick(e,null,r);this._nextv(n,h,(t,n)=>{if(t)return e(t);r.length>0&&(n=r.concat(n)),e(null,n)})}_seek(t,e){let n;this[u]=!0,this[i]=[],this[a]=!1,this[l]=void 0,this[s]={...this[o]};try{n=r(this[o])}catch{this[a]=!0;return}null===n||n.includes(t)?this[o].reverse?this[s].lte=t:this[s].gte=t:this[a]=!0}};function g(t){"function"==typeof t.commit&&t.commit()}t.Iterator=f}),Z=w((t,e)=>{x(),e.exports=function(t,e,r,n,i){if(0===n.limit)return t.nextTick(i);let a=t.db.transaction([e],"readwrite"),o=a.objectStore(e),s=0;a.oncomplete=function(){i()},a.onabort=function(){i(a.error||Error("aborted by user"))};let l=o.openKeyCursor?"openKeyCursor":"openCursor",c=n.reverse?"prev":"next";o[l](r,c).onsuccess=function(t){let e=t.target.result;e&&(o.delete(e.key).onsuccess=function(){(n.limit<=0||++s<n.limit)&&e.continue()})}}}),tt=w(t=>{x();var{AbstractLevel:e}=H(),r=A(),n=J(),{fromCallback:i}=R(),{Iterator:a}=X(),o=Q(),s=Z(),l=Y(),c="level-js-",u=Symbol("idb"),h=Symbol("namePrefix"),f=Symbol("location"),g=Symbol("version"),d=Symbol("store"),p=Symbol("onComplete"),y=Symbol("promise"),w=class extends e{constructor(t,e,n){if("function"==typeof e||"function"==typeof n)throw new r("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:i,version:a,...o}=e||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!=typeof t)throw Error("constructor requires a location string argument");this[f]=t,this[h]=i??c,this[g]=parseInt(a||1,10),this[u]=null}get location(){return this[f]}get namePrefix(){return this[h]}get version(){return this[g]}get db(){return this[u]}get type(){return"browser-level"}_open(t,e){let r=indexedDB.open(this[h]+this[f],this[g]);r.onerror=function(){e(r.error||Error("unknown error"))},r.onsuccess=()=>{this[u]=r.result,e()},r.onupgradeneeded=t=>{let e=t.target.result;e.objectStoreNames.contains(this[f])||e.createObjectStore(this[f])}}[d](t){return this[u].transaction([this[f]],t).objectStore(this[f])}[p](t,e){let r=t.transaction;r.onabort=function(){e(r.error||Error("aborted by user"))},r.oncomplete=function(){e(null,t.result)}}_get(t,e,n){let i=this[d]("readonly"),a;try{a=i.get(t)}catch(t){return this.nextTick(n,t)}this[p](a,function(t,e){return t?n(t):void 0===e?n(new r("Entry not found",{code:"LEVEL_NOT_FOUND"})):void n(null,o(e))})}_getMany(t,e,r){let i=this[d]("readonly");n(t.map(t=>e=>{let r;try{r=i.get(t)}catch(t){return e(t)}r.onsuccess=()=>{let t=r.result;e(null,void 0===t?t:o(t))},r.onerror=t=>{t.stopPropagation(),e(r.error)}}),16,r)}_del(t,e,r){let n=this[d]("readwrite"),i;try{i=n.delete(t)}catch(t){return this.nextTick(r,t)}this[p](i,r)}_put(t,e,r,n){let i=this[d]("readwrite"),a;try{a=i.put(e,t)}catch(t){return this.nextTick(n,t)}this[p](a,n)}_iterator(t){return new a(this,this[f],t)}_batch(t,e,r){let n=this[d]("readwrite"),i=n.transaction,a=0,o;i.onabort=function(){r(o||i.error||Error("aborted by user"))},i.oncomplete=function(){r()},function e(){let r=t[a++],s=r.key,l;try{l="del"===r.type?n.delete(s):n.put(r.value,s)}catch(t){o=t,i.abort();return}a<t.length?l.onsuccess=e:"function"==typeof i.commit&&i.commit()}()}_clear(t,e){let r,n;try{r=l(t)}catch{return this.nextTick(e)}if(t.limit>=0)return s(this,this[f],r,t,e);try{let t=this[d]("readwrite");n=r?t.delete(r):t.clear()}catch(t){return this.nextTick(e,t)}this[p](n,e)}_close(t){this[u].close(),this.nextTick(t)}};w.destroy=function(t,e,r){"function"==typeof e&&(r=e,e=c),r=i(r,y);let n=indexedDB.deleteDatabase(e+t);return n.onsuccess=function(){r()},n.onerror=function(t){r(t)},r[y]},t.BrowserLevel=w}),te=w(t=>{x(),t.Level=tt().BrowserLevel}),tr=w((t,e)=>{function r(t,e,r,n,i,a){this._color=t,this.key=e,this.value=r,this.left=n,this.right=i,this._count=a}function n(t){return new r(t._color,t.key,t.value,t.left,t.right,t._count)}function i(t,e){return new r(t,e.key,e.value,e.left,e.right,e._count)}function a(t){t._count=1+(t.left?t.left._count:0)+(t.right?t.right._count:0)}function o(t,e){this._compare=t,this.root=e}x(),e.exports=function(t){return new o(t||h,null)};var s=o.prototype;function l(t,e){this.tree=t,this._stack=e}Object.defineProperty(s,"keys",{get:function(){var t=[];return this.forEach(function(e,r){t.push(e)}),t}}),Object.defineProperty(s,"values",{get:function(){var t=[];return this.forEach(function(e,r){t.push(r)}),t}}),Object.defineProperty(s,"length",{get:function(){return this.root?this.root._count:0}}),s.insert=function(t,e){for(var n=this._compare,s=this.root,l=[],c=[];s;){var u=n(t,s.key);l.push(s),c.push(u),s=u<=0?s.left:s.right}l.push(new r(0,t,e,null,null,1));for(var h=l.length-2;h>=0;--h){var s=l[h];c[h]<=0?l[h]=new r(s._color,s.key,s.value,l[h+1],s.right,s._count+1):l[h]=new r(s._color,s.key,s.value,s.left,l[h+1],s._count+1)}for(var h=l.length-1;h>1;--h){var f=l[h-1],s=l[h];if(1===f._color||1===s._color)break;var g=l[h-2];if(g.left===f){if(f.left===s){var d=g.right;if(d&&0===d._color)f._color=1,g.right=i(1,d),g._color=0,h-=1;else{if(g._color=0,g.left=f.right,f._color=1,f.right=g,l[h-2]=f,l[h-1]=s,a(g),a(f),h>=3){var p=l[h-3];p.left===g?p.left=f:p.right=f}break}}else{var d=g.right;if(d&&0===d._color)f._color=1,g.right=i(1,d),g._color=0,h-=1;else{if(f.right=s.left,g._color=0,g.left=s.right,s._color=1,s.left=f,s.right=g,l[h-2]=s,l[h-1]=f,a(g),a(f),a(s),h>=3){var p=l[h-3];p.left===g?p.left=s:p.right=s}break}}}else if(f.right===s){var d=g.left;if(d&&0===d._color)f._color=1,g.left=i(1,d),g._color=0,h-=1;else{if(g._color=0,g.right=f.left,f._color=1,f.left=g,l[h-2]=f,l[h-1]=s,a(g),a(f),h>=3){var p=l[h-3];p.right===g?p.right=f:p.left=f}break}}else{var d=g.left;if(d&&0===d._color)f._color=1,g.left=i(1,d),g._color=0,h-=1;else{if(f.left=s.right,g._color=0,g.right=s.left,s._color=1,s.right=f,s.left=g,l[h-2]=s,l[h-1]=f,a(g),a(f),a(s),h>=3){var p=l[h-3];p.right===g?p.right=s:p.left=s}break}}}return l[0]._color=1,new o(n,l[0])},s.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return function t(e,r){if(r.left){var n=t(e,r.left);if(n)return n}var n=e(r.key,r.value);return n||(r.right?t(e,r.right):void 0)}(t,this.root);case 2:return function t(e,r,n,i){if(0>=r(e,i.key)){if(i.left){var a=t(e,r,n,i.left);if(a)return a}var a=n(i.key,i.value);if(a)return a}if(i.right)return t(e,r,n,i.right)}(e,this._compare,t,this.root);case 3:return this._compare(e,r)>=0?void 0:function t(e,r,n,i,a){var o,s=n(e,a.key),l=n(r,a.key);return s<=0&&(a.left&&(o=t(e,r,n,i,a.left))||l>0&&(o=i(a.key,a.value)))?o:l>0&&a.right?t(e,r,n,i,a.right):void 0}(e,r,this._compare,t,this.root)}},Object.defineProperty(s,"begin",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.left;return new l(this,t)}}),Object.defineProperty(s,"end",{get:function(){for(var t=[],e=this.root;e;)t.push(e),e=e.right;return new l(this,t)}}),s.at=function(t){if(t<0)return new l(this,[]);for(var e=this.root,r=[];;){if(r.push(e),e.left){if(t<e.left._count){e=e.left;continue}t-=e.left._count}if(!t)return new l(this,r);if(t-=1,e.right){if(t>=e.right._count)break;e=e.right}else break}return new l(this,[])},s.ge=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var a=e(t,r.key);n.push(r),a<=0&&(i=n.length),r=a<=0?r.left:r.right}return n.length=i,new l(this,n)},s.gt=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var a=e(t,r.key);n.push(r),a<0&&(i=n.length),r=a<0?r.left:r.right}return n.length=i,new l(this,n)},s.lt=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var a=e(t,r.key);n.push(r),a>0&&(i=n.length),r=a<=0?r.left:r.right}return n.length=i,new l(this,n)},s.le=function(t){for(var e=this._compare,r=this.root,n=[],i=0;r;){var a=e(t,r.key);n.push(r),a>=0&&(i=n.length),r=a<0?r.left:r.right}return n.length=i,new l(this,n)},s.find=function(t){for(var e=this._compare,r=this.root,n=[];r;){var i=e(t,r.key);if(n.push(r),0===i)return new l(this,n);r=i<=0?r.left:r.right}return new l(this,[])},s.remove=function(t){var e=this.find(t);return e?e.remove():this},s.get=function(t){for(var e=this._compare,r=this.root;r;){var n=e(t,r.key);if(0===n)return r.value;r=n<=0?r.left:r.right}};var c=l.prototype;function u(t,e){t.key=e.key,t.value=e.value,t.left=e.left,t.right=e.right,t._color=e._color,t._count=e._count}function h(t,e){return t<e?-1:t>e?1:0}Object.defineProperty(c,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(c,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),c.clone=function(){return new l(this.tree,this._stack.slice())},c.remove=function(){var t=this._stack;if(0===t.length)return this.tree;var e=Array(t.length),s=t[t.length-1];e[e.length-1]=new r(s._color,s.key,s.value,s.left,s.right,s._count);for(var l=t.length-2;l>=0;--l){var s=t[l];s.left===t[l+1]?e[l]=new r(s._color,s.key,s.value,e[l+1],s.right,s._count):e[l]=new r(s._color,s.key,s.value,s.left,e[l+1],s._count)}if((s=e[e.length-1]).left&&s.right){var c=e.length;for(s=s.left;s.right;)e.push(s),s=s.right;var h=e[c-1];e.push(new r(s._color,h.key,h.value,s.left,s.right,s._count)),e[c-1].key=s.key,e[c-1].value=s.value;for(var l=e.length-2;l>=c;--l)s=e[l],e[l]=new r(s._color,s.key,s.value,s.left,e[l+1],s._count);e[c-1].left=e[c]}if(0===(s=e[e.length-1])._color){var f=e[e.length-2];f.left===s?f.left=null:f.right===s&&(f.right=null),e.pop();for(var l=0;l<e.length;++l)e[l]._count--}else if(s.left||s.right){s.left?u(s,s.left):s.right&&u(s,s.right),s._color=1;for(var l=0;l<e.length-1;++l)e[l]._count--}else{if(1===e.length)return new o(this.tree._compare,null);for(var l=0;l<e.length;++l)e[l]._count--;var g=e[e.length-2];(function(t){for(var e,r,o,s,l=t.length-1;l>=0;--l){if(e=t[l],0===l){e._color=1;return}if((r=t[l-1]).left===e){if((o=r.right).right&&0===o.right._color){if(s=(o=r.right=n(o)).right=n(o.right),r.right=o.left,o.left=r,o.right=s,o._color=r._color,e._color=1,r._color=1,s._color=1,a(r),a(o),l>1){var c=t[l-2];c.left===r?c.left=o:c.right=o}t[l-1]=o;return}if(o.left&&0===o.left._color){if(s=(o=r.right=n(o)).left=n(o.left),r.right=s.left,o.left=s.right,s.left=r,s.right=o,s._color=r._color,r._color=1,o._color=1,e._color=1,a(r),a(o),a(s),l>1){var c=t[l-2];c.left===r?c.left=s:c.right=s}t[l-1]=s;return}if(1===o._color){if(0===r._color){r._color=1,r.right=i(0,o);return}r.right=i(0,o);continue}if(o=n(o),r.right=o.left,o.left=r,o._color=r._color,r._color=0,a(r),a(o),l>1){var c=t[l-2];c.left===r?c.left=o:c.right=o}t[l-1]=o,t[l]=r,l+1<t.length?t[l+1]=e:t.push(e),l+=2}else{if((o=r.left).left&&0===o.left._color){if(s=(o=r.left=n(o)).left=n(o.left),r.left=o.right,o.right=r,o.left=s,o._color=r._color,e._color=1,r._color=1,s._color=1,a(r),a(o),l>1){var c=t[l-2];c.right===r?c.right=o:c.left=o}t[l-1]=o;return}if(o.right&&0===o.right._color){if(s=(o=r.left=n(o)).right=n(o.right),r.left=s.right,o.right=s.left,s.right=r,s.left=o,s._color=r._color,r._color=1,o._color=1,e._color=1,a(r),a(o),a(s),l>1){var c=t[l-2];c.right===r?c.right=s:c.left=s}t[l-1]=s;return}if(1===o._color){if(0===r._color){r._color=1,r.left=i(0,o);return}r.left=i(0,o);continue}if(o=n(o),r.left=o.right,o.right=r,o._color=r._color,r._color=0,a(r),a(o),l>1){var c=t[l-2];c.right===r?c.right=o:c.left=o}t[l-1]=o,t[l]=r,l+1<t.length?t[l+1]=e:t.push(e),l+=2}}})(e),g.left===s?g.left=null:g.right=null}return new o(this.tree._compare,e[0])},Object.defineProperty(c,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(c,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(c,"index",{get:function(){var t=0,e=this._stack;if(0===e.length){var r=this.tree.root;return r?r._count:0}e[e.length-1].left&&(t=e[e.length-1].left._count);for(var n=e.length-2;n>=0;--n)e[n+1]===e[n].right&&(++t,e[n].left&&(t+=e[n].left._count));return t},enumerable:!0}),c.next=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.right)for(e=e.right;e;)t.push(e),e=e.left;else for(t.pop();t.length>0&&t[t.length-1].right===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(c,"hasNext",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].right)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].left===t[e])return!0;return!1}}),c.update=function(t){var e=this._stack;if(0===e.length)throw Error("Can't update empty node!");var n=Array(e.length),i=e[e.length-1];n[n.length-1]=new r(i._color,i.key,t,i.left,i.right,i._count);for(var a=e.length-2;a>=0;--a)(i=e[a]).left===e[a+1]?n[a]=new r(i._color,i.key,i.value,n[a+1],i.right,i._count):n[a]=new r(i._color,i.key,i.value,i.left,n[a+1],i._count);return new o(this.tree._compare,n[0])},c.prev=function(){var t=this._stack;if(0!==t.length){var e=t[t.length-1];if(e.left)for(e=e.left;e;)t.push(e),e=e.right;else for(t.pop();t.length>0&&t[t.length-1].left===e;)e=t[t.length-1],t.pop()}},Object.defineProperty(c,"hasPrev",{get:function(){var t=this._stack;if(0===t.length)return!1;if(t[t.length-1].left)return!0;for(var e=t.length-1;e>0;--e)if(t[e-1].right===t[e])return!0;return!1}})}),tn=w(t=>{x();var{AbstractLevel:e,AbstractIterator:r,AbstractKeyIterator:n,AbstractValueIterator:i}=H(),a=A(),o=tr(),s=new Set(["gt","gte","lt","lte"]),u=Symbol("none"),h=Symbol("tree"),f=Symbol("iterator"),g=Symbol("lowerBound"),d=Symbol("upperBound"),p=Symbol("outOfRange"),y=Symbol("reverse"),w=Symbol("options"),b=Symbol("test"),m=Symbol("advance"),v=Symbol("init");function _(t,e){if("string"==typeof t)return t<e?-1:t>e?1:0;let r=Math.min(t.byteLength,e.byteLength);for(let n=0;n<r;n++){let r=t[n]-e[n];if(0!==r)return r}return t.byteLength-e.byteLength}function E(t){return _(t,this[d])>0}function T(t){return _(t,this[d])>=0}function S(t){return 0>_(t,this[d])}function k(t){return 0>=_(t,this[d])}var I=class extends r{constructor(t,e){super(t,e),this[v](t[h],e)}_next(t){if(!this[f].valid)return this.nextTick(t);let e=this[f].key,r=this[f].value;if(!this[b](e))return this.nextTick(t);this[f][this[m]](),this.nextTick(t,null,e,r)}_nextv(t,e,r){let n=this[f],i=[];for(;n.valid&&i.length<t&&this[b](n.key);)i.push([n.key,n.value]),n[this[m]]();this.nextTick(r,null,i)}_all(t,e){let r=this.limit-this.count,n=this[f],i=[];for(;n.valid&&i.length<r&&this[b](n.key);)i.push([n.key,n.value]),n[this[m]]();this.nextTick(e,null,i)}},C=class extends n{constructor(t,e){super(t,e),this[v](t[h],e)}_next(t){if(!this[f].valid)return this.nextTick(t);let e=this[f].key;if(!this[b](e))return this.nextTick(t);this[f][this[m]](),this.nextTick(t,null,e)}_nextv(t,e,r){let n=this[f],i=[];for(;n.valid&&i.length<t&&this[b](n.key);)i.push(n.key),n[this[m]]();this.nextTick(r,null,i)}_all(t,e){let r=this.limit-this.count,n=this[f],i=[];for(;n.valid&&i.length<r&&this[b](n.key);)i.push(n.key),n[this[m]]();this.nextTick(e,null,i)}},O=class extends i{constructor(t,e){super(t,e),this[v](t[h],e)}_next(t){if(!this[f].valid)return this.nextTick(t);let e=this[f].key,r=this[f].value;if(!this[b](e))return this.nextTick(t);this[f][this[m]](),this.nextTick(t,null,r)}_nextv(t,e,r){let n=this[f],i=[];for(;n.valid&&i.length<t&&this[b](n.key);)i.push(n.value),n[this[m]]();this.nextTick(r,null,i)}_all(t,e){let r=this.limit-this.count,n=this[f],i=[];for(;n.valid&&i.length<r&&this[b](n.key);)i.push(n.value),n[this[m]]();this.nextTick(e,null,i)}};for(let t of[I,C,O])t.prototype[v]=function(t,e){this[y]=e.reverse,this[w]=e,this[y]?(this[m]="prev",this[g]="lte"in e?e.lte:"lt"in e?e.lt:u,this[d]="gte"in e?e.gte:"gt"in e?e.gt:u,this[g]===u?this[f]=t.end:"lte"in e?this[f]=t.le(this[g]):this[f]=t.lt(this[g]),this[d]!==u&&(this[b]="gte"in e?T:E)):(this[m]="next",this[g]="gte"in e?e.gte:"gt"in e?e.gt:u,this[d]="lte"in e?e.lte:"lt"in e?e.lt:u,this[g]===u?this[f]=t.begin:"gte"in e?this[f]=t.ge(this[g]):this[f]=t.gt(this[g]),this[d]!==u&&(this[b]="lte"in e?k:S))},t.prototype[b]=function(){return!0},t.prototype[p]=function(t){return!this[b](t)||this[g]!==u&&(this[y]?"lte"in this[w]?_(t,this[g])>0:_(t,this[g])>=0:"gte"in this[w]?0>_(t,this[g]):0>=_(t,this[g]))},t.prototype._seek=function(t,e){this[p](t)?(this[f]=this[f].tree.end,this[f].next()):this[y]?this[f]=this[f].tree.le(t):this[f]=this[f].tree.ge(t)};var L=class extends e{constructor(t,e,r){if("object"==typeof t&&null!==t&&(e=t),"function"==typeof t||"function"==typeof e||"function"==typeof r)throw new a("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{storeEncoding:n,...i}=e||{};if(!["buffer","view","utf8"].includes(n=n||"buffer"))throw new a("The storeEncoding option must be 'buffer', 'view' or 'utf8'",{code:"LEVEL_ENCODING_NOT_SUPPORTED"});super({seek:!0,permanence:!1,createIfMissing:!1,errorIfExists:!1,encodings:{[n]:!0}},i),this[h]=o(_)}_put(t,e,r,n){let i=this[h].find(t);i.valid?this[h]=i.update(e):this[h]=this[h].insert(t,e),this.nextTick(n)}_get(t,e,r){let n=this[h].get(t);if(typeof n>"u")return this.nextTick(r,Error("NotFound"));this.nextTick(r,null,n)}_getMany(t,e,r){this.nextTick(r,null,t.map(t=>this[h].get(t)))}_del(t,e,r){this[h]=this[h].remove(t),this.nextTick(r)}_batch(t,e,r){let n=this[h];for(let e of t){let t=e.key,r=n.find(t);n="put"===e.type?r.valid?r.update(e.value):n.insert(t,e.value):r.remove()}this[h]=n,this.nextTick(r)}_clear(t,e){if(-1===t.limit&&!Object.keys(t).some(B))return this[h]=o(_),this.nextTick(e);let r=this._keys({...t}),n=r.limit,i=0,a=()=>{for(let t=0;t<500;t++){if(++i>n||!r[f].valid||!r[b](r[f].key))return e();this[h]=this[h].remove(r[f].key),r[f][r[m]]()}this.nextTick(a)};this.nextTick(a)}_iterator(t){return new I(this,t)}_keys(t){return new C(this,t)}_values(t){return new O(this,t)}};if(t.MemoryLevel=L,"u">typeof l.default&&!l.default.browser&&"u">typeof c&&"function"==typeof c.setImmediate){let t=c.setImmediate;L.prototype.nextTick=function(e,...r){0===r.length?t(e):t(()=>e(...r))}}function B(t){return s.has(t)}}),ti=w((t,e)=>{x(),"u">typeof window?(window.global=window,c.fetch=window.fetch,e.exports={Buffer:T().Buffer,Crypto:window.crypto}):e.exports={Buffer:T().Buffer,Crypto:crypto}}),ta=w((t,e)=>{x(),function(t){var n,i=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,o=Math.floor,s="[BigNumber Error] ",l=s+"Number primitive has more than 15 significant digits: ",c=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function u(t){var e=0|t;return t>0||t===e?e:e-1}function h(t){for(var e,r,n=1,i=t.length,a=t[0]+"";n<i;){for(r=14-(e=t[n++]+"").length;r--;e="0"+e);a+=e}for(i=a.length;48===a.charCodeAt(--i););return a.slice(0,i+1||1)}function f(t,e){var r,n,i=t.c,a=e.c,o=t.s,s=e.s,l=t.e,c=e.e;if(!o||!s)return null;if(r=i&&!i[0],n=a&&!a[0],r||n)return r?n?0:-s:o;if(o!=s)return o;if(r=o<0,n=l==c,!i||!a)return n?0:!i^r?1:-1;if(!n)return l>c^r?1:-1;for(s=(l=i.length)<(c=a.length)?l:c,o=0;o<s;o++)if(i[o]!=a[o])return i[o]>a[o]^r?1:-1;return l==c?0:l>c^r?1:-1}function g(t,e,r,n){if(t<e||t>r||t!==o(t))throw Error(s+(n||"Argument")+("number"==typeof t?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function d(t){var e=t.c.length-1;return u(t.e/14)==e&&t.c[e]%2!=0}function p(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function y(t,e,r){var n,i;if(e<0){for(i=r+".";++e;i+=r);t=i+t}else if(n=t.length,++e>n){for(i=r,e-=n;--e;i+=r);t+=i}else e<n&&(t=t.slice(0,e)+"."+t.slice(e));return t}(n=function t(e){var r,n,w,b,m,v,_,E,T,S=M.prototype={constructor:M,toString:null,valueOf:null},x=new M(1),k=20,A=4,I=-7,C=21,O=-1e7,L=1e7,B=!1,N=1,U=0,R={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xa0",suffix:""},$="0123456789abcdefghijklmnopqrstuvwxyz",P=!0;function M(t,e){var r,n,a,s,c,u,h,f,d=this;if(!(d instanceof M))return new M(t,e);if(null==e){if(t&&!0===t._isBigNumber){d.s=t.s,!t.c||t.e>L?d.c=d.e=null:t.e<O?d.c=[d.e=0]:(d.e=t.e,d.c=t.c.slice());return}if((u="number"==typeof t)&&0*t==0){if(d.s=1/t<0?(t=-t,-1):1,t===~~t){for(s=0,c=t;c>=10;c/=10,s++);s>L?d.c=d.e=null:(d.e=s,d.c=[t]);return}f=String(t)}else{if(!i.test(f=String(t)))return T(d,f,u);d.s=45==f.charCodeAt(0)?(f=f.slice(1),-1):1}(s=f.indexOf("."))>-1&&(f=f.replace(".","")),(c=f.search(/e/i))>0?(s<0&&(s=c),s+=+f.slice(c+1),f=f.substring(0,c)):s<0&&(s=f.length)}else{if(g(e,2,$.length,"Base"),10==e&&P)return W(d=new M(t),k+d.e+1,A);if(f=String(t),u="number"==typeof t){if(0*t!=0)return T(d,f,u,e);if(d.s=1/t<0?(f=f.slice(1),-1):1,M.DEBUG&&f.replace(/^0\.0*|\./,"").length>15)throw Error(l+t)}else d.s=45===f.charCodeAt(0)?(f=f.slice(1),-1):1;for(r=$.slice(0,e),s=c=0,h=f.length;c<h;c++)if(0>r.indexOf(n=f.charAt(c))){if("."==n){if(c>s){s=h;continue}}else if(!a&&(f==f.toUpperCase()&&(f=f.toLowerCase())||f==f.toLowerCase()&&(f=f.toUpperCase()))){a=!0,c=-1,s=0;continue}return T(d,String(t),u,e)}u=!1,(s=(f=E(f,e,10,d.s)).indexOf("."))>-1?f=f.replace(".",""):s=f.length}for(c=0;48===f.charCodeAt(c);c++);for(h=f.length;48===f.charCodeAt(--h););if(f=f.slice(c,++h)){if(h-=c,u&&M.DEBUG&&h>15&&(t>9007199254740991||t!==o(t)))throw Error(l+d.s*t);if((s=s-c-1)>L)d.c=d.e=null;else if(s<O)d.c=[d.e=0];else{if(d.e=s,d.c=[],c=(s+1)%14,s<0&&(c+=14),c<h){for(c&&d.c.push(+f.slice(0,c)),h-=14;c<h;)d.c.push(+f.slice(c,c+=14));c=14-(f=f.slice(c)).length}else c-=h;for(;c--;f+="0");d.c.push(+f)}}else d.c=[d.e=0]}function D(t,e,r,n){var i,a,o,s,l;if(null==r?r=A:g(r,0,8),!t.c)return t.toString();if(i=t.c[0],o=t.e,null==e)l=h(t.c),l=1==n||2==n&&(o<=I||o>=C)?p(l,o):y(l,o,"0");else if(a=(t=W(new M(t),e,r)).e,s=(l=h(t.c)).length,1==n||2==n&&(e<=a||a<=I)){for(;s<e;l+="0",s++);l=p(l,a)}else if(e-=o,l=y(l,a,"0"),a+1>s){if(--e>0)for(l+=".";e--;l+="0");}else if((e+=a-s)>0)for(a+1==s&&(l+=".");e--;l+="0");return t.s<0&&i?"-"+l:l}function K(t,e){for(var r,n=1,i=new M(t[0]);n<t.length;n++)if((r=new M(t[n])).s)e.call(i,r)&&(i=r);else{i=r;break}return i}function j(t,e,r){for(var n=1,i=e.length;!e[--i];e.pop());for(i=e[0];i>=10;i/=10,n++);return(r=n+14*r-1)>L?t.c=t.e=null:r<O?t.c=[t.e=0]:(t.e=r,t.c=e),t}function W(t,e,r,n){var i,s,l,u,h,f,g,d=t.c;if(d){t:{for(i=1,u=d[0];u>=10;u/=10,i++);if((s=e-i)<0)s+=14,l=e,g=(h=d[f=0])/c[i-l-1]%10|0;else if((f=a((s+1)/14))>=d.length){if(n){for(;d.length<=f;d.push(0));h=g=0,i=1,s%=14,l=s-14+1}else break t}else{for(h=u=d[f],i=1;u>=10;u/=10,i++);s%=14,g=(l=s-14+i)<0?0:h/c[i-l-1]%10|0}if(n=n||e<0||null!=d[f+1]||(l<0?h:h%c[i-l-1]),n=r<4?(g||n)&&(0==r||r==(t.s<0?3:2)):g>5||5==g&&(4==r||n||6==r&&(s>0?l>0?h/c[i-l]:0:d[f-1])%10&1||r==(t.s<0?8:7)),e<1||!d[0])return d.length=0,n?(e-=t.e+1,d[0]=c[(14-e%14)%14],t.e=-e||0):d[0]=t.e=0,t;if(0==s?(d.length=f,u=1,f--):(d.length=f+1,u=c[14-s],d[f]=l>0?o(h/c[i-l]%c[l])*u:0),n)for(;;)if(0==f){for(s=1,l=d[0];l>=10;l/=10,s++);for(l=d[0]+=u,u=1;l>=10;l/=10,u++);s!=u&&(t.e++,1e14==d[0]&&(d[0]=1));break}else{if(d[f]+=u,1e14!=d[f])break;d[f--]=0,u=1}for(s=d.length;0===d[--s];d.pop());}t.e>L?t.c=t.e=null:t.e<O&&(t.c=[t.e=0])}return t}function F(t){var e,r=t.e;return null===r?t.toString():(e=h(t.c),e=r<=I||r>=C?p(e,r):y(e,r,"0"),t.s<0?"-"+e:e)}return M.clone=t,M.ROUND_UP=0,M.ROUND_DOWN=1,M.ROUND_CEIL=2,M.ROUND_FLOOR=3,M.ROUND_HALF_UP=4,M.ROUND_HALF_DOWN=5,M.ROUND_HALF_EVEN=6,M.ROUND_HALF_CEIL=7,M.ROUND_HALF_FLOOR=8,M.EUCLID=9,M.config=M.set=function(t){var e,r;if(null!=t){if("object"==typeof t){if(t.hasOwnProperty(e="DECIMAL_PLACES")&&(g(r=t[e],0,1e9,e),k=r),t.hasOwnProperty(e="ROUNDING_MODE")&&(g(r=t[e],0,8,e),A=r),t.hasOwnProperty(e="EXPONENTIAL_AT")&&((r=t[e])&&r.pop?(g(r[0],-1e9,0,e),g(r[1],0,1e9,e),I=r[0],C=r[1]):(g(r,-1e9,1e9,e),I=-(C=r<0?-r:r))),t.hasOwnProperty(e="RANGE")){if((r=t[e])&&r.pop)g(r[0],-1e9,-1,e),g(r[1],1,1e9,e),O=r[0],L=r[1];else if(g(r,-1e9,1e9,e),r)O=-(L=r<0?-r:r);else throw Error(s+e+" cannot be zero: "+r)}if(t.hasOwnProperty(e="CRYPTO")){if(!!(r=t[e])===r){if(r){if("u">typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))B=r;else throw B=!r,Error(s+"crypto unavailable")}else B=r}else throw Error(s+e+" not true or false: "+r)}if(t.hasOwnProperty(e="MODULO_MODE")&&(g(r=t[e],0,9,e),N=r),t.hasOwnProperty(e="POW_PRECISION")&&(g(r=t[e],0,1e9,e),U=r),t.hasOwnProperty(e="FORMAT")){if("object"==typeof(r=t[e]))R=r;else throw Error(s+e+" not an object: "+r)}if(t.hasOwnProperty(e="ALPHABET")){if("string"!=typeof(r=t[e])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(s+e+" invalid: "+r);P="0123456789"==r.slice(0,10),$=r}}else throw Error(s+"Object expected: "+t)}return{DECIMAL_PLACES:k,ROUNDING_MODE:A,EXPONENTIAL_AT:[I,C],RANGE:[O,L],CRYPTO:B,MODULO_MODE:N,POW_PRECISION:U,FORMAT:R,ALPHABET:$}},M.isBigNumber=function(t){if(!t||!0!==t._isBigNumber)return!1;if(!M.DEBUG)return!0;var e,r,n=t.c,i=t.e,a=t.s;t:if("[object Array]"==({}).toString.call(n)){if((1===a||-1===a)&&i>=-1e9&&i<=1e9&&i===o(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break t}if((e=(i+1)%14)<1&&(e+=14),String(n[0]).length==e){for(e=0;e<n.length;e++)if((r=n[e])<0||r>=1e14||r!==o(r))break t;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===a||1===a||-1===a))return!0;throw Error(s+"Invalid BigNumber: "+t)},M.maximum=M.max=function(){return K(arguments,S.lt)},M.minimum=M.min=function(){return K(arguments,S.gt)},M.random=(r=9007199254740992*Math.random()&2097151?function(){return o(9007199254740992*Math.random())}:function(){return(1073741824*Math.random()|0)*8388608+(8388608*Math.random()|0)},function(t){var e,n,i,l,u,h=0,f=[],d=new M(x);if(null==t?t=k:g(t,0,1e9),l=a(t/14),B){if(crypto.getRandomValues){for(e=crypto.getRandomValues(new Uint32Array(l*=2));h<l;)(u=131072*e[h]+(e[h+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),e[h]=n[0],e[h+1]=n[1]):(f.push(u%1e14),h+=2);h=l/2}else if(crypto.randomBytes){for(e=crypto.randomBytes(l*=7);h<l;)(u=(31&e[h])*281474976710656+1099511627776*e[h+1]+4294967296*e[h+2]+16777216*e[h+3]+(e[h+4]<<16)+(e[h+5]<<8)+e[h+6])>=9e15?crypto.randomBytes(7).copy(e,h):(f.push(u%1e14),h+=7);h=l/7}else throw B=!1,Error(s+"crypto unavailable")}if(!B)for(;h<l;)(u=r())<9e15&&(f[h++]=u%1e14);for(l=f[--h],t%=14,l&&t&&(u=c[14-t],f[h]=o(l/u)*u);0===f[h];f.pop(),h--);if(h<0)f=[i=0];else{for(i=-1;0===f[0];f.splice(0,1),i-=14);for(h=1,u=f[0];u>=10;u/=10,h++);h<14&&(i-=14-h)}return d.e=i,d.c=f,d}),M.sum=function(){for(var t=1,e=arguments,r=new M(e[0]);t<e.length;)r=r.plus(e[t++]);return r},E=function(){var t="0123456789";function e(t,e,r,n){for(var i,a,o=[0],s=0,l=t.length;s<l;){for(a=o.length;a--;o[a]*=e);for(o[0]+=n.indexOf(t.charAt(s++)),i=0;i<o.length;i++)o[i]>r-1&&(null==o[i+1]&&(o[i+1]=0),o[i+1]+=o[i]/r|0,o[i]%=r)}return o.reverse()}return function(r,n,i,a,o){var s,l,c,u,f,g,d,p,w=r.indexOf("."),b=k,m=A;for(w>=0&&(u=U,U=0,r=r.replace(".",""),g=(p=new M(n)).pow(r.length-w),U=u,p.c=e(y(h(g.c),g.e,"0"),10,i,t),p.e=p.c.length),c=u=(d=e(r,n,i,o?(s=$,t):(s=t,$))).length;0==d[--u];d.pop());if(!d[0])return s.charAt(0);if(w<0?--c:(g.c=d,g.e=c,g.s=a,d=(g=_(g,p,b,m,i)).c,f=g.r,c=g.e),w=d[l=c+b+1],u=i/2,f=f||l<0||null!=d[l+1],f=m<4?(null!=w||f)&&(0==m||m==(g.s<0?3:2)):w>u||w==u&&(4==m||f||6==m&&1&d[l-1]||m==(g.s<0?8:7)),l<1||!d[0])r=f?y(s.charAt(1),-b,s.charAt(0)):s.charAt(0);else{if(d.length=l,f)for(--i;++d[--l]>i;)d[l]=0,l||(++c,d=[1].concat(d));for(u=d.length;!d[--u];);for(w=0,r="";w<=u;r+=s.charAt(d[w++]));r=y(r,c,s.charAt(0))}return r}}(),_=function(){function t(t,e,r){var n,i,a,o,s=0,l=t.length,c=e%1e7,u=e/1e7|0;for(t=t.slice();l--;)n=u*(a=t[l]%1e7)+(o=t[l]/1e7|0)*c,s=((i=c*a+n%1e7*1e7+s)/r|0)+(n/1e7|0)+u*o,t[l]=i%r;return s&&(t=[s].concat(t)),t}function e(t,e,r,n){var i,a;if(r!=n)a=r>n?1:-1;else for(i=a=0;i<r;i++)if(t[i]!=e[i]){a=t[i]>e[i]?1:-1;break}return a}function r(t,e,r,n){for(var i=0;r--;)t[r]-=i,i=t[r]<e[r]?1:0,t[r]=i*n+t[r]-e[r];for(;!t[0]&&t.length>1;t.splice(0,1));}return function(n,i,a,s,l){var c,h,f,g,d,p,y,w,b,m,v,_,E,T,S,x,k,A=n.s==i.s?1:-1,I=n.c,C=i.c;if(!I||!I[0]||!C||!C[0])return new M(n.s&&i.s&&(I?!C||I[0]!=C[0]:C)?I&&0==I[0]||!C?0*A:A/0:NaN);for(b=(w=new M(A)).c=[],A=a+(h=n.e-i.e)+1,l||(l=1e14,h=u(n.e/14)-u(i.e/14),A=A/14|0),f=0;C[f]==(I[f]||0);f++);if(C[f]>(I[f]||0)&&h--,A<0)b.push(1),g=!0;else{for(T=I.length,x=C.length,f=0,A+=2,(d=o(l/(C[0]+1)))>1&&(C=t(C,d,l),I=t(I,d,l),x=C.length,T=I.length),E=x,v=(m=I.slice(0,x)).length;v<x;m[v++]=0);k=[0].concat(k=C.slice()),S=C[0],C[1]>=l/2&&S++;do{if(d=0,(c=e(C,m,x,v))<0){if(_=m[0],x!=v&&(_=_*l+(m[1]||0)),(d=o(_/S))>1)for(d>=l&&(d=l-1),y=(p=t(C,d,l)).length,v=m.length;1==e(p,m,y,v);)d--,r(p,x<y?k:C,y,l),y=p.length,c=1;else 0==d&&(c=d=1),y=(p=C.slice()).length;if(y<v&&(p=[0].concat(p)),r(m,p,v,l),v=m.length,-1==c)for(;1>e(C,m,x,v);)d++,r(m,x<v?k:C,v,l),v=m.length}else 0===c&&(d++,m=[0]);b[f++]=d,m[0]?m[v++]=I[E]||0:(m=[I[E]],v=1)}while((E++<T||null!=m[0])&&A--);g=null!=m[0],b[0]||b.splice(0,1)}if(1e14==l){for(f=1,A=b[0];A>=10;A/=10,f++);W(w,a+(w.e=f+14*h-1)+1,s,g)}else w.e=h,w.r=+g;return w}}(),n=/^(-?)0([xbo])(?=\w[\w.]*$)/i,w=/^([^.]+)\.$/,b=/^\.([^.]+)$/,m=/^-?(Infinity|NaN)$/,v=/^\s*\+(?=[\w.])|^\s+|\s+$/g,T=function(t,e,r,i){var a,o=r?e:e.replace(v,"");if(m.test(o))t.s=isNaN(o)?null:o<0?-1:1;else{if(!r&&(o=o.replace(n,function(t,e,r){return a="x"==(r=r.toLowerCase())?16:"b"==r?2:8,i&&i!=a?t:e}),i&&(a=i,o=o.replace(w,"$1").replace(b,"0.$1")),e!=o))return new M(o,a);if(M.DEBUG)throw Error(s+"Not a"+(i?" base "+i:"")+" number: "+e);t.s=null}t.c=t.e=null},S.absoluteValue=S.abs=function(){var t=new M(this);return t.s<0&&(t.s=1),t},S.comparedTo=function(t,e){return f(this,new M(t,e))},S.decimalPlaces=S.dp=function(t,e){var r,n,i;if(null!=t)return g(t,0,1e9),null==e?e=A:g(e,0,8),W(new M(this),t+this.e+1,e);if(!(r=this.c))return null;if(n=((i=r.length-1)-u(this.e/14))*14,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},S.dividedBy=S.div=function(t,e){return _(this,new M(t,e),k,A)},S.dividedToIntegerBy=S.idiv=function(t,e){return _(this,new M(t,e),0,1)},S.exponentiatedBy=S.pow=function(t,e){var r,n,i,l,c,u,h,f,g,p=this;if((t=new M(t)).c&&!t.isInteger())throw Error(s+"Exponent not an integer: "+F(t));if(null!=e&&(e=new M(e)),u=t.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!t.c||!t.c[0])return g=new M(Math.pow(+F(p),u?t.s*(2-d(t)):+F(t))),e?g.mod(e):g;if(h=t.s<0,e){if(e.c?!e.c[0]:!e.s)return new M(NaN);(n=!h&&p.isInteger()&&e.isInteger())&&(p=p.mod(e))}else{if(t.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||u&&p.c[1]>=24e7:p.c[0]<8e13||u&&p.c[0]<=9999975e7)))return l=p.s<0&&d(t)?-0:0,p.e>-1&&(l=1/l),new M(h?1/l:l);U&&(l=a(U/14+2))}for(u?(r=new M(.5),h&&(t.s=1),f=d(t)):f=(i=Math.abs(+F(t)))%2,g=new M(x);;){if(f){if(!(g=g.times(p)).c)break;l?g.c.length>l&&(g.c.length=l):n&&(g=g.mod(e))}if(i){if(0===(i=o(i/2)))break;f=i%2}else if(W(t=t.times(r),t.e+1,1),t.e>14)f=d(t);else{if(0==(i=+F(t)))break;f=i%2}p=p.times(p),l?p.c&&p.c.length>l&&(p.c.length=l):n&&(p=p.mod(e))}return n?g:(h&&(g=x.div(g)),e?g.mod(e):l?W(g,U,A,c):g)},S.integerValue=function(t){var e=new M(this);return null==t?t=A:g(t,0,8),W(e,e.e+1,t)},S.isEqualTo=S.eq=function(t,e){return 0===f(this,new M(t,e))},S.isFinite=function(){return!!this.c},S.isGreaterThan=S.gt=function(t,e){return f(this,new M(t,e))>0},S.isGreaterThanOrEqualTo=S.gte=function(t,e){return 1===(e=f(this,new M(t,e)))||0===e},S.isInteger=function(){return!!this.c&&u(this.e/14)>this.c.length-2},S.isLessThan=S.lt=function(t,e){return 0>f(this,new M(t,e))},S.isLessThanOrEqualTo=S.lte=function(t,e){return -1===(e=f(this,new M(t,e)))||0===e},S.isNaN=function(){return!this.s},S.isNegative=function(){return this.s<0},S.isPositive=function(){return this.s>0},S.isZero=function(){return!!this.c&&0==this.c[0]},S.minus=function(t,e){var r,n,i,a,o=this.s;if(e=(t=new M(t,e)).s,!o||!e)return new M(NaN);if(o!=e)return t.s=-e,this.plus(t);var s=this.e/14,l=t.e/14,c=this.c,h=t.c;if(!s||!l){if(!c||!h)return c?(t.s=-e,t):new M(h?this:NaN);if(!c[0]||!h[0])return h[0]?(t.s=-e,t):new M(c[0]?this:3==A?-0:0)}if(s=u(s),l=u(l),c=c.slice(),o=s-l){for((a=o<0)?(o=-o,i=c):(l=s,i=h),i.reverse(),e=o;e--;i.push(0));i.reverse()}else for(n=(a=(o=c.length)<(e=h.length))?o:e,o=e=0;e<n;e++)if(c[e]!=h[e]){a=c[e]<h[e];break}if(a&&(i=c,c=h,h=i,t.s=-t.s),(e=(n=h.length)-(r=c.length))>0)for(;e--;c[r++]=0);for(e=1e14-1;n>o;){if(c[--n]<h[n]){for(r=n;r&&!c[--r];c[r]=e);--c[r],c[n]+=1e14}c[n]-=h[n]}for(;0==c[0];c.splice(0,1),--l);return c[0]?j(t,c,l):(t.s=3==A?-1:1,t.c=[t.e=0],t)},S.modulo=S.mod=function(t,e){var r,n;return t=new M(t,e),this.c&&t.s&&(!t.c||t.c[0])?t.c&&(!this.c||this.c[0])?(9==N?(n=t.s,t.s=1,r=_(this,t,0,3),t.s=n,r.s*=n):r=_(this,t,0,N),(t=this.minus(r.times(t))).c[0]||1!=N||(t.s=this.s),t):new M(this):new M(NaN)},S.multipliedBy=S.times=function(t,e){var r,n,i,a,o,s,l,c,h,f,g,d,p,y=this.c,w=(t=new M(t,e)).c;if(!y||!w||!y[0]||!w[0])return this.s&&t.s&&(!y||y[0]||w)&&(!w||w[0]||y)?(t.s*=this.s,y&&w?(t.c=[0],t.e=0):t.c=t.e=null):t.c=t.e=t.s=null,t;for(n=u(this.e/14)+u(t.e/14),t.s*=this.s,(l=y.length)<(f=w.length)&&(p=y,y=w,w=p,i=l,l=f,f=i),i=l+f,p=[];i--;p.push(0));for(i=f;--i>=0;){for(r=0,g=w[i]%1e7,d=w[i]/1e7|0,o=l,a=i+o;a>i;)s=d*(c=y[--o]%1e7)+(h=y[o]/1e7|0)*g,r=((c=g*c+s%1e7*1e7+p[a]+r)/1e14|0)+(s/1e7|0)+d*h,p[a--]=c%1e14;p[a]=r}return r?++n:p.splice(0,1),j(t,p,n)},S.negated=function(){var t=new M(this);return t.s=-t.s||null,t},S.plus=function(t,e){var r,n=this.s;if(e=(t=new M(t,e)).s,!n||!e)return new M(NaN);if(n!=e)return t.s=-e,this.minus(t);var i=this.e/14,a=t.e/14,o=this.c,s=t.c;if(!i||!a){if(!o||!s)return new M(n/0);if(!o[0]||!s[0])return s[0]?t:new M(o[0]?this:0*n)}if(i=u(i),a=u(a),o=o.slice(),n=i-a){for(n>0?(a=i,r=s):(n=-n,r=o),r.reverse();n--;r.push(0));r.reverse()}for((n=o.length)-(e=s.length)<0&&(r=s,s=o,o=r,e=n),n=0;e;)n=(o[--e]=o[e]+s[e]+n)/1e14|0,o[e]=1e14===o[e]?0:o[e]%1e14;return n&&(o=[n].concat(o),++a),j(t,o,a)},S.precision=S.sd=function(t,e){var r,n,i;if(null!=t&&!!t!==t)return g(t,1,1e9),null==e?e=A:g(e,0,8),W(new M(this),t,e);if(!(r=this.c))return null;if(n=14*(i=r.length-1)+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return t&&this.e+1>n&&(n=this.e+1),n},S.shiftedBy=function(t){return g(t,-9007199254740991,9007199254740991),this.times("1e"+t)},S.squareRoot=S.sqrt=function(){var t,e,r,n,i,a=this.c,o=this.s,s=this.e,l=k+4,c=new M("0.5");if(1!==o||!a||!a[0])return new M(!o||o<0&&(!a||a[0])?NaN:a?this:1/0);if(0==(o=Math.sqrt(+F(this)))||o==1/0?(((e=h(a)).length+s)%2==0&&(e+="0"),o=Math.sqrt(+e),s=u((s+1)/2)-(s<0||s%2),e=o==1/0?"5e"+s:(e=o.toExponential()).slice(0,e.indexOf("e")+1)+s,r=new M(e)):r=new M(o+""),r.c[0]){for((o=(s=r.e)+l)<3&&(o=0);;)if(i=r,r=c.times(i.plus(_(this,i,l,1))),h(i.c).slice(0,o)===(e=h(r.c)).slice(0,o)){if(r.e<s&&--o,"9999"!=(e=e.slice(o-3,o+1))&&(n||"4999"!=e)){+e&&(+e.slice(1)||"5"!=e.charAt(0))||(W(r,r.e+k+2,1),t=!r.times(r).eq(this));break}if(!n&&(W(i,i.e+k+2,0),i.times(i).eq(this))){r=i;break}l+=4,o+=4,n=1}}return W(r,r.e+k+1,A,t)},S.toExponential=function(t,e){return null!=t&&(g(t,0,1e9),t++),D(this,t,e,1)},S.toFixed=function(t,e){return null!=t&&(g(t,0,1e9),t=t+this.e+1),D(this,t,e)},S.toFormat=function(t,e,r){var n;if(null==r)null!=t&&e&&"object"==typeof e?(r=e,e=null):t&&"object"==typeof t?(r=t,t=e=null):r=R;else if("object"!=typeof r)throw Error(s+"Argument not an object: "+r);if(n=this.toFixed(t,e),this.c){var i,a=n.split("."),o=+r.groupSize,l=+r.secondaryGroupSize,c=r.groupSeparator||"",u=a[0],h=a[1],f=this.s<0,g=f?u.slice(1):u,d=g.length;if(l&&(i=o,o=l,l=i,d-=i),o>0&&d>0){for(i=d%o||o,u=g.substr(0,i);i<d;i+=o)u+=c+g.substr(i,o);l>0&&(u+=c+g.slice(i)),f&&(u="-"+u)}n=h?u+(r.decimalSeparator||"")+((l=+r.fractionGroupSize)?h.replace(RegExp("\\d{"+l+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):h):u}return(r.prefix||"")+n+(r.suffix||"")},S.toFraction=function(t){var e,r,n,i,a,o,l,u,f,g,d,p,y=this.c;if(null!=t&&(!(l=new M(t)).isInteger()&&(l.c||1!==l.s)||l.lt(x)))throw Error(s+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+F(l));if(!y)return new M(this);for(e=new M(x),f=r=new M(x),n=u=new M(x),p=h(y),a=e.e=p.length-this.e-1,e.c[0]=c[(o=a%14)<0?14+o:o],t=!t||l.comparedTo(e)>0?a>0?e:f:l,o=L,L=1/0,l=new M(p),u.c[0]=0;g=_(l,e,0,1),1!=(i=r.plus(g.times(n))).comparedTo(t);)r=n,n=i,f=u.plus(g.times(i=f)),u=i,e=l.minus(g.times(i=e)),l=i;return i=_(t.minus(r),n,0,1),u=u.plus(i.times(f)),r=r.plus(i.times(n)),u.s=f.s=this.s,a*=2,d=1>_(f,n,a,A).minus(this).abs().comparedTo(_(u,r,a,A).minus(this).abs())?[f,n]:[u,r],L=o,d},S.toNumber=function(){return+F(this)},S.toPrecision=function(t,e){return null!=t&&g(t,1,1e9),D(this,t,e,2)},S.toString=function(t){var e,r=this,n=r.s,i=r.e;return null===i?n?(e="Infinity",n<0&&(e="-"+e)):e="NaN":(null==t?e=i<=I||i>=C?p(h(r.c),i):y(h(r.c),i,"0"):10===t&&P?e=y(h((r=W(new M(r),k+i+1,A)).c),r.e,"0"):(g(t,2,$.length,"Base"),e=E(y(h(r.c),i,"0"),10,t,n,!0)),n<0&&r.c[0]&&(e="-"+e)),e},S.valueOf=S.toJSON=function(){return F(this)},S._isBigNumber=!0,null!=e&&M.set(e),M}()).default=n.BigNumber=n,"function"==typeof define&&r.amdO?define(function(){return n}):"u">typeof e&&e.exports?e.exports=n:(t||(t="u">typeof self&&self?self:window),t.BigNumber=n)}(t)}),to=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=ta(),r=class{BigNum;constructor(){this.BigNum=(t,r)=>new(e.BigNumber.clone({DECIMAL_PLACES:r}))(t)}winstonToAr(t,{formatted:e=!1,decimals:r=12,trim:n=!0}={}){let i=this.stringToBigNum(t,r).shiftedBy(-12);return e?i.toFormat(r):i.toFixed(r)}arToWinston(t,{formatted:e=!1}={}){let r=this.stringToBigNum(t).shiftedBy(12);return e?r.toFormat():r.toFixed(0)}compare(t,e){let r=this.stringToBigNum(t),n=this.stringToBigNum(e);return r.comparedTo(n)}isEqual(t,e){return 0===this.compare(t,e)}isLessThan(t,e){let r=this.stringToBigNum(t),n=this.stringToBigNum(e);return r.isLessThan(n)}isGreaterThan(t,e){let r=this.stringToBigNum(t),n=this.stringToBigNum(e);return r.isGreaterThan(n)}add(t,e){let r=this.stringToBigNum(t);return this.stringToBigNum(e),r.plus(e).toFixed(0)}sub(t,e){let r=this.stringToBigNum(t);return this.stringToBigNum(e),r.minus(e).toFixed(0)}stringToBigNum(t,e=12){return this.BigNum(t,e)}};t.default=r}),ts=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=class{METHOD_GET="GET";METHOD_POST="POST";config;constructor(t){this.applyConfig(t)}applyConfig(t){this.config=this.mergeDefaults(t)}getConfig(){return this.config}mergeDefaults(t){let e=t.protocol||"http",r=t.port||("https"===e?443:80);return{host:t.host||"127.0.0.1",protocol:e,port:r,timeout:t.timeout||2e4,logging:t.logging||!1,logger:t.logger||console.log,network:t.network}}async get(t,e){return await this.request(t,{...e,method:this.METHOD_GET})}async post(t,e,r){let n=new Headers(r?.headers||{});return n.get("content-type")?.includes("application/json")||n.append("content-type","application/json"),n.append("accept","application/json, text/plain, */*"),await this.request(t,{...r,method:this.METHOD_POST,body:"string"!=typeof e?JSON.stringify(e):e,headers:n})}async request(t,e){let n=new Headers(e?.headers||{}),i=`${this.config.protocol}://${this.config.host}:${this.config.port}`,a=e?.responseType;delete e?.responseType,t.startsWith("/")&&(t=t.slice(1)),this.config.network&&n.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${i}/${t}`);let o=await fetch(`${i}/${t}`,{...e||{},headers:n});this.config.logging&&this.config.logger(`Response:   ${o.url} - ${o.status}`);let s=o.headers.get("content-type")?.match(/charset=([^()<>@,;:\"/[\]?.=\s]*)/i)?.[1],l=async()=>{if(s)try{o.data=new TextDecoder(s).decode(await o.arrayBuffer())}catch{o.data=await o.text()}else o.data=await o.text()};if("arraybuffer"===a)o.data=await o.arrayBuffer();else if("text"===a)await l();else if("webstream"===a)o.data=r(o.body);else try{let t=await o.clone().json();"object"!=typeof t?await l():o.data=await o.json(),t=null}catch{await l()}return o}};t.default=e;var r=t=>(typeof t[Symbol.asyncIterator]>"u"&&(t[Symbol.asyncIterator]=n(t)),t),n=function(t){return async function*(){let e=t.getReader();try{for(;;){let{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}}}}),tl=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0}),t.b64UrlDecode=t.b64UrlEncode=t.bufferTob64Url=t.bufferTob64=t.b64UrlToBuffer=t.stringToB64Url=t.stringToBuffer=t.bufferToString=t.b64UrlToString=t.concatBuffers=void 0;var e=_();function r(t){return new TextDecoder("utf-8",{fatal:!0}).decode(t)}function n(t){return new TextEncoder().encode(t)}function i(t){return new Uint8Array(e.toByteArray(l(t)))}function a(t){return e.fromByteArray(new Uint8Array(t))}function o(t){return s(a(t))}function s(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}function l(t){let e;return e=(t=t.replace(/\-/g,"+").replace(/\_/g,"/")).length%4==0?0:4-t.length%4,t.concat("=".repeat(e))}t.concatBuffers=function(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r].byteLength;let r=new Uint8Array(e),n=0;r.set(new Uint8Array(t[0]),n),n+=t[0].byteLength;for(let e=1;e<t.length;e++)r.set(new Uint8Array(t[e]),n),n+=t[e].byteLength;return r},t.b64UrlToString=function(t){return r(i(t))},t.bufferToString=r,t.stringToBuffer=n,t.stringToB64Url=function(t){return o(n(t))},t.b64UrlToBuffer=i,t.bufferTob64=a,t.bufferTob64Url=o,t.b64UrlEncode=s,t.b64UrlDecode=l}),tc=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=tl(),r=class{keyLength=4096;publicExponent=65537;hashAlgorithm="sha256";driver;constructor(){if(!this.detectWebCrypto())throw Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:r}={}){let n=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(n)}async hash(t,e="SHA-256"){let r=await this.driver.digest(e,t);return new Uint8Array(r)}async verify(t,e,r){let n=await this.jwkToPublicCryptoKey({kty:"RSA",e:"AQAB",n:t}),i=await this.driver.digest("SHA-256",e),a=await this.driver.verify({name:"RSA-PSS",saltLength:0},n,r,e),o=await this.driver.verify({name:"RSA-PSS",saltLength:32},n,r,e),s=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((n.algorithm.modulusLength-1)/8)-i.byteLength-2},n,r,e);return a||o||s}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let t=crypto?.subtle;return void 0!==t&&["generateKey","importKey","exportKey","digest","sign"].every(e=>"function"==typeof t[e])}async encrypt(t,r,n){let i=await this.driver.importKey("raw","string"==typeof r?e.stringToBuffer(r):r,{name:"PBKDF2",length:32},!1,["deriveKey"]),a=await this.driver.deriveKey({name:"PBKDF2",salt:n?e.stringToBuffer(n):e.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),o=new Uint8Array(16);crypto.getRandomValues(o);let s=await this.driver.encrypt({name:"AES-CBC",iv:o},a,t);return e.concatBuffers([o,s])}async decrypt(t,r,n){let i=await this.driver.importKey("raw","string"==typeof r?e.stringToBuffer(r):r,{name:"PBKDF2",length:32},!1,["deriveKey"]),a=await this.driver.deriveKey({name:"PBKDF2",salt:n?e.stringToBuffer(n):e.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),o=t.slice(0,16),s=await this.driver.decrypt({name:"AES-CBC",iv:o},a,t.slice(16));return e.concatBuffers([s])}};t.default=r}),tu=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{api;constructor(t){this.api=t}getInfo(){return this.api.get("info").then(t=>t.data)}getPeers(){return this.api.get("peers").then(t=>t.data)}}}),th=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0}),t.getError=void 0;var e=class extends Error{type;response;constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.response=e.response}getType(){return this.type}};t.default=e,t.getError=function(t){let e=t.data;if("string"==typeof t.data)try{e=JSON.parse(t.data)}catch{}if(t.data instanceof ArrayBuffer||t.data instanceof Uint8Array)try{e=JSON.parse(e.toString())}catch{}return e?e.error||e:t.statusText||"unknown"}}),tf=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=tE();async function r(t){if(Array.isArray(t)){let r=e.default.utils.concatBuffers([e.default.utils.stringToBuffer("list"),e.default.utils.stringToBuffer(t.length.toString())]);return await n(t,await e.default.crypto.hash(r,"SHA-384"))}let r=e.default.utils.concatBuffers([e.default.utils.stringToBuffer("blob"),e.default.utils.stringToBuffer(t.byteLength.toString())]),i=e.default.utils.concatBuffers([await e.default.crypto.hash(r,"SHA-384"),await e.default.crypto.hash(t,"SHA-384")]);return await e.default.crypto.hash(i,"SHA-384")}async function n(t,i){if(t.length<1)return i;let a=e.default.utils.concatBuffers([i,await r(t[0])]),o=await e.default.crypto.hash(a,"SHA-384");return await n(t.slice(1),o)}t.default=r}),tg=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.validatePath=t.arrayCompare=t.bufferToInt=t.intToBuffer=t.arrayFlatten=t.generateProofs=t.buildLayers=t.generateTransactionChunks=t.generateTree=t.computeRootHash=t.generateLeaves=t.chunkData=t.MIN_CHUNK_SIZE=t.MAX_CHUNK_SIZE=void 0;var e=tE(),r=tl();async function n(r){let n=[],i=r,a=0;for(;i.byteLength>=t.MAX_CHUNK_SIZE;){let r=t.MAX_CHUNK_SIZE,o=i.byteLength-t.MAX_CHUNK_SIZE;o>0&&o<t.MIN_CHUNK_SIZE&&(r=Math.ceil(i.byteLength/2));let s=i.slice(0,r),l=await e.default.crypto.hash(s);a+=s.byteLength,n.push({dataHash:l,minByteRange:a-s.byteLength,maxByteRange:a}),i=i.slice(r)}return n.push({dataHash:await e.default.crypto.hash(i),minByteRange:a,maxByteRange:a+i.byteLength}),n}async function i(t){return Promise.all(t.map(async({dataHash:t,minByteRange:e,maxByteRange:r})=>({type:"leaf",id:await g(await Promise.all([g(t),g(d(r))])),dataHash:t,minByteRange:e,maxByteRange:r})))}async function a(t){return(await o(t)).id}async function o(t){return await c(await i(await n(t)))}async function l(t){let e=await n(t),r=await i(e),a=await c(r),o=await u(a),s=e.slice(-1)[0];return s.maxByteRange-s.minByteRange==0&&(e.splice(e.length-1,1),o.splice(o.length-1,1)),{data_root:a.id,chunks:e,proofs:o}}async function c(t,e=0){if(t.length<2)return t[0];let r=[];for(let e=0;e<t.length;e+=2)r.push(await f(t[e],t[e+1]));return c(r,e+1)}function u(t){let e=function t(e,n=new Uint8Array,i=0){if("leaf"==e.type)return{offset:e.maxByteRange-1,proof:(0,r.concatBuffers)([n,e.dataHash,d(e.maxByteRange)])};if("branch"==e.type){let a=(0,r.concatBuffers)([n,e.leftChild.id,e.rightChild.id,d(e.byteRange)]);return[t(e.leftChild,a,i+1),t(e.rightChild,a,i+1)]}throw Error("Unexpected node type")}(t);return Array.isArray(e)?h(e):[e]}function h(t){let e=[];return t.forEach(t=>{Array.isArray(t)?e.push(...h(t)):e.push(t)}),e}async function f(t,e){return e?{type:"branch",id:await g([await g(t.id),await g(e.id),await g(d(t.maxByteRange))]),byteRange:t.maxByteRange,maxByteRange:e.maxByteRange,leftChild:t,rightChild:e}:t}async function g(t){return Array.isArray(t)&&(t=e.default.utils.concatBuffers(t)),new Uint8Array(await e.default.crypto.hash(t))}function d(t){let e=new Uint8Array(32);for(var r=e.length-1;r>=0;r--){var n=t%256;e[r]=n,t=(t-n)/256}return e}function p(t){let e=0;for(var r=0;r<t.length;r++)e*=256,e+=t[r];return e}async function y(e,r,n,i,a){if(i<=0)return!1;if(r>=i)return y(e,0,i-1,i,a);if(r<0)return y(e,0,0,i,a);if(64==a.length){let r=a.slice(0,32),o=a.slice(r.length,r.length+32),s=await g([await g(r),await g(o)]);return!!(0,t.arrayCompare)(e,s)&&{offset:i-1,leftBound:n,rightBound:i,chunkSize:i-n}}let o=a.slice(0,32),s=a.slice(o.length,o.length+32),l=a.slice(o.length+s.length,o.length+s.length+32),c=p(l),u=a.slice(o.length+s.length+l.length),h=await g([await g(o),await g(s),await g(l)]);return!!(0,t.arrayCompare)(e,h)&&(r<c?await y(o,r,n,Math.min(i,c),u):await y(s,r,Math.max(n,c),i,u))}async function w(t,e=""){if(t.byteLength<1)return e;let r=t.slice(0,32),n=t.slice(r.length,r.length+32),i=t.slice(r.length+n.length,r.length+n.length+32),a=p(i);return w(t.slice(r.length+n.length+i.length),`${e}
${JSON.stringify(s.Buffer.from(r))},${JSON.stringify(s.Buffer.from(n))},${a} => ${JSON.stringify(await g([await g(r),await g(n),await g(i)]))}`)}t.MAX_CHUNK_SIZE=262144,t.MIN_CHUNK_SIZE=32768,t.chunkData=n,t.generateLeaves=i,t.computeRootHash=a,t.generateTree=o,t.generateTransactionChunks=l,t.buildLayers=c,t.generateProofs=u,t.arrayFlatten=h,t.intToBuffer=d,t.bufferToInt=p,t.arrayCompare=(t,e)=>t.every((t,r)=>e[r]===t),t.validatePath=y,t.debug=w}),td=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0}),t.Tag=void 0;var e=tl(),r=tf(),n=tg(),i=class{get(t,r){if(!Object.getOwnPropertyNames(this).includes(t))throw Error(`Field "${t}" is not a property of the Arweave Transaction class.`);if(this[t]instanceof Uint8Array)return r&&r.decode&&r.string?e.bufferToString(this[t]):r&&r.decode&&!r.string?this[t]:e.bufferTob64Url(this[t]);if(this[t]instanceof Array){if(r?.decode!==void 0||r?.string!==void 0)throw"tags"===t&&console.warn("Did you mean to use 'transaction[\"tags\"]' ?"),Error("Cannot decode or stringify an array.");return this[t]}return r&&!0==r.decode?r&&r.string?e.b64UrlToString(this[t]):e.b64UrlToBuffer(this[t]):this[t]}},a=class extends i{name;value;constructor(t,e,r=!1){super(),this.name=t,this.value=e}};t.Tag=a;var o=class extends i{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(t={}){super(),Object.assign(this,t),"string"==typeof this.data&&(this.data=e.b64UrlToBuffer(this.data)),t.tags&&(this.tags=t.tags.map(t=>new a(t.name,t.value)))}addTag(t,r){this.tags.push(new a(e.stringToB64Url(t),e.stringToB64Url(r)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:e.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(t){this.owner=t}setSignature({id:t,owner:e,reward:r,tags:n,signature:i}){this.id=t,this.owner=e,r&&(this.reward=r),n&&(this.tags=n),this.signature=i}async prepareChunks(t){!this.chunks&&t.byteLength>0&&(this.chunks=await (0,n.generateTransactionChunks)(t),this.data_root=e.bufferTob64Url(this.chunks.data_root)),this.chunks||0!==t.byteLength||(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(t,r){if(!this.chunks)throw Error("Chunks have not been prepared");let n=this.chunks.proofs[t],i=this.chunks.chunks[t];return{data_root:this.data_root,data_size:this.data_size,data_path:e.bufferTob64Url(n.proof),offset:n.offset.toString(),chunk:e.bufferTob64Url(r.slice(i.minByteRange,i.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let t=this.tags.reduce((t,r)=>e.concatBuffers([t,r.get("name",{decode:!0,string:!1}),r.get("value",{decode:!0,string:!1})]),new Uint8Array);return e.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),e.stringToBuffer(this.quantity),e.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),t]);case 2:this.data_root||await this.prepareChunks(this.data);let n=this.tags.map(t=>[t.get("name",{decode:!0,string:!1}),t.get("value",{decode:!0,string:!1})]);return await (0,r.default)([e.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),e.stringToBuffer(this.quantity),e.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),n,e.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw Error(`Unexpected transaction format: ${this.format}`)}}};t.default=o}),tp=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionUploader=void 0;var e=td(),r=tl(),n=th(),i=tg(),a=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],o=class{api;chunkIndex=0;txPosted=!1;transaction;lastRequestTimeEnd=0;totalErrors=0;data;lastResponseStatus=0;lastResponseError="";get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}constructor(t,r){if(this.api=t,!r.id)throw Error("Transaction is not signed");if(!r.chunks)throw Error("Transaction chunks not prepared");this.data=r.data,this.transaction=new e.default(Object.assign({},r,{data:new Uint8Array(0)}))}async uploadChunk(t){if(this.isComplete)throw Error("Upload is already complete");if(""!==this.lastResponseError?this.totalErrors++:this.totalErrors=0,100===this.totalErrors)throw Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let e=""===this.lastResponseError?0:Math.max(this.lastRequestTimeEnd+4e4-Date.now(),4e4);if(e>0&&(e-=e*Math.random()*.3,await new Promise(t=>setTimeout(t,e))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}t&&(this.chunkIndex=t);let o=this.transaction.getChunk(t||this.chunkIndex,this.data);if(!await (0,i.validatePath)(this.transaction.chunks.data_root,parseInt(o.offset),0,parseInt(o.data_size),r.b64UrlToBuffer(o.data_path)))throw Error(`Unable to validate chunk ${this.chunkIndex}`);let s=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(t=>(console.error(t.message),{status:-1,data:{error:t.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=s.status,200==this.lastResponseStatus)this.chunkIndex++;else if(this.lastResponseError=(0,n.getError)(s),a.includes(this.lastResponseError))throw Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(t,r,n){if(!r||"number"!=typeof r.chunkIndex||"object"!=typeof r.transaction)throw Error("Serialized object does not match expected format.");var i=new e.default(r.transaction);i.chunks||await i.prepareChunks(n);let a=new o(t,i);if(a.chunkIndex=r.chunkIndex,a.lastRequestTimeEnd=r.lastRequestTimeEnd,a.lastResponseError=r.lastResponseError,a.lastResponseStatus=r.lastResponseStatus,a.txPosted=r.txPosted,a.data=n,a.transaction.data_root!==r.transaction.data_root)throw Error("Data mismatch: Uploader doesn't match provided data.");return a}static async fromTransactionId(t,e){let r=await t.get(`tx/${e}`);if(200!==r.status)throw Error(`Tx ${e} not found: ${r.status}`);let n=r.data;return n.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:n}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=1){this.transaction.data=this.data;let t=await this.api.post("tx",this.transaction).catch(t=>(console.error(t),{status:-1,data:{error:t.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=t.status,this.transaction.data=new Uint8Array(0),t.status>=200&&t.status<300){this.txPosted=!0,this.chunkIndex=1;return}throw this.lastResponseError=(0,n.getError)(t),Error(`Unable to upload transaction: ${t.status}, ${this.lastResponseError}`)}let t=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=t.status,!(t.status>=200&&t.status<300))throw this.lastResponseError=(0,n.getError)(t),Error(`Unable to upload transaction: ${t.status}, ${this.lastResponseError}`);this.txPosted=!0}};t.TransactionUploader=o}),ty=w((t,e)=>{x(),e.exports={}}),tw=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=th(),r=td(),n=tl(),i=tp();ty();var a=class{api;crypto;chunks;constructor(t,e,r){this.api=t,this.crypto=e,this.chunks=r}async getTransactionAnchor(){let t=await this.api.get("tx_anchor");if(!t.data.match(/^[a-z0-9_-]{43,}/i)||!t.ok)throw Error(`Could not getTransactionAnchor. Received: ${t.data}. Status: ${t.status}, ${t.statusText}`);return t.data}async getPrice(t,e){let r=e?`price/${t}/${e}`:`price/${t}`,n=await this.api.get(r);if(!/^\d+$/.test(n.data)||!n.ok)throw Error(`Could not getPrice. Received: ${n.data}. Status: ${n.status}, ${n.statusText}`);return n.data}async get(t){let n=await this.api.get(`tx/${t}`);if(200==n.status){let e=parseInt(n.data.data_size);if(n.data.format>=2&&e>0&&e<=12582912){let e=await this.getData(t);return new r.default({...n.data,data:e})}return new r.default({...n.data,format:n.data.format||1})}throw new e.default(404==n.status?"TX_NOT_FOUND":410==n.status?"TX_FAILED":"TX_INVALID")}fromRaw(t){return new r.default(t)}async search(t,e){return this.api.post("arql",{op:"equals",expr1:t,expr2:e}).then(t=>t.data?t.data:[])}getStatus(t){return this.api.get(`tx/${t}/status`).then(t=>200==t.status?{status:200,confirmed:t.data}:{status:t.status,confirmed:null})}async getData(t,e){let r;try{r=await this.chunks.downloadChunkedData(t)}catch(e){console.error(`Error while trying to download chunked data for ${t}`),console.error(e)}if(!r){console.warn(`Falling back to gateway cache for ${t}`);try{let{data:e,ok:n,status:i,statusText:a}=await this.api.get(`/${t}`,{responseType:"arraybuffer"});if(!n)throw Error("Bad http status code",{cause:{status:i,statusText:a}});r=e}catch(e){console.error(`Error while trying to download contiguous data from gateway cache for ${t}`),console.error(e)}}if(!r)throw Error(`${t} data was not found!`);return e&&e.decode&&!e.string?r:e&&e.decode&&e.string?n.bufferToString(r):n.bufferTob64Url(r)}async sign(t,e,r){let i;let a="object"==typeof e&&(i=!0,["n","e","d","p","q","dp","dq","qi"].map(t=>!(t in e)&&(i=!1)),i),o="object"==typeof arweaveWallet;if(!a&&!o)throw Error("No valid JWK or external wallet found to sign transaction.");if(o){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}let e=await arweaveWallet.sign(t,r);t.setSignature({id:e.id,owner:e.owner,reward:e.reward,tags:e.tags,signature:e.signature})}else if(a){t.setOwner(e.n);let i=await t.getSignatureData(),a=await this.crypto.sign(e,i,r),o=await this.crypto.hash(a);t.setSignature({id:n.bufferTob64Url(o),owner:e.n,signature:n.bufferTob64Url(a)})}else throw Error("An error occurred while signing. Check wallet is valid")}async verify(t){let e=await t.getSignatureData(),r=t.get("signature",{decode:!0,string:!1}),i=n.bufferTob64Url(await this.crypto.hash(r));if(t.id!==i)throw Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(t.owner,e,r)}async post(t){if("string"==typeof t?t=new r.default(JSON.parse(t)):"function"==typeof t.readInt32BE?t=new r.default(JSON.parse(t.toString())):"object"!=typeof t||t instanceof r.default||(t=new r.default(t)),!(t instanceof r.default))throw Error("Must be Transaction object");t.chunks||await t.prepareChunks(t.data);let e=await this.getUploader(t,t.data);try{for(;!e.isComplete;)await e.uploadChunk()}catch(t){if(e.lastResponseStatus>0)return{status:e.lastResponseStatus,statusText:e.lastResponseError,data:{error:e.lastResponseError}};throw t}return{status:200,statusText:"OK",data:{}}}async getUploader(t,e){let n;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t instanceof r.default){if(e||(e=t.data),!(e instanceof Uint8Array))throw Error("Data format is invalid");t.chunks||await t.prepareChunks(e),(n=new i.TransactionUploader(this.api,t)).data&&0!==n.data.length||(n.data=e)}else{if("string"==typeof t&&(t=await i.TransactionUploader.fromTransactionId(this.api,t)),!e||!(e instanceof Uint8Array))throw Error("Must provide data when resuming upload");n=await i.TransactionUploader.fromSerialized(this.api,t,e)}return n}async *upload(t,e){let r=await this.getUploader(t,e);for(;!r.isComplete;)await r.uploadChunk(),yield r;return r}};t.default=a}),tb=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=tl();ty();var r=class{api;crypto;constructor(t,e){this.api=t,this.crypto=e}getBalance(t){return this.api.get(`wallet/${t}/balance`).then(t=>t.data)}getLastTransactionID(t){return this.api.get(`wallet/${t}/last_tx`).then(t=>t.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(t){return t&&"use_wallet"!==t?this.getAddress(t):this.getAddress()}async getAddress(t){if(t&&"use_wallet"!==t)return this.ownerToAddress(t.n);try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}async ownerToAddress(t){return e.bufferTob64Url(await this.crypto.hash(e.b64UrlToBuffer(t)))}};t.default=r}),tm=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0}),t.SiloResource=void 0;var e=tl(),r=class{api;crypto;transactions;constructor(t,e,r){this.api=t,this.crypto=e,this.transactions=r}async get(t){if(!t)throw Error("No Silo URI specified");let e=await this.parseUri(t),r=await this.transactions.search("Silo-Name",e.getAccessKey());if(0==r.length)throw Error(`No data could be found for the Silo URI: ${t}`);let n=await this.transactions.get(r[0]);if(!n)throw Error(`No data could be found for the Silo URI: ${t}`);let i=n.get("data",{decode:!0,string:!1});return this.crypto.decrypt(i,e.getEncryptionKey())}async readTransactionData(t,e){if(!e)throw Error("No Silo URI specified");let r=await this.parseUri(e),n=t.get("data",{decode:!0,string:!1});return this.crypto.decrypt(n,r.getEncryptionKey())}async parseUri(t){let r=t.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!r)throw Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");let i=r[1],a=Math.pow(2,parseInt(r[2])),o=await this.hash(e.stringToBuffer(i),a),s=e.bufferTob64(o.slice(0,15)),l=await this.hash(o.slice(16,31),1);return new n(t,s,l)}async hash(t,e){let r=await this.crypto.hash(t);for(let t=0;t<e-1;t++)r=await this.crypto.hash(r);return r}};t.default=r;var n=class{uri;accessKey;encryptionKey;constructor(t,e,r){this.uri=t,this.accessKey=e,this.encryptionKey=r}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}};t.SiloResource=n}),tv=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=th(),r=tl(),n=class{api;constructor(t){this.api=t}async getTransactionOffset(t){let r=await this.api.get(`tx/${t}/offset`);if(200===r.status)return r.data;throw Error(`Unable to get transaction offset: ${(0,e.getError)(r)}`)}async getChunk(t){let r=await this.api.get(`chunk/${t}`);if(200===r.status)return r.data;throw Error(`Unable to get chunk: ${(0,e.getError)(r)}`)}async getChunkData(t){let e=await this.getChunk(t);return r.b64UrlToBuffer(e.chunk)}firstChunkOffset(t){return parseInt(t.offset)-parseInt(t.size)+1}async downloadChunkedData(t){let e=await this.getTransactionOffset(t),r=parseInt(e.size),n=parseInt(e.offset)-r+1,i=new Uint8Array(r),a=0;for(;a<r;){let t;this.api.config.logging&&console.log(`[chunk] ${a}/${r}`);try{t=await this.getChunkData(n+a)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${n+a}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(t)i.set(t,a),a+=t.length;else throw Error(`Couldn't complete data download at ${a}/${r}`)}return i}};t.default=n}),t_=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=th();ty();var r=class{api;network;constructor(t,e){this.api=t,this.network=e}async get(t){let n=await this.api.get(`${r.ENDPOINT}${t}`);if(200===n.status)return n.data;throw 404===n.status?new e.default("BLOCK_NOT_FOUND"):Error(`Error while loading block data: ${n}`)}async getCurrent(){let{current:t}=await this.network.getInfo();return await this.get(t)}};v(r,"ENDPOINT","block/hash/"),t.default=r}),tE=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0});var e=to(),r=ts(),n=tc(),i=tu(),a=tw(),o=tb(),s=td(),l=tl(),c=tm(),u=tv(),h=t_(),f=class{api;wallets;transactions;network;blocks;ar;silo;chunks;constructor(t){this.api=new r.default(t),this.wallets=new o.default(this.api,f.crypto),this.chunks=new u.default(this.api),this.transactions=new a.default(this.api,f.crypto,this.chunks),this.silo=new c.default(this.api,this.crypto,this.transactions),this.network=new i.default(this.api),this.blocks=new h.default(this.api,this.network),this.ar=new e.default}get crypto(){return f.crypto}get utils(){return f.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(t,e){let r={};if(Object.assign(r,t),!t.data&&!(t.target&&t.quantity))throw Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(null==t.owner&&e&&"use_wallet"!==e&&(r.owner=e.n),null==t.last_tx&&(r.last_tx=await this.transactions.getTransactionAnchor()),"string"==typeof t.data&&(t.data=l.stringToBuffer(t.data)),t.data instanceof ArrayBuffer&&(t.data=new Uint8Array(t.data)),t.data&&!(t.data instanceof Uint8Array))throw Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(null==t.reward){let e=t.data?t.data.byteLength:0;r.reward=await this.transactions.getPrice(e,r.target)}r.data_root="",r.data_size=t.data?t.data.byteLength.toString():"0",r.data=t.data||new Uint8Array(0);let n=new s.default(r);return await n.getSignatureData(),n}async createSiloTransaction(t,e,r){let n={};if(Object.assign(n,t),!t.data)throw Error("Silo transactions must have a 'data' value");if(!r)throw Error("No Silo URI specified.");if(t.target||t.quantity)throw Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(null==t.owner){if(!e||!e.n)throw Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");n.owner=e.n}null==t.last_tx&&(n.last_tx=await this.transactions.getTransactionAnchor());let i=await this.silo.parseUri(r);if("string"==typeof t.data){let e=await this.crypto.encrypt(l.stringToBuffer(t.data),i.getEncryptionKey());n.reward=await this.transactions.getPrice(e.byteLength),n.data=l.bufferTob64Url(e)}if(t.data instanceof Uint8Array){let e=await this.crypto.encrypt(t.data,i.getEncryptionKey());n.reward=await this.transactions.getPrice(e.byteLength),n.data=l.bufferTob64Url(e)}let a=new s.default(n);return a.addTag("Silo-Name",i.getAccessKey()),a.addTag("Silo-Version","0.1.0"),a}arql(t){return this.api.post("/arql",t).then(t=>t.data||[])}};v(f,"init"),v(f,"crypto",new n.default),v(f,"utils",l),t.default=f}),tT=w(t=>{x(),Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultConfig=void 0;var e=(t,e)=>{let r=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,n=e.split("."),i=n[n.length-1],a=["localhost","[::1]"];return a.includes(e)||"file"==t||a.includes(i)||!!e.match(r)||!!i.match(r)},r=t=>{let e="["===t.charAt(0);return!!t.match(/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/)||e};t.getDefaultConfig=(t,n)=>{if(e(t,n))return{protocol:"https",host:"arweave.net",port:443};if(!r(n)){let e=n.split(".");if(e.length>=3)return e.shift(),{protocol:t,host:e.join(".")}}return{protocol:t,host:n}}}),tS=w(t=>{x();var e=t&&t.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=t&&t.__exportStar||function(t,r){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0});var n=tE(),i=tT();n.default.init=function(t={}){if("object"!=typeof location||!location.protocol||!location.hostname)return new n.default({...t,host:"arweave.net",port:443,protocol:"https"});let e=location.protocol.replace(":",""),r=location.hostname,a=location.port?parseInt(location.port):"https"==e?443:80,o=(0,i.getDefaultConfig)(e,r),s=t.protocol||o.protocol,l=t.host||o.host,c=t.port||o.port||a;return new n.default({...t,host:l,protocol:s,port:c})},"object"==typeof globalThis?globalThis.Arweave=n.default:"object"==typeof self&&(self.Arweave=n.default),r(tE(),t),t.default=n.default}),tx=w((t,e)=>{x();var{hasOwnProperty:r}=Object.prototype,n=y();n.configure=y,n.stringify=n,n.default=n,t.stringify=n,t.configure=y,e.exports=n;var i=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/,a=RegExp(i,"g"),o=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000b","\\f","\\r","\\u000e","\\u000f","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001a","\\u001b","\\u001c","\\u001d","\\u001e","\\u001f","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\"];function s(t){if(2===t.length)return`${t[0]}\\u${t.charCodeAt(1).toString(16)}`;let e=t.charCodeAt(0);return o.length>e?o[e]:`\\u${e.toString(16)}`}function l(t){if(t.length<5e3&&!i.test(t))return t;if(t.length>100)return t.replace(a,s);let e="",r=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);if(34===i||92===i||i<32)e+=`${t.slice(r,n)}${o[i]}`,r=n+1;else if(i>=55296&&i<=57343){if(i<=56319&&n+1<t.length){let e=t.charCodeAt(n+1);if(e>=56320&&e<=57343){n++;continue}}e+=`${t.slice(r,n)}\\u${i.toString(16)}`,r=n+1}}return e+t.slice(r)}function c(t){if(t.length>200)return t.sort();for(let e=1;e<t.length;e++){let r=t[e],n=e;for(;0!==n&&t[n-1]>r;)t[n]=t[n-1],n--;t[n]=r}return t}var u=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function h(t){return void 0!==u.call(t)&&0!==t.length}function f(t,e,r){t.length<r&&(r=t.length);let n=","===e?"":" ",i=`"0":${n}${t[0]}`;for(let a=1;a<r;a++)i+=`${e}"${a}":${n}${t[a]}`;return i}function g(t,e){let n;if(r.call(t,e)&&"boolean"!=typeof(n=t[e]))throw TypeError(`The "${e}" argument must be of type boolean`);return void 0===n||n}function d(t,e){let n;if(r.call(t,e)){if("number"!=typeof(n=t[e]))throw TypeError(`The "${e}" argument must be of type number`);if(!Number.isInteger(n))throw TypeError(`The "${e}" argument must be an integer`);if(n<1)throw RangeError(`The "${e}" argument must be >= 1`)}return void 0===n?1/0:n}function p(t){return 1===t?"1 item":`${t} items`}function y(t){let e=function(t){if(r.call(t,"strict")){let e=t.strict;if("boolean"!=typeof e)throw TypeError('The "strict" argument must be of type boolean');if(e)return t=>{let e=`Object can not safely be stringified. Received type ${typeof t}`;throw"function"!=typeof t&&(e+=` (${t.toString()})`),Error(e)}}}(t={...t});e&&(void 0===t.bigint&&(t.bigint=!1),"circularValue"in t||(t.circularValue=Error));let n=function(t){if(r.call(t,"circularValue")){let e=t.circularValue;if("string"==typeof e)return`"${e}"`;if(null==e)return e;if(e===Error||e===TypeError)return{toString(){throw TypeError("Converting circular structure to JSON")}};throw TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}(t),i=g(t,"bigint"),a=g(t,"deterministic"),o=d(t,"maximumDepth"),s=d(t,"maximumBreadth");return function(t,r,u){if(arguments.length>1){let g="";if("number"==typeof u?g=" ".repeat(Math.min(u,10)):"string"==typeof u&&(g=u.slice(0,10)),null!=r){if("function"==typeof r)return function t(r,u,g,d,y,w){let b=u[r];switch("object"==typeof b&&null!==b&&"function"==typeof b.toJSON&&(b=b.toJSON(r)),typeof(b=d.call(u,r,b))){case"string":return`"${l(b)}"`;case"object":{if(null===b)return"null";if(-1!==g.indexOf(b))return n;let e="",r=",",i=w;if(Array.isArray(b)){if(0===b.length)return"[]";if(o<g.length+1)return'"[Array]"';g.push(b),""!==y&&(w+=y,e+=`
${w}`,r=`,
${w}`);let n=Math.min(b.length,s),a=0;for(;a<n-1;a++){let n=t(a,b,g,d,y,w);e+=(void 0!==n?n:"null")+r}let l=t(a,b,g,d,y,w);return e+=void 0!==l?l:"null",b.length-1>s&&(e+=`${r}"... ${p(b.length-s-1)} not stringified"`),""!==y&&(e+=`
${i}`),g.pop(),`[${e}]`}let u=Object.keys(b),m=u.length;if(0===m)return"{}";if(o<g.length+1)return'"[Object]"';let v="",_="";""!==y&&(w+=y,r=`,
${w}`,v=" ");let E=Math.min(m,s);h(b)&&(e+=f(b,r,s),u=u.slice(b.length),E-=b.length,_=r),a&&(u=c(u)),g.push(b);for(let n=0;n<E;n++){let i=u[n],a=t(i,b,g,d,y,w);void 0!==a&&(e+=`${_}"${l(i)}":${v}${a}`,_=r)}return m>s&&(e+=`${_}"...":${v}"${p(m-s)} not stringified"`,_=r),""!==y&&_.length>1&&(e=`
${w}${e}
${i}`),g.pop(),`{${e}}`}case"number":return isFinite(b)?String(b):e?e(b):"null";case"boolean":return!0===b?"true":"false";case"undefined":return;case"bigint":if(i)return String(b);default:return e?e(b):void 0}}("",{"":t},[],r,g,"");if(Array.isArray(r))return function t(r,a,c,u,h,f){switch("object"==typeof a&&null!==a&&"function"==typeof a.toJSON&&(a=a.toJSON(r)),typeof a){case"string":return`"${l(a)}"`;case"object":{if(null===a)return"null";if(-1!==c.indexOf(a))return n;let e=f,r="",i=",";if(Array.isArray(a)){if(0===a.length)return"[]";if(o<c.length+1)return'"[Array]"';c.push(a),""!==h&&(f+=h,r+=`
${f}`,i=`,
${f}`);let n=Math.min(a.length,s),l=0;for(;l<n-1;l++){let e=t(l,a[l],c,u,h,f);r+=(void 0!==e?e:"null")+i}let g=t(l,a[l],c,u,h,f);return r+=void 0!==g?g:"null",a.length-1>s&&(r+=`${i}"... ${p(a.length-s-1)} not stringified"`),""!==h&&(r+=`
${e}`),c.pop(),`[${r}]`}if(0===u.size)return"{}";c.push(a);let g="";""!==h&&(f+=h,i=`,
${f}`,g=" ");let d="";for(let e of u){let n=t(e,a[e],c,u,h,f);void 0!==n&&(r+=`${d}"${l(e)}":${g}${n}`,d=i)}return""!==h&&d.length>1&&(r=`
${f}${r}
${e}`),c.pop(),`{${r}}`}case"number":return isFinite(a)?String(a):e?e(a):"null";case"boolean":return!0===a?"true":"false";case"undefined":return;case"bigint":if(i)return String(a);default:return e?e(a):void 0}}("",t,[],function(t){let e=new Set;for(let r of t)("string"==typeof r||"number"==typeof r)&&e.add(String(r));return e}(r),g,"")}if(0!==g.length)return function t(r,u,g,d,y){switch(typeof u){case"string":return`"${l(u)}"`;case"object":{if(null===u)return"null";if("function"==typeof u.toJSON){if("object"!=typeof(u=u.toJSON(r)))return t(r,u,g,d,y);if(null===u)return"null"}if(-1!==g.indexOf(u))return n;let e=y;if(Array.isArray(u)){if(0===u.length)return"[]";if(o<g.length+1)return'"[Array]"';g.push(u);let r=`
${y+=d}`,n=`,
${y}`,i=Math.min(u.length,s),a=0;for(;a<i-1;a++){let e=t(a,u[a],g,d,y);r+=(void 0!==e?e:"null")+n}let l=t(a,u[a],g,d,y);return r+=void 0!==l?l:"null",u.length-1>s&&(r+=`${n}"... ${p(u.length-s-1)} not stringified"`),r+=`
${e}`,g.pop(),`[${r}]`}let i=Object.keys(u),w=i.length;if(0===w)return"{}";if(o<g.length+1)return'"[Object]"';let b=`,
${y+=d}`,m="",v="",_=Math.min(w,s);h(u)&&(m+=f(u,b,s),i=i.slice(u.length),_-=u.length,v=b),a&&(i=c(i)),g.push(u);for(let e=0;e<_;e++){let r=i[e],n=t(r,u[r],g,d,y);void 0!==n&&(m+=`${v}"${l(r)}": ${n}`,v=b)}return w>s&&(m+=`${v}"...": "${p(w-s)} not stringified"`,v=b),""!==v&&(m=`
${y}${m}
${e}`),g.pop(),`{${m}}`}case"number":return isFinite(u)?String(u):e?e(u):"null";case"boolean":return!0===u?"true":"false";case"undefined":return;case"bigint":if(i)return String(u);default:return e?e(u):void 0}}("",t,[],g,"")}return function t(r,u,g){switch(typeof u){case"string":return`"${l(u)}"`;case"object":{if(null===u)return"null";if("function"==typeof u.toJSON){if("object"!=typeof(u=u.toJSON(r)))return t(r,u,g);if(null===u)return"null"}if(-1!==g.indexOf(u))return n;let e="";if(Array.isArray(u)){if(0===u.length)return"[]";if(o<g.length+1)return'"[Array]"';g.push(u);let r=Math.min(u.length,s),n=0;for(;n<r-1;n++){let r=t(n,u[n],g);e+=(void 0!==r?r:"null")+","}let i=t(n,u[n],g);return e+=void 0!==i?i:"null",u.length-1>s&&(e+=`,"... ${p(u.length-s-1)} not stringified"`),g.pop(),`[${e}]`}let i=Object.keys(u),d=i.length;if(0===d)return"{}";if(o<g.length+1)return'"[Object]"';let y="",w=Math.min(d,s);h(u)&&(e+=f(u,",",s),i=i.slice(u.length),w-=u.length,y=","),a&&(i=c(i)),g.push(u);for(let r=0;r<w;r++){let n=i[r],a=t(n,u[n],g);void 0!==a&&(e+=`${y}"${l(n)}":${a}`,y=",")}return d>s&&(e+=`${y}"...":"${p(d-s)} not stringified"`),g.pop(),`{${e}}`}case"number":return isFinite(u)?String(u):e?e(u):"null";case"boolean":return!0===u?"true":"false";case"undefined":return;case"bigint":if(i)return String(u);default:return e?e(u):void 0}}("",t,[])}}});x(),x(),x();var tk={silly:0,trace:1,debug:2,info:3,warn:4,error:5,fatal:6,none:7},tA=class{constructor(t,e){this.moduleName=t,this.settings=e}trace(t,...e){this.shouldLog("trace")&&console.debug(this.message("trace",t),e)}error(t,...e){this.shouldLog("error")&&console.error(this.message("error",t),e)}info(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}silly(t,...e){this.shouldLog("silly")&&console.debug(this.message("silly",t),e)}debug(t,...e){this.shouldLog("debug")&&console.debug(this.message("debug",t),e)}warn(t,...e){this.shouldLog("warn")&&console.warn(this.message("warn",t),e)}log(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}fatal(t,...e){this.shouldLog("fatal")&&console.error(this.message("fatal",t),e)}shouldLog(t){return tk[t]>=tk[this.settings.minLevel]}setSettings(t){this.settings=t}message(t,e){return`${new Date().toISOString()} ${t.toUpperCase()} [${this.moduleName}] ${e}`}};x();var tI=class{registeredLoggers={};registeredOptions={};defOptions={minLevel:"info"};constructor(){this.setOptions=this.setOptions.bind(this),this.getOptions=this.getOptions.bind(this),this.create=this.create.bind(this),this.logLevel=this.logLevel.bind(this)}setOptions(t,e){e?this.registeredLoggers[e]?this.registeredLoggers[e].setSettings({...this.registeredLoggers[e].settings,...t}):this.registeredOptions[e]={...this.defOptions,...t}:(this.defOptions=t,Object.keys(this.registeredLoggers).forEach(e=>{this.registeredLoggers[e].setSettings({...this.registeredLoggers[e].settings,...t})}))}getOptions(t){return t?this.registeredLoggers[t]?this.registeredLoggers[t].settings:this.registeredOptions[t]?this.registeredOptions[t]:this.defOptions:this.defOptions}logLevel(t,e){this.setOptions({minLevel:t},e)}create(t="SWC"){return Object.prototype.hasOwnProperty.call(this.registeredLoggers,t)||(this.registeredLoggers[t]=new tA(t,this.getOptions(t))),this.registeredLoggers[t]}};x();var tC=class{constructor(){}setOptions(t,e){tC.INST.setOptions(t,e)}getOptions(t){return tC.INST.getOptions(t)}logLevel(t,e){tC.INST.logLevel(t,e)}create(t){return tC.INST.create(t)}static use(t){tC.INST=t}};v(tC,"INST",new tI),x();var tO=class{static measure(){return new tO}constructor(){}start=Date.now();end=null;reset(){this.start=Date.now(),this.end=null}stop(){this.end=Date.now()}elapsed(t=!1){null===this.end&&(this.end=Date.now());let e=this.end-this.start;return t?e:`${(this.end-this.start).toFixed(0)}ms`}};x();var tL=class{constructor(t,e){this.key=t,this.sortKey=e}},tB=class{constructor(t,e){this.sortKey=t,this.cachedValue=e}};x();var tN=m(te()),tU=m(tn()),tR=class{constructor(t,e=!1){this.value=t,this.tomb=e}},t$=class{constructor(t){this.cacheOptions=t,this.subLevelSeparator=t.subLevelSeparator||"!",this.subLevelOptions={valueEncoding:"json",separator:this.subLevelSeparator}}ongoingTransactionMark="$$warp-internal-transaction$$";logger=tC.INST.create("LevelDbCache");subLevelSeparator;subLevelOptions;_db;_rollbackBatch;get db(){if(!this._db){if(this.cacheOptions.inMemory)this._db=new tU.MemoryLevel(this.subLevelOptions);else{if(!this.cacheOptions.dbLocation)throw Error("LevelDb cache configuration error - no db location specified");let t=this.cacheOptions.dbLocation;this.logger.info(`Using location ${t}`),this._db=new tN.Level(t,this.subLevelOptions)}}return this._db}async get(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open();let n=await this.getValueFromLevel(t.sortKey,r);return n?new tB(t.sortKey,n):null}async getLast(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open();let r=await e.keys({reverse:!0,limit:1}).all();if(r.length){let t=await this.getValueFromLevel(r[0],e);if(t)return new tB(r[0],t)}return null}async getLessOrEqual(t,e){let r=this.db.sublevel(t,this.subLevelOptions);await r.open();let n=await r.keys({reverse:!0,lte:e,limit:1}).all();if(n.length){let t=await this.getValueFromLevel(n[0],r);if(t)return new tB(n[0],t)}return null}async getValueFromLevel(t,e){try{let r=await e.get(t);if(r&&void 0===r.tomb&&void 0===r.value)return r;if(r&&!1===r.tomb&&null!=r.value)return r.value}catch(t){if("LEVEL_NOT_FOUND"!=t.code)throw t}return null}async put(t,e){await this.setClientValue(t,new tR(e))}async del(t){await this.setClientValue(t,new tR(null,!0))}async setClientValue(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open(),await r.put(t.sortKey,e),this._rollbackBatch&&this._rollbackBatch.del(t.sortKey,{sublevel:r})}async delete(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open(),await e.clear()}async batch(t){for(let e of t)"put"===e.type?await this.put(e.key,e.value):"del"===e.type&&await this.delete(e.key)}async open(){await this.db.open()}async close(){this._db&&await this._db.close()}async begin(){await this.initRollbackBatch()}async rollback(){this._rollbackBatch&&(this._rollbackBatch.del(this.ongoingTransactionMark),await this._rollbackBatch.write(),await this._rollbackBatch.close()),this._rollbackBatch=null}async initRollbackBatch(){return null==this._rollbackBatch&&(await this.checkPreviousTransactionFinished(),await this.db.put(this.ongoingTransactionMark,"ongoing"),this._rollbackBatch=this.db.batch()),this._rollbackBatch}async checkPreviousTransactionFinished(){let t;try{t=await this.db.get(this.ongoingTransactionMark)}catch(t){if("LEVEL_NOT_FOUND"!=t.code)throw t}if("ongoing"==t)throw Error("Database seems to be in inconsistent state. The previous transaction has not finished.")}async commit(){this._rollbackBatch&&(await this._rollbackBatch.clear(),await this.db.del(this.ongoingTransactionMark),await this._rollbackBatch.close()),this._rollbackBatch=null}async dump(){return await this.db.iterator().all()}async getLastSortKey(){let t="";for(let e of(await this.db.open(),await this.db.keys().all())){let r=e.split(this.subLevelSeparator)[1];r.localeCompare(t)>0&&(t=r)}return""==t?null:t}async keys(t,e){return Array.from((await this.kvMap(t,e)).keys())}validateKey(t){if(t.includes(this.ongoingTransactionMark))throw Error(`Validation error: Key ${t} for internal use only`);if(t.includes(this.subLevelSeparator))throw Error(`Validation error: key ${t} contains db separator ${this.subLevelSeparator}`)}extractOriginalKey(t){return t.split(this.subLevelSeparator)[1]}extractSortKey(t){return t.split(this.subLevelSeparator)[2]}async kvMap(t,e){let r=new Map;for(let n of(await this.db.keys(this.levelRangeOptions(e)).all()).filter(t=>t!=this.ongoingTransactionMark).filter(e=>!t||0>=this.extractSortKey(e).localeCompare(t)).map(t=>this.extractOriginalKey(t))){let e=await this.getLessOrEqual(n,t);e&&r.set(n,e.cachedValue)}if(e?.limit){let t=new Map;for(let n of Array.from(r.entries()).slice(0,e.limit))t.set(n[0],n[1]);return t}return r}levelRangeOptions(t){let e={reverse:t?.reverse};return t?.gte&&(e.gte=this.subLevelSeparator+t.gte),t?.lt&&(e.lt=this.subLevelSeparator+t.lt),e}storage(){return this.db}async getNumEntries(){return(await this.db.keys().all()).length}async prune(t=5){(!t||t<=0)&&(t=1);let e=await this.allKeys();for(let r=0;r<e.length;r++){let n=this.db.sublevel(e[r],this.subLevelOptions);await n.open();let i=await n.keys({reverse:!0,limit:t}).all();!i||i.length<t||(await n.clear({lt:i[i.length-1]}),await n.close())}return null}async allKeys(){return(await this.db.keys().all()).filter(t=>t!=this.ongoingTransactionMark).map(t=>this.extractOriginalKey(t))}};x(),x(),x(),m(ti()),x(),x();var tP=Function.prototype.toString,tM=Object.create,tD=Object.prototype.toString,tK=function(){function t(){this._keys=[],this._values=[]}return t.prototype.has=function(t){return!!~this._keys.indexOf(t)},t.prototype.get=function(t){return this._values[this._keys.indexOf(t)]},t.prototype.set=function(t,e){this._keys.push(t),this._values.push(e)},t}(),tj="u">typeof WeakMap?function(){return new WeakMap}:function(){return new tK};function tW(t){if(!t)return tM(null);var e=t.constructor;if(e===Object)return t===Object.prototype?{}:tM(t);if(~tP.call(e).indexOf("[native code]"))try{return new e}catch{}return tM(t)}var tF="g"===/test/g.flags?function(t){return t.flags}:function(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e};function tV(t){var e=tD.call(t);return e.substring(8,e.length-1)}var tG="u">typeof Symbol?function(t){return t[Symbol.toStringTag]||tV(t)}:tV,tq=Object.defineProperty,tz=Object.getOwnPropertyDescriptor,tH=Object.getOwnPropertyNames,tJ=Object.getOwnPropertySymbols,tY=Object.prototype,tQ=tY.hasOwnProperty,tX=tY.propertyIsEnumerable,tZ="function"==typeof tJ,t0=tZ?function(t){return tH(t).concat(tJ(t))}:tH;function t1(t,e,r){for(var n=t0(t),i=0,a=n.length,o=void 0,s=void 0;i<a;++i)if(!("callee"===(o=n[i])||"caller"===o)){if(!(s=tz(t,o))){e[o]=r.copier(t[o],r);continue}s.get||s.set||(s.value=r.copier(s.value,r));try{tq(e,o,s)}catch{e[o]=s.value}}return e}function t2(t,e){return t.slice(0)}function t6(t,e){var r=new e.Constructor;return e.cache.set(t,r),t.forEach(function(t,n){r.set(n,e.copier(t,e))}),r}function t4(t,e){return new e.Constructor(t.valueOf())}function t8(t,e){return t}function t5(t,e){var r=new e.Constructor;return e.cache.set(t,r),t.forEach(function(t){r.add(e.copier(t,e))}),r}var t3=Array.isArray,t9=Object.assign,t7=Object.getPrototypeOf||function(t){return t.__proto__},et={array:function(t,e){var r=new e.Constructor;e.cache.set(t,r);for(var n=0,i=t.length;n<i;++n)r[n]=e.copier(t[n],e);return r},arrayBuffer:t2,blob:function(t,e){return t.slice(0,t.size,t.type)},dataView:function(t,e){return new e.Constructor(t2(t.buffer))},date:function(t,e){return new e.Constructor(t.getTime())},error:t8,map:t6,object:tZ?function(t,e){var r=tW(e.prototype);for(var n in e.cache.set(t,r),t)tQ.call(t,n)&&(r[n]=e.copier(t[n],e));for(var i=tJ(t),a=0,o=i.length,s=void 0;a<o;++a)s=i[a],tX.call(t,s)&&(r[s]=e.copier(t[s],e));return r}:function(t,e){var r=tW(e.prototype);for(var n in e.cache.set(t,r),t)tQ.call(t,n)&&(r[n]=e.copier(t[n],e));return r},regExp:function(t,e){var r=new e.Constructor(t.source,tF(t));return r.lastIndex=t.lastIndex,r},set:t5},ee=t9({},et,{array:function(t,e){var r=new e.Constructor;return e.cache.set(t,r),t1(t,r,e)},map:function(t,e){return t1(t,t6(t,e),e)},object:function(t,e){var r=tW(e.prototype);return e.cache.set(t,r),t1(t,r,e)},set:function(t,e){return t1(t,t5(t,e),e)}});function er(t){var e,r={Arguments:(e=t9({},et,t)).object,Array:e.array,ArrayBuffer:e.arrayBuffer,Blob:e.blob,Boolean:t4,DataView:e.dataView,Date:e.date,Error:e.error,Float32Array:e.arrayBuffer,Float64Array:e.arrayBuffer,Int8Array:e.arrayBuffer,Int16Array:e.arrayBuffer,Int32Array:e.arrayBuffer,Map:e.map,Number:t4,Object:e.object,Promise:t8,RegExp:e.regExp,Set:e.set,String:t4,WeakMap:t8,WeakSet:t8,Uint8Array:e.arrayBuffer,Uint8ClampedArray:e.arrayBuffer,Uint16Array:e.arrayBuffer,Uint32Array:e.arrayBuffer,Uint64Array:e.arrayBuffer},n=r.Array,i=r.Object;function a(t,e){if(e.prototype=e.Constructor=void 0,!t||"object"!=typeof t)return t;if(e.cache.has(t))return e.cache.get(t);if(e.prototype=t7(t),e.Constructor=e.prototype&&e.prototype.constructor,!e.Constructor||e.Constructor===Object)return i(t,e);if(t3(t))return n(t,e);var a=r[tG(t)];return a?a(t,e):"function"==typeof t.then?t:i(t,e)}return function(t){return a(t,{Constructor:void 0,cache:tj(),copier:a,prototype:void 0})}}er(t9({},ee,{}));var en=er({}),ei=t=>new Promise(e=>setTimeout(e,t)),ea=t=>{let e=Number.parseInt(t);if(Number.isNaN(e)&&!Number.isSafeInteger(e))throw Error(`Failed to cast ${t} to integer`);return e},eo=t=>en(t);function es(t){return t.endsWith("/")?t.slice(0,-1):t}function el(t){return`[d:${t}]`.padEnd(2*t,"-").concat("> ")}var ec=Function("try {return this===window;}catch(e){ return false;}");async function eu(t){let e;try{e=await t}catch(t){throw Error(`Error while communicating with gateway: ${JSON.stringify(t)}`)}if(!e?.ok)throw Error(`${e.status}: ${await e.text()}`);return await e.json()}var eh=((nk=eh||{}).ARWEAVE="arweave",nk.WARP_SEQUENCER="redstone-sequencer",nk.BOTH="both",nk),ef=class{constructor(t=null,e="both"){this.confirmationStatus=t,this.source=e,Object.assign(this,t),this.source=e}_warp;logger=tC.INST.create("WarpGatewayInteractionsLoader");async load(t,e,r,n){this.logger.debug("Loading interactions: for ",{contractId:t,fromSortKey:e,toSortKey:r});let i=[],a=0,o=0,s=0,l=n?n.sourceType:this.source,c=tO.measure(),u=es(this._warp.gwUrl());do{let n=tO.measure(),c=`${u}/gateway/v2/interactions-sort-key`,h=await eu(fetch(`${c}?${new URLSearchParams({contractId:t,...this._warp.whoAmI?{client:this._warp.whoAmI}:"",...e?{from:e}:"",...r?{to:r}:"",page:(++a).toString(),fromSdk:"true",...this.confirmationStatus&&this.confirmationStatus.confirmed?{confirmationStatus:"confirmed"}:"",...this.confirmationStatus&&this.confirmationStatus.notCorrupted?{confirmationStatus:"not_corrupted"}:"",..."both"==l?"":{source:l}})}`));this.logger.debug(`Loading interactions: page ${a} loaded in ${n.elapsed()}`),i.push(...h.interactions),o=h.paging.limit,s=h.paging.items,this.logger.debug(`Loaded interactions length: ${i.length}, from: ${e}, to: ${r}`)}while(s==o);return this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:i.length,time:c.elapsed()}),i}type(){return"warp"}clearCache(){}set warp(t){this._warp=t}},eg=class{constructor(t,e,r){this.state=t,this.validity=e,this.errorMessages=r}},ed=class{ignoreExceptions=!0;waitForConfirmation=!1;updateCacheForEachInteraction=!1;internalWrites=!1;maxCallDepth=7;maxInteractionEvaluationTimeSeconds=60;stackTrace={saveState:!1};sequencerUrl="https://d1o5nlqr4okus2.cloudfront.net/";gasLimit=Number.MAX_SAFE_INTEGER;sourceType="both";unsafeClient="throw";allowBigInt=!1;walletBalanceUrl="http://nyc-1.dev.arweave.net:1984/";mineArLocalBlocks=!0;throwOnInternalWriteError=!0;cacheEveryNInteractions=-1;useKVStorage=!1;remoteStateSyncEnabled=!1;remoteStateSyncSource="https://dre-1.warp.cc/contract";useConstructor=!1};x(),x();var ep=["application/javascript","application/wasm"],ey=class{src;srcBinary;srcWasmLang;constructor(t){this.src=t.src,this.srcBinary=t.srcBinary,this.srcWasmLang=t.srcWasmLang}},ew=class{txId;srcTxId;initState;minFee;owner;contractType;metadata;manifest;contractTx;srcTx;testnet;constructor(t){this.txId=t.txId,this.srcTxId=t.srcTxId,this.initState=t.initState,this.manifest=t.manifest,this.minFee=t.minFee,this.owner=t.owner,this.contractType=t.contractType,this.metadata=t.metadata,this.contractTx=t.contractTx,this.srcTx=t.srcTx,this.testnet=t.testnet}};x();var eb={APP_NAME:"App-Name",APP_VERSION:"App-Version",CONTRACT_TX_ID:"Contract",INPUT:"Input",CONTENT_TYPE:"Content-Type",CONTRACT_SRC_TX_ID:"Contract-Src",SDK:"SDK",MIN_FEE:"Min-Fee"},em={SEQUENCER:"Sequencer",SEQUENCER_OWNER:"Sequencer-Owner",SEQUENCER_MILLIS:"Sequencer-Mills",SEQUENCER_SORT_KEY:"Sequencer-Sort-Key",SEQUENCER_PREV_SORT_KEY:"Sequencer-Prev-Sort-Key",SEQUENCER_LAST_SORT_KEY:"Sequencer-Last-Sort-Key",SEQUENCER_TX_ID:"Sequencer-Tx-Id",SEQUENCER_BLOCK_HEIGHT:"Sequencer-Block-Height",SEQUENCER_BLOCK_ID:"Sequencer-Block-Id",SEQUENCER_BLOCK_TIMESTAMP:"Sequencer-Block-Timestamp",INIT_STATE:"Init-State",INIT_STATE_TX:"Init-State-TX",INTERACT_WRITE:"Interact-Write",WASM_LANG:"Wasm-Lang",WASM_LANG_VERSION:"Wasm-Lang-Version",WASM_META:"Wasm-Meta",REQUEST_VRF:"Request-Vrf",SIGNATURE_TYPE:"Signature-Type",UPLOADER_TX_ID:"Uploader-Tx-Id",WARP_TESTNET:"Warp-Testnet",MANIFEST:"Contract-Manifest",NONCE:"Nonce"};x();var ev=m(tS()),e_=m(ti());x();var eE=m(tl()),eT=class{get(t,e){if(!Object.getOwnPropertyNames(this).includes(t))throw Error(`Field "${t}" is not a property of the Arweave Transaction class.`);return this[t]instanceof Uint8Array?e&&e.decode&&e.string?eE.bufferToString(this[t]):e&&e.decode&&!e.string?this[t]:eE.bufferTob64Url(this[t]):e&&!0==e.decode?e&&e.string?eE.b64UrlToString(this[t]):eE.b64UrlToBuffer(this[t]):this[t]}},eS=class extends eT{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(t={}){super(),Object.assign(this,t),"string"==typeof this.data&&(this.data=eE.b64UrlToBuffer(this.data)),t.tags&&(this.tags=t.tags.map(t=>new ex(t.name,t.value)))}addTag(t,e){this.tags.push(new ex(eE.stringToB64Url(t),eE.stringToB64Url(e)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:eE.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(t){this.owner=t}setSignature({id:t,owner:e,reward:r,tags:n,signature:i}){this.id=t,this.owner=e,r&&(this.reward=r),n&&(this.tags=n),this.signature=i}async prepareChunks(t){throw Error("Should not be called, use arweave-js version.")}getChunk(t,e){if(!this.chunks)throw Error("Chunks have not been prepared");let r=this.chunks.proofs[t],n=this.chunks.chunks[t];return{data_root:this.data_root,data_size:this.data_size,data_path:eE.bufferTob64Url(r.proof),offset:r.offset.toString(),chunk:eE.bufferTob64Url(e.slice(n.minByteRange,n.maxByteRange))}}async getSignatureData(){throw Error("Should not be called, use arweave-js version.")}},ex=class extends eT{name;value;constructor(t,e,r=!1){super(),this.name=t,this.value=e}},ek=class{constructor(t){this.warp=t;let{arweave:e}=t;this.baseUrl=`${e.api.config.protocol}://${e.api.config.host}:${e.api.config.port}`,this.logger.debug("baseurl",this.baseUrl)}logger=tC.INST.create("ArweaveWrapper");baseUrl;async warpGwInfo(){return await this.doFetchInfo(`${es(this.warp.gwUrl())}/gateway/arweave/info`)}async warpGwBlock(){return this.logger.debug("Calling warp gw block info"),await this.doFetchInfo(`${es(this.warp.gwUrl())}/gateway/arweave/block`)}async info(){return await this.doFetchInfo(`${this.baseUrl}/info`)}async gql(t,e){try{let r=JSON.stringify({query:t,variables:e});return{data:await eu(fetch(`${this.baseUrl}/graphql`,{method:"POST",body:r,headers:{"Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Accept:"application/json"}})),status:200}}catch(t){throw this.logger.error("Error while loading gql",t),t}}async tx(t){let e=await fetch(`${this.baseUrl}/tx/${t}`).then(t=>t.ok?t.json():Promise.reject(t)).catch(e=>{throw e.body?.message&&this.logger.error(e.body.message),Error(`Unable to retrieve tx ${t}. ${e.status}. ${e.body?.message}`)});return new eS({...e})}async txData(t){let e=await fetch(`${this.baseUrl}/${t}`);if(e.ok){let t=await e.arrayBuffer();return e_.Buffer.from(t)}{this.logger.warn(`Unable to load data from arweave.net/${t} endpoint, falling back to arweave.js`);let e=await this.warp.arweave.transactions.getData(t,{decode:!0});return e_.Buffer.from(e)}}async txDataString(t){let e=await this.txData(t);return ev.default.utils.bufferToString(e)}async doFetchInfo(t){return await eu(fetch(t))}};x();var eA=class{logger=tC.INST.create("TagsParser");getInputTag(t,e){if(!eA.hasMultipleInteractions(t))return t.tags.find(t=>t.name===eb.INPUT);{this.logger.debug("Interaction transaction is using multiple input tx tag format.");let r=t.tags.findIndex(t=>t.name===eb.CONTRACT_TX_ID&&t.value===e);if(t.tags.length-1===r){this.logger.warn("Wrong tags format: 'Contract' is the last tag");return}let n=t.tags[r+1];if(n.name!==eb.INPUT){this.logger.warn(`No 'Input' tag found after 'Contract' tag. Instead ${n.name} was found`);return}return n}}isInteractWrite(t,e){return t.tags.some(t=>t.name===em.INTERACT_WRITE&&t.value===e)}getInteractWritesContracts(t){return t.tags.filter(t=>t.name===em.INTERACT_WRITE).map(t=>t.value)}getContractTag(t){return t.tags.find(t=>t.name===eb.CONTRACT_TX_ID)?.value}getContractsWithInputs(t){let e=new Map;return t.tags.filter(t=>t.name===eb.CONTRACT_TX_ID).forEach(r=>{e.set(r.value,this.getInputTag(t,r.value))}),e}isEvmSigned(t){return t.tags.some(t=>t.name===em.SIGNATURE_TYPE&&"ethereum"===t.value)}static hasMultipleInteractions(t){return t.tags.filter(t=>t.name===eb.CONTRACT_TX_ID).length>1}decodeTags(t){let e=t.get("tags"),r=[];for(let t of e)try{let e=t.get("name",{decode:!0,string:!0}),n=t.get("value",{decode:!0,string:!0});r.push({name:e,value:n})}catch{}return r}getTag(t,e){for(let r of t.get("tags"))try{if(r.get("name",{decode:!0,string:!0})===e)return r.get("value",{decode:!0,string:!0})}catch{}return!1}hasVrfTag(t){return t.tags.some(t=>t.name==em.REQUEST_VRF&&"true"===t.value)}};function eI(t){return t.arrayBuffer?t.arrayBuffer():new Promise((e,r)=>{let n=new FileReader;n.addEventListener("loadend",()=>{e(n.result)}),n.addEventListener("error",r),n.readAsArrayBuffer(t)})}async function eC(t){let e=await eI(t);return new Uint8Array(e)}function eO(t){return"u">typeof Blob&&t instanceof Blob}function eL(t){return"u">typeof SharedArrayBuffer&&t instanceof SharedArrayBuffer}x(),x();var eB="u">typeof l.default&&l.default.versions&&"u">typeof l.default.versions.node&&typeof l.default.versions.electron>"u",eN=class{constructor(t){this.typedArray=t instanceof ArrayBuffer||eL(t)?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}async getLength(){return this.typedArray.byteLength}async read(t,e){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+t,e)}},eU=class{constructor(t){this.blob=t}async getLength(){return this.blob.size}async read(t,e){let r=this.blob.slice(t,t+e),n=await eI(r);return new Uint8Array(n)}async sliceAsBlob(t,e,r=""){return this.blob.slice(t,t+e,r)}};function eR(t,e){var r=t.length;if(e<=r)return t;var n=new Uint8Array(Math.max(r<<1,e));return n.set(t,0),n}function e$(t,e,r,n){for(var i=0,a=0,o=n.length>>>1;a<r;){var s=t[a+e];n[a<<1]=0,n[(a<<1)+1]=s,s>i&&(i=s),a++}for(;a<o;)n[a<<1]=0,n[(a<<1)+1]=0,a++;return i}function eP(t,e){for(var r,n,i,a,o,s=t.length,l=eF.bl_count,a=0;a<=e;a++)l[a]=0;for(a=1;a<s;a+=2)l[t[a]]++;var c=eF.next_code;for(r=0,l[0]=0,n=1;n<=e;n++)r=r+l[n-1]<<1,c[n]=r;for(i=0;i<s;i+=2)0!=(o=t[i+1])&&(t[i]=c[o],c[o]++)}function eM(t,e,r){for(var n=t.length,i=eF.rev15,a=0;a<n;a+=2)if(0!=t[a+1])for(var o=a>>1,s=t[a+1],l=o<<4|s,c=e-s,u=t[a]<<c,h=u+(1<<c);u!=h;)r[i[u]>>>15-e]=l,u++}function eD(t,e){for(var r=eF.rev15,n=15-e,i=0;i<t.length;i+=2){var a=t[i]<<e-t[i+1];t[i]=r[a]>>>n}}function eK(t,e,r){return(t[e>>>3]|t[(e>>>3)+1]<<8)>>>(7&e)&(1<<r)-1}function ej(t,e,r){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(7&e)&(1<<r)-1}function eW(t,e){return(t[e>>>3]|t[(e>>>3)+1]<<8|t[(e>>>3)+2]<<16)>>>(7&e)}var eF=(nA=Uint16Array,nI=Uint32Array,{next_code:new nA(16),bl_count:new nA(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new nA(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new nI(32),flmap:new nA(512),fltree:[],fdmap:new nA(32),fdtree:[],lmap:new nA(32768),ltree:[],ttree:[],dmap:new nA(32768),dtree:[],imap:new nA(512),itree:[],rev15:new nA(32768),lhst:new nI(286),dhst:new nI(30),ihst:new nI(19),lits:new nI(15e3),strt:new nA(65536),prev:new nA(32768)});!function(){for(var t=0;t<32768;t++){var e=t;e=(4278255360&(e=(4042322160&(e=(3435973836&(e=(2863311530&e)>>>1|(1431655765&e)<<1))>>>2|(858993459&e)<<2))>>>4|(252645135&e)<<4))>>>8|(16711935&e)<<8,eF.rev15[t]=(e>>>16|e<<16)>>>17}function r(t,e,r){for(;0!=e--;)t.push(0,r)}for(var t=0;t<32;t++)eF.ldef[t]=eF.of0[t]<<3|eF.exb[t],eF.ddef[t]=eF.df0[t]<<4|eF.dxb[t];r(eF.fltree,144,8),r(eF.fltree,112,9),r(eF.fltree,24,7),r(eF.fltree,8,8),eP(eF.fltree,9),eM(eF.fltree,9,eF.flmap),eD(eF.fltree,9),r(eF.fdtree,32,5),eP(eF.fdtree,5),eM(eF.fdtree,5,eF.fdmap),eD(eF.fdtree,5),r(eF.itree,19,0),r(eF.ltree,286,0),r(eF.dtree,30,0),r(eF.ttree,320,0)}();var eV={table:function(){for(var t=new Uint32Array(256),e=0;e<256;e++){for(var r=e,n=0;n<8;n++)1&r?r=3988292384^r>>>1:r>>>=1;t[e]=r}return t}(),update:function(t,e,r,n){for(var i=0;i<n;i++)t=eV.table[(t^e[r+i])&255]^t>>>8;return t},crc:function(t,e,r){return 4294967295^eV.update(4294967295,t,e,r)}},eG={numWorkers:1,workerURL:"",useWorkers:!1},eq=0,ez=0,eH=!0,eJ=[],eY=[],eQ=[],eX=new Map;function eZ(t){e2(t.target);let{id:e,error:r,data:n}=t.data,i=eX.get(e);eX.delete(e),r?i.reject(r):i.resolve(n)}function e0(t){return new Promise((e,r)=>{let n=new Worker(t);n.onmessage=t=>{"start"===t.data?(n.onerror=void 0,n.onmessage=void 0,e(n)):r(Error(`unexpected message: ${t.data}`))},n.onerror=r})}var e1=function(){if(!eB)return{async createWorker(t){let e;try{return await e0(t)}catch{console.warn("could not load worker:",t)}try{let r=await fetch(t,{mode:"cors"});if(!r.ok)throw Error(`could not load: ${t}`);e=await r.text(),t=URL.createObjectURL(new Blob([e],{type:"application/javascript"}));let n=await e0(t);return eG.workerURL=t,n}catch{console.warn("could not load worker via fetch:",t)}if(void 0!==e)try{t=`data:application/javascript;base64,${btoa(e)}`;let r=await e0(t);return eG.workerURL=t,r}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),Error("can not start workers")},addEventListener(t,e){t.addEventListener("message",e)},async terminate(t){t.terminate()}};{var e;let{Worker:r}=(e=t).require?e.require("worker_threads"):{};return{createWorker:async t=>new r(t),addEventListener(t,e){t.on("message",r=>{e({target:t,data:r})})},async terminate(t){await t.terminate()}}}}();function e2(t){eY.push(t),e4()}async function e6(){if(0===eY.length&&ez<eG.numWorkers){++ez;try{let t=await e1.createWorker(eG.workerURL);eJ.push(t),eY.push(t),e1.addEventListener(t,eZ)}catch{eH=!1}}return eY.pop()}async function e4(){if(0!==eQ.length){if(eG.useWorkers&&eH){let t=await e6();if(eH){if(t){if(0===eQ.length){e2(t);return}let{id:e,src:r,uncompressedSize:n,type:i,resolve:a,reject:o}=eQ.shift();eX.set(e,{id:e,resolve:a,reject:o}),t.postMessage({type:"inflate",data:{id:e,type:i,src:r,uncompressedSize:n}},[])}return}}for(;eQ.length;){let{src:t,uncompressedSize:e,type:r,resolve:n}=eQ.shift(),i=t;eO(t)&&(i=await eC(t)),function(t,e,r,n){let i=new Uint8Array(e);(function(t,e){var r=Uint8Array;if(3==t[0]&&0==t[1])return e||new r(0);var n=eK,i=eW,a=null==e;a&&(e=new r(t.length>>>2<<3));for(var o,s,l=0,c=0,u=0,h=0,f=0,g=0,d=0,p=0,y=0;0==l;){if(l=ej(t,y,1),c=ej(t,y+1,2),y+=3,0==c){7&y&&(y+=8-(7&y));var w=(y>>>3)+4,b=t[w-4]|t[w-3]<<8;a&&(e=eR(e,p+b)),e.set(new r(t.buffer,t.byteOffset+w,b),p),y=w+b<<3,p+=b;continue}if(a&&(e=eR(e,p+131072)),1==c&&(o=eF.flmap,s=eF.fdmap,g=511,d=31),2==c){u=n(t,y,5)+257,h=n(t,y+5,5)+1,f=n(t,y+10,4)+4,y+=14;for(var m=0;m<38;m+=2)eF.itree[m]=0,eF.itree[m+1]=0;for(var v=1,m=0;m<f;m++){var _=n(t,y+3*m,3);eF.itree[(eF.ordr[m]<<1)+1]=_,_>v&&(v=_)}y+=3*f,eP(eF.itree,v),eM(eF.itree,v,eF.imap),o=eF.lmap,s=eF.dmap,y=function(t,e,r,n,i,a){for(var o=eK,s=eW,l=0;l<r;){var c=t[s(n,i)&e];i+=15&c;var u=c>>>4;if(u<=15)a[l]=u,l++;else{var h=0,f=0;16==u?(f=3+o(n,i,2),i+=2,h=a[l-1]):17==u?(f=3+o(n,i,3),i+=3):18==u&&(f=11+o(n,i,7),i+=7);for(var g=l+f;l<g;)a[l]=h,l++}}return i}(eF.imap,(1<<v)-1,u+h,t,y,eF.ttree);var E=e$(eF.ttree,0,u,eF.ltree);g=(1<<E)-1;var T=e$(eF.ttree,u,h,eF.dtree);d=(1<<T)-1,eP(eF.ltree,E),eM(eF.ltree,E,o),eP(eF.dtree,T),eM(eF.dtree,T,s)}for(;;){var S=o[i(t,y)&g];y+=15&S;var x=S>>>4;if(x>>>8){if(256==x)break;var k=p+x-254;if(x>264){var A=eF.ldef[x-257];k=p+(A>>>3)+n(t,y,7&A),y+=7&A}var I=s[i(t,y)&d];y+=15&I;var C=I>>>4,O=eF.ddef[C],L=(O>>>4)+ej(t,y,15&O);for(y+=15&O,a&&(e=eR(e,p+131072));p<k;)e[p]=e[p++-L],e[p]=e[p++-L],e[p]=e[p++-L],e[p]=e[p++-L];p=k}else e[p++]=x}}e.length==p||e.slice(0,p)})(t,i),n(r?new Blob([i],{type:r}):i.buffer)}(i,e,r,n)}}}function e8(t,e,r){return new Promise((n,i)=>{eQ.push({src:t,uncompressedSize:e,type:r,resolve:n,reject:i,id:eq++}),e4()})}var e5=class{constructor(t,e){var r,n;this._reader=t,this._rawEntry=e,this.name=e.name,this.nameBytes=e.nameBytes,this.size=e.uncompressedSize,this.compressedSize=e.compressedSize,this.comment=e.comment,this.commentBytes=e.commentBytes,this.compressionMethod=e.compressionMethod,this.lastModDate=(r=e.lastModFileDate,n=e.lastModFileTime,new Date((r>>9&127)+1980,(r>>5&15)-1,31&r,n>>11&31,n>>5&63,(31&n)*2,0)),this.isDirectory=0===e.uncompressedSize&&e.name.endsWith("/"),this.encrypted=!!(1&e.generalPurposeBitFlag),this.externalFileAttributes=e.externalFileAttributes,this.versionMadeBy=e.versionMadeBy}async blob(t="application/octet-stream"){return await ru(this._reader,this._rawEntry,t)}async arrayBuffer(){return await rc(this._reader,this._rawEntry)}async text(){let t=await this.arrayBuffer();return ri(new Uint8Array(t))}async json(){return JSON.parse(await this.text())}};async function e3(t,e,r){return await t.read(e,r)}async function e9(t,e,r,n){return t.sliceAsBlob?await t.sliceAsBlob(e,r,n):await t.read(e,r)}var e7={unsigned:()=>0};function rt(t,e){return t[e]+256*t[e+1]}function re(t,e){return t[e]+256*t[e+1]+65536*t[e+2]+16777216*t[e+3]}function rr(t,e){return re(t,e)+4294967296*re(t,e+4)}var rn=new TextDecoder;function ri(t,e){return eL(t.buffer)&&(t=new Uint8Array(t)),rn.decode(t)}async function ra(t,e){let r=Math.min(65557,e),n=e-r,i=await e3(t,n,r);for(let e=r-22;e>=0;--e){if(101010256!==re(i,e))continue;let r=new Uint8Array(i.buffer,i.byteOffset+e,i.byteLength-e),a=rt(r,4);if(0!==a)throw Error(`multi-volume zip files are not supported. This is volume: ${a}`);let o=rt(r,10),s=re(r,12),l=re(r,16),c=rt(r,20),u=r.length-22;if(c!==u)throw Error(`invalid comment length. expected: ${u}, actual: ${c}`);let h=new Uint8Array(r.buffer,r.byteOffset+22,c),f=ri(h);return 65535===o||4294967295===l?await ro(t,n+e,f,h):await rs(t,l,s,o,f,h)}throw Error("could not find end of central directory. maybe not zip file")}async function ro(t,e,r,n){let i=await e3(t,e-20,20);if(117853008!==re(i,0))throw Error("invalid zip64 end of central directory locator signature");let a=rr(i,8),o=await e3(t,a,56);if(101075792!==re(o,0))throw Error("invalid zip64 end of central directory record signature");let s=rr(o,32),l=rr(o,40),c=rr(o,48);return rs(t,c,l,s,r,n)}async function rs(t,e,r,n,i,a){let o=0,s=await e3(t,e,r),l=[];for(let t=0;t<n;++t){let t=s.subarray(o,o+46),e=re(t,0);if(33639248!==e)throw Error(`invalid central directory file header signature: 0x${e.toString(16)}`);let r={versionMadeBy:rt(t,4),versionNeededToExtract:rt(t,6),generalPurposeBitFlag:rt(t,8),compressionMethod:rt(t,10),lastModFileTime:rt(t,12),lastModFileDate:rt(t,14),crc32:re(t,16),compressedSize:re(t,20),uncompressedSize:re(t,24),fileNameLength:rt(t,28),extraFieldLength:rt(t,30),fileCommentLength:rt(t,32),internalFileAttributes:rt(t,36),externalFileAttributes:re(t,38),relativeOffsetOfLocalHeader:re(t,42)};if(64&r.generalPurposeBitFlag)throw Error("strong encryption is not supported");o+=46;let n=s.subarray(o,o+r.fileNameLength+r.extraFieldLength+r.fileCommentLength);r.nameBytes=n.slice(0,r.fileNameLength),r.name=ri(r.nameBytes);let i=r.fileNameLength+r.extraFieldLength,a=n.slice(r.fileNameLength,i);r.extraFields=[];let c=0;for(;c<a.length-3;){let t=rt(a,c+0),e=rt(a,c+2),n=c+4,i=n+e;if(i>a.length)throw Error("extra field length exceeds extra field buffer size");r.extraFields.push({id:t,data:a.slice(n,i)}),c=i}if(r.commentBytes=n.slice(i,i+r.fileCommentLength),r.comment=ri(r.commentBytes),o+=n.length,4294967295===r.uncompressedSize||4294967295===r.compressedSize||4294967295===r.relativeOffsetOfLocalHeader){let t=r.extraFields.find(t=>1===t.id);if(!t)throw Error("expected zip64 extended information extra field");let e=t.data,n=0;if(4294967295===r.uncompressedSize){if(n+8>e.length)throw Error("zip64 extended information extra field does not include uncompressed size");r.uncompressedSize=rr(e,n),n+=8}if(4294967295===r.compressedSize){if(n+8>e.length)throw Error("zip64 extended information extra field does not include compressed size");r.compressedSize=rr(e,n),n+=8}if(4294967295===r.relativeOffsetOfLocalHeader){if(n+8>e.length)throw Error("zip64 extended information extra field does not include relative header offset");r.relativeOffsetOfLocalHeader=rr(e,n),n+=8}}let u=r.extraFields.find(t=>28789===t.id&&t.data.length>=6&&1===t.data[0]&&re(t.data,1),e7.unsigned(r.nameBytes));if(u&&(r.fileName=ri(u.data.slice(5))),0===r.compressionMethod){let t=r.uncompressedSize;if(1&r.generalPurposeBitFlag&&(t+=12),r.compressedSize!==t)throw Error(`compressed size mismatch for stored file: ${r.compressedSize} != ${t}`)}l.push(r)}return{zip:{comment:i,commentBytes:a},entries:l.map(e=>new e5(t,e))}}async function rl(t,e){if(1&e.generalPurposeBitFlag)throw Error("encrypted entries not supported");let r=await e3(t,e.relativeOffsetOfLocalHeader,30),n=await t.getLength(),i=re(r,0);if(67324752!==i)throw Error(`invalid local file header signature: 0x${i.toString(16)}`);let a=rt(r,26),o=rt(r,28),s=e.relativeOffsetOfLocalHeader+r.length+a+o,l;if(0===e.compressionMethod)l=!1;else if(8===e.compressionMethod)l=!0;else throw Error(`unsupported compression method: ${e.compressionMethod}`);let c=s+e.compressedSize;if(0!==e.compressedSize&&c>n)throw Error(`file data overflows file bounds: ${s} +  ${e.compressedSize}  > ${n}`);return{decompress:l,fileDataStart:s}}async function rc(t,e){let{decompress:r,fileDataStart:n}=await rl(t,e);if(!r){let r=await e3(t,n,e.compressedSize);return 0===r.byteOffset&&r.byteLength===r.buffer.byteLength?r.buffer:r.slice().buffer}let i=await e9(t,n,e.compressedSize);return await e8(i,e.uncompressedSize)}async function ru(t,e,r){let{decompress:n,fileDataStart:i}=await rl(t,e);if(!n){let n=await e9(t,i,e.compressedSize,r);return eO(n)?n:new Blob([eL(n.buffer)?new Uint8Array(n):n],{type:r})}let a=await e9(t,i,e.compressedSize);return await e8(a,e.uncompressedSize,r)}async function rh(t){let e;if("u">typeof Blob&&t instanceof Blob)e=new eU(t);else if(t instanceof ArrayBuffer||t&&t.buffer&&t.buffer instanceof ArrayBuffer)e=new eN(t);else if(eL(t)||eL(t.buffer))e=new eN(t);else if("string"==typeof t){let r=await fetch(t);if(!r.ok)throw Error(`failed http request ${t}, status: ${r.status}: ${r.statusText}`);let n=await r.blob();e=new eU(n)}else if("function"==typeof t.getLength&&"function"==typeof t.read)e=t;else throw Error("unsupported source type");let r=await e.getLength();if(r>Number.MAX_SAFE_INTEGER)throw Error(`file too large. size: ${r}. Only file sizes up 4503599627370496 bytes are supported`);return await ra(e,r)}async function rf(t){let{zip:e,entries:r}=await rh(t);return{zip:e,entries:Object.fromEntries(r.map(t=>[t.name,t]))}}var rg=m(ti()),rd=class{constructor(t){this.src=t,this.splitted=this.splitBuffer(t),this.logger.debug(`Buffer splitted into ${this.splitted.length} parts`)}logger=tC.INST.create("WasmSrc");splitted;wasmBinary(){return this.splitted[0]}async sourceCode(){let{entries:t}=await rf(this.splitted[1]),e=new Map;for(let[r,n]of Object.entries(t)){if(n.isDirectory)continue;let t=await n.text();e.set(r,t)}return e}additionalCode(){return 2==this.splitted.length?null:this.splitted[2].toString()}splitBuffer(t){let e="",r=parseInt(t.toString("utf8",0,1));this.logger.debug(`Number of elements: ${r}`);let n=t.length,i=0,a=0;for(let o=2;o<n;o++){let n=t.toString("utf8",o,o+1);if("|"==n&&i++,i==r){a=o+1;break}e+=n}this.logger.debug("Parsed:",{header:e,dataStart:a});let o=e.split("|").map(t=>parseInt(t));this.logger.debug("Lengths",o);let s=[];for(let e of o){let r=rg.Buffer.alloc(e),n=a+e;t.copy(r,0,a,n),a=n,s.push(r)}return s}},rp=class{constructor(t,e){this.arweave=t,this.env=e,this.tagsParser=new eA}logger=tC.INST.create("ContractDefinitionLoader");arweaveWrapper;tagsParser;async load(t,e){let r=tO.measure(),n=await this.doLoad(t,e);return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),n}async doLoad(t,e){let r=tO.measure(),n=await this.arweaveWrapper.tx(t),i=await this.arweave.wallets.ownerToAddress(n.owner);this.logger.debug("Contract tx and owner",r.elapsed()),r.reset();let a=e||this.tagsParser.getTag(n,eb.CONTRACT_SRC_TX_ID),o=this.tagsParser.getTag(n,em.WARP_TESTNET)||null;if(o&&"testnet"!==this.env)throw Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!o&&"testnet"===this.env)throw Error("Trying to use non-testnet contract in a testnet env.");let s=this.tagsParser.getTag(n,eb.MIN_FEE),l=null,c=this.tagsParser.getTag(n,em.MANIFEST);c&&(l=JSON.parse(c)),this.logger.debug("Tags decoding",r.elapsed()),r.reset();let u=await this.evalInitialState(n);this.logger.debug("init state",u);let h=JSON.parse(u);this.logger.debug("Parsing src and init state",r.elapsed());let{src:f,srcBinary:g,srcWasmLang:d,contractType:p,metadata:y,srcTx:w}=await this.loadContractSource(a);return{txId:t,srcTxId:a,src:f,srcBinary:g,srcWasmLang:d,initState:h,minFee:s,owner:i,contractType:p,metadata:y,manifest:l,contractTx:n.toJSON(),srcTx:w,testnet:o}}async loadContractSource(t){let e=tO.measure(),r=await this.arweaveWrapper.tx(t),n=this.tagsParser.getTag(r,eb.CONTENT_TYPE);if(!ep.includes(n))throw Error(`Contract source content type ${n} not supported`);let i="application/javascript"==n?"js":"wasm",a="js"==i?await this.arweaveWrapper.txDataString(t):await this.arweaveWrapper.txData(t),o,s,l;if("wasm"==i){if(s=new rd(a),!(o=this.tagsParser.getTag(r,em.WASM_LANG)))throw Error(`Wasm lang not set for wasm contract src ${t}`);l=JSON.parse(this.tagsParser.getTag(r,em.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:"js"==i?a:null,srcBinary:"wasm"==i?s.wasmBinary():null,srcWasmLang:o,contractType:i,metadata:l,srcTx:r.toJSON()}}async evalInitialState(t){if(this.tagsParser.getTag(t,em.INIT_STATE))return this.tagsParser.getTag(t,em.INIT_STATE);if(!this.tagsParser.getTag(t,em.INIT_STATE_TX))return this.arweaveWrapper.txDataString(t.id);{let e=this.tagsParser.getTag(t,em.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}}type(){return"arweave"}setCache(t){throw Error("No cache implemented for this loader")}setSrcCache(t){throw Error("No cache implemented for this loader")}getCache(){throw Error("No cache implemented for this loader")}getSrcCache(){throw Error("No cache implemented for this loader")}set warp(t){this.arweaveWrapper=new ek(t)}};x();var ry=m(ti()),rw=class{constructor(t,e,r,n){this.definitionCache=e,this.srcCache=r,this.env=n,this.contractDefinitionLoader=new rp(t,n),this.tagsParser=new eA}rLogger=tC.INST.create("WarpGatewayContractDefinitionLoader");contractDefinitionLoader;arweaveWrapper;tagsParser;_warp;async load(t,e){let r=await this.getFromCache(t,e);if(r)return this.rLogger.debug("WarpGatewayContractDefinitionLoader: Hit from cache!"),"wasm"==r.contractType&&r.srcBinary.data&&(r.srcBinary=ry.Buffer.from(r.srcBinary.data)),this.verifyEnv(r),r;let n=tO.measure(),i=await this.doLoad(t,e);return this.rLogger.info(`Contract definition loaded in: ${n.elapsed()}`),this.verifyEnv(i),await this.putToCache(t,i,e),i}async doLoad(t,e){try{let r=es(this._warp.gwUrl()),n=await eu(fetch(`${r}/gateway/contract?txId=${t}${e?`&srcTxId=${e}`:""}`));if(null==n.srcBinary||n.srcBinary instanceof ry.Buffer||(n.srcBinary=ry.Buffer.from(n.srcBinary.data)),n.srcBinary){let t,e=new rd(n.srcBinary);n.srcBinary=e.wasmBinary(),t=n.srcTx?new eS({...n.srcTx}):await this.arweaveWrapper.tx(n.srcTxId);let r=JSON.parse(this.tagsParser.getTag(t,em.WASM_META));n.metadata=r}return n.contractType=n.src?"js":"wasm",n}catch(r){return this.rLogger.warn("Falling back to default contracts loader",r),await this.contractDefinitionLoader.doLoad(t,e)}}async loadContractSource(t){return await this.contractDefinitionLoader.loadContractSource(t)}type(){return"warp"}setCache(t){this.definitionCache=t}setSrcCache(t){this.srcCache=t}getCache(){return this.definitionCache}getSrcCache(){return this.srcCache}verifyEnv(t){if(t.testnet&&"testnet"!==this.env)throw Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!t.testnet&&"testnet"===this.env)throw Error("Trying to use non-testnet contract in a testnet env.")}async getFromCache(t,e){let r=await this.definitionCache.get(new tL(t,"cd"));if(!r)return null;let n=await this.srcCache.get(new tL(e||r.cachedValue.srcTxId,"src"));return n?{...r.cachedValue,...n.cachedValue}:null}async putToCache(t,e,r){let n=new ey(e),i=new ew(e);await this.definitionCache.put({key:t,sortKey:"cd"},i),await this.srcCache.put({key:r||i.srcTxId,sortKey:"src"},n)}set warp(t){this._warp=t,this.arweaveWrapper=new ek(t),this.contractDefinitionLoader.warp=t}};x(),x(),x();var rb="".padEnd(13,"0"),rm="".padEnd(13,"9"),rv="".padEnd(13,"0"),r_="".padEnd(64,"0"),rE="".padEnd(64,"z"),rT=`${"".padStart(12,"0")},${rb},${r_}`,rS=("".padStart(12,"9"),class{constructor(t){this.arweave=t}logger=tC.INST.create("LexicographicalInteractionsSorter");async sort(t){let e=[...t],r=e.map(t=>this.addSortKey(t));return await Promise.all(r),e.sort((t,e)=>t.node.sortKey.localeCompare(e.node.sortKey))}async createSortKey(t,e,r,n=!1){return`${`${r}`.padStart(12,"0")},${n?rm:rv},${function(t){let e="";for(let r of t)e+=("0"+r.toString(16)).slice(-2);return e}(await this.arweave.crypto.hash(this.arweave.utils.concatBuffers([this.arweave.utils.b64UrlToBuffer(t),this.arweave.utils.b64UrlToBuffer(e)])))}`}extractBlockHeight(t){return t?parseInt(t.split(",")[0]):null}async addSortKey(t){let{node:e}=t,r=t.node.sortKey;r?(t.node.sortKey=r,this.logger.debug("Using sortKey from sequencer",t.node.sortKey)):t.node.sortKey=await this.createSortKey(e.block.id,e.id,e.block.height)}generateLastSortKey(t){return`${`${t}`.padStart(12,"0")},${rm},${rE}`}});x();var rx=`query Transactions($tags: [TagFilter!]!, $blockFilter: BlockFilter!, $first: Int!, $after: String) {
    transactions(tags: $tags, block: $blockFilter, first: $first, sort: HEIGHT_ASC, after: $after) {
      pageInfo {
        hasNextPage
      }
      edges {
        node {
          id
          owner { address }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston }
          quantity { winston }
          parent { id }
          bundledIn { id }
        }
        cursor
      }
    }
  }`,rk=`query Transaction($id: ID!) {
  transaction(id: $id) {
          id
          owner { address, key }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston, ar }
          quantity { winston, ar }
          bundledIn { id }
    			parent{ id }
          signature
        }
}`,rA=`query Transactions($tags: [TagFilter!]!) {
  transactions(tags: $tags) {
      edges {
        node {
          id
          owner { address, key }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston, ar }
          quantity { winston, ar }
          parent { id }
          bundledIn { id }
          signature
        }
      }
  }
}`,rI=class{constructor(t){this.warp=t,this.arweaveWrapper=new ek(t)}arweaveWrapper;logger=tC.INST.create(rI.name);async transaction(t){return(await this.fetch(rk,{id:t})).transaction}async transactionUsingUploaderTag(t){let e={name:em.UPLOADER_TX_ID,values:[t]},r=(await this.fetch(rA,{tags:[e]})).transactions;if(r.edges.length<1)throw Error(`No interaction with tag ${em.UPLOADER_TX_ID}:${t}`);return r.edges[0].node}async transactions(t){let e=(await this.fetch(rx,t)).transactions,r=[...e.edges];for(;e.pageInfo.hasNextPage;){let n=e.edges[99].cursor,i={...t,after:n};e=(await this.fetch(rx,i)).transactions,r.push(...e.edges)}return r}async fetch(t,e){let r=tO.measure(),n=await this.arweaveWrapper.gql(t,e);for(this.logger.debug("GQL page load:",r.elapsed());403===n.status;)this.logger.warn("GQL rate limiting, waiting 30000ms before next try."),await ei(3e4),n=await this.arweaveWrapper.gql(t,e);if(200!==n.status)throw Error(`Unable to retrieve transactions. Arweave gateway responded with status ${n.status}.`);if(n.data.errors)throw this.logger.error(n.data.errors),Error("Error while fetching arweave transactions");return n.data.data}};function rC(t){return!t.node.parent?.id&&!t.node.bundledIn?.id}var rO=class{constructor(t,e){this.arweave=t,this.environment=e,this.sorter=new rS(t)}logger=tC.INST.create("ArweaveGatewayInteractionsLoader");sorter;arweaveTransactionQuery;_warp;tagsParser=new eA;async load(t,e,r,n){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let i=this.sorter.extractBlockHeight(e),a=this.sorter.extractBlockHeight(r),o={tags:[{name:eb.APP_NAME,values:["SmartWeaveAction"]},{name:eb.CONTRACT_TX_ID,values:[t]}],blockFilter:{min:i,max:a},first:100},s=tO.measure(),l=(await this.arweaveTransactionQuery.transactions(o)).filter(rC);if(s.stop(),n.internalWrites){let e={tags:[{name:em.INTERACT_WRITE,values:[t]}],blockFilter:{min:i,max:a},first:100},r=(await this.arweaveTransactionQuery.transactions(e)).filter(rC);this.logger.debug("Inner writes interactions length:",r.length),l=l.concat(r)}l=l.filter(t=>t.node.block&&t.node.block.id&&t.node.block.height);let c=await this.sorter.sort(l);e&&r?c=c.filter(t=>t.node.sortKey.localeCompare(e)>0&&0>=t.node.sortKey.localeCompare(r)):e&&!r?c=c.filter(t=>t.node.sortKey.localeCompare(e)>0):!e&&r&&(c=c.filter(t=>0>=t.node.sortKey.localeCompare(r))),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:c.length,time:s.elapsed()});let u="local"===this.environment||"testnet"===this.environment,h=this._warp.maybeLoadPlugin("vrf");return c.map(t=>{let e=t.node;return u&&this.tagsParser.hasVrfTag(e)&&(h?e.vrf=h.process().generateMockVrf(e.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),e})}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveTransactionQuery=new rI(t),this._warp=t}};x();var rL=class{constructor(t){this.delegate=t}logger=tC.INST.create("CacheableInteractionsLoader");interactionsCache=new Map;async load(t,e,r,n){if(this.logger.debug("Loading interactions for",{contractTxId:t,fromSortKey:e,toSortKey:r}),this.interactionsCache.has(t)){let e=this.interactionsCache.get(t);if(e?.length){let i=e[e.length-1].sortKey;if(0>i.localeCompare(r)){let a=await this.delegate.load(t,i,r,n),o=e.concat(a);return this.interactionsCache.set(t,o),o}}return e}{let i=await this.delegate.load(t,e,r,n);return i.length&&this.interactionsCache.set(t,i),i}}type(){return this.delegate.type()}clearCache(){this.interactionsCache.clear()}set warp(t){this.delegate.warp=t}};x();var rB=class{constructor(t,e=[]){this.arweave=t,this.executionContextModifiers=e}logger=tC.INST.create("DefaultStateEvaluator");tagsParser=new eA;async eval(t){return this.doReadState(t.sortedInteractions,new eg(t.contractDefinition.initState,{},{}),t)}async doReadState(t,e,r){let{ignoreExceptions:n,stackTrace:i,internalWrites:a}=r.evaluationOptions,{contract:o,contractDefinition:s,sortedInteractions:l,warp:c}=r,u=e.state,h=null,f=e.validity,g=e.errorMessages;r?.handler.initState(u);let d=r.contract.callDepth();this.logger.debug(`${el(d)}Evaluating state for ${s.txId} [${t.length} non-cached of ${l.length} all]`);let p=null,y=null,w=t.length,b=c.maybeLoadPlugin("evm-signature-verification"),m=c.maybeLoadPlugin("evaluation-progress"),v=c.maybeLoadPlugin("vrf"),_=!1;for(let e=0;e<w&&!_;e++){o.interactionState().setInitial(o.txId(),new eg(u,f,g));let E=t[e],T=tO.measure();if(h=E.sortKey,E.vrf){if(v){if(!v.process().verify(E.vrf,E.sortKey))throw Error("Vrf verification failed.")}else this.logger.warn('Cannot verify vrf for interaction - no "warp-contracts-plugin-vrf" attached!')}if(b&&this.tagsParser.isEvmSigned(E))try{if(!await b.process(E)){this.logger.warn(`Interaction ${E.id} was not verified, skipping.`);continue}}catch(t){this.logger.error(t);continue}if(this.logger.debug(`${el(d)}[${s.txId}][${E.id}][${E.block.height}]: ${t.indexOf(E)+1}/${t.length} [of all:${l.length}]`),this.tagsParser.isInteractWrite(E,s.txId)&&a){let t=this.tagsParser.getContractTag(E);this.logger.debug(`${el(d)}Internal Write - Loading writing contract`,t);let e=o.getCallStack().addInteractionData({interaction:null,interactionTx:E}),n=c.contract(t,r.contract,{callingInteraction:E,callType:"read"});this.logger.debug(`${el(d)}Reading state of the calling contract at`,E.sortKey);let a=null;try{await n.readState(E.sortKey),a=o.interactionState().get(o.txId())}catch(t){if("ContractError"==t.name&&"unsafeClientSkip"==t.subtype)this.logger.warn("Skipping unsafe contract in internal write"),g[E.id]=t,rN(E)&&(y={tx:E,state:new eg(u,f,g)});else throw t}if(null!==a){u=a.state,r?.handler.initState(u),f[E.id]=a.validity[E.id],a.errorMessages?.[E.id]&&(g[E.id]=a.errorMessages[E.id]);let t=new eg(u,f,g);rN(E)&&(y={tx:E,state:t})}else f[E.id]=!1;e.update({cacheHit:!1,outputState:i.saveState?u:void 0,executionTime:T.elapsed(!0),valid:f[E.id],errorMessage:p,gasUsed:0})}else{let t=this.tagsParser.getInputTag(E,r.contractDefinition.txId);if(!t){this.logger.error(`${el(d)}Skipping tx - Input tag not found for ${E.id}`);continue}let e=this.parseInput(t);if(!e){this.logger.error(`${el(d)}Skipping tx - invalid Input tag - ${E.id}`);continue}let a={input:e,caller:E.owner.address,interactionType:"write"},s={interaction:a,interactionTx:E},l=o.getCallStack().addInteractionData(s),c=await r.handler.handle(r,new eg(u,f,g),s);if(p=c.errorMessage,"ok"!==c.type&&(g[E.id]=p),this.logResult(c,E,r),this.logger.debug(`${el(d)}Interaction evaluation`,T.elapsed()),l.update({cacheHit:!1,outputState:i.saveState?u:void 0,executionTime:T.elapsed(!0),valid:f[E.id],errorMessage:p,gasUsed:c.gasUsed}),"exception"===c.type&&!0!==n)throw Error(`Exception while processing ${JSON.stringify(a)}:
${c.errorMessage}`);f[E.id]="ok"===c.type,u=c.state;let h=new eg(u,f,g);rN(E)&&(y={tx:E,state:h})}m&&m.process({contractTxId:s.txId,allInteractions:w,currentInteraction:e,lastInteractionProcessingTime:T.elapsed()});try{for(let{modify:t}of this.executionContextModifiers)r=await t(u,r)}catch(t){if("ContractError"==t.name&&"unsafeClientSkip"==t.subtype)f[E.id]=!1,g[E.id]=t.message,_=!0;else throw t}o.isRoot()?y&&(o.interactionState().update(o.txId(),y.state),f[E.id]?await o.interactionState().commit(E):await o.interactionState().rollback(E)):o.interactionState().update(o.txId(),new eg(u,f,g))}let E=new eg(u,f,g);return null!==y&&await this.onStateEvaluated(y.tx,r,y.state),new tB(h,E)}logResult(t,e,r){"exception"===t.type&&this.logger.error(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] threw exception:`,`${t.errorMessage}`),"error"===t.type&&this.logger.warn(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] returned error:`,t.errorMessage)}parseInput(t){try{return JSON.parse(t.value)}catch(t){return this.logger.error(t),null}}};function rN(t){return void 0===t.confirmationStatus||"confirmed"===t.confirmationStatus}x();var rU=class extends rB{constructor(t,e,r=[]){super(t,r),this.cache=e}cLogger=tC.INST.create("CacheableStateEvaluator");async eval(t){let{cachedState:e,contract:r}=t,n=t.sortedInteractions;if(e&&e.sortKey==t.requestedSortKey&&!n?.length)return this.cLogger.info(`Exact cache hit for sortKey ${t?.contractDefinition?.txId}:${e.sortKey}`),t.handler?.initState(e.cachedValue.state),e;let i=t.contractDefinition.txId;if(!i)throw Error("Contract tx id not set in the execution context");let a=null==e,o=a?t.contractDefinition.initState:e.cachedValue.state,s=a?{}:e.cachedValue.validity,l=a?{}:e.cachedValue.errorMessages;if(a&&(o=await t.handler.maybeCallStateConstructor(t.contractDefinition.initState,t),await r.interactionState().commitKV()),0==n.length){if(this.cLogger.info(`No missing interactions ${i}`),!a)return t.handler?.initState(e.cachedValue.state),e;{t.handler?.initState(o),this.cLogger.debug("Inserting initial state into cache");let e=new eg(o,{},{});return await this.cache.put(new tL(i,rT),e),new tB(rT,e)}}return await this.doReadState(n,new eg(o,s,l||{}),t)}async onStateEvaluated(t,e,r){let n=e.contractDefinition.txId;this.cLogger.debug(`${el(e.contract.callDepth())}onStateEvaluated: cache update for contract ${n} [${t.sortKey}]`),await this.putInCache(n,t,r)}async onStateUpdate(t,e,r,n=!1){(e.evaluationOptions.updateCacheForEachInteraction||n)&&(this.cLogger.debug(`onStateUpdate: cache update for contract ${e.contractDefinition.txId} [${t.sortKey}]`,{contract:e.contractDefinition.txId,state:r.state,sortKey:t.sortKey}),await this.putInCache(e.contractDefinition.txId,t,r))}async latestAvailableState(t,e){if(this.cLogger.debug("Searching for",{contractTxId:t,sortKey:e}),!e)return await this.cache.getLast(t);{let r=await this.cache.getLessOrEqual(t,e);return r&&this.cLogger.debug(`Latest available state at ${t}: ${r.sortKey}`),r}}async onInternalWriteStateUpdate(t,e,r){this.cLogger.debug("Internal write state update:",{sortKey:t.sortKey,dry:t.dry,contractTxId:e,state:r.state}),await this.putInCache(e,t,r)}async onContractCall(t,e,r){if(e.sortedInteractions?.length==0)return;let n=e.sortedInteractions.indexOf(t);n<1||await this.putInCache(e.contractDefinition.txId,e.sortedInteractions[n-1],r)}async putInCache(t,e,r){if(e.dry||void 0!==e.confirmationStatus&&"confirmed"!==e.confirmationStatus)return;let n=new eg(r.state,r.validity,r.errorMessages||{});this.cLogger.debug("Putting into cache",{contractTxId:t,transaction:e.id,sortKey:e.sortKey,dry:e.dry}),await this.cache.put(new tL(t,e.sortKey),n)}async syncState(t,e,r,n){let i=new eg(r,n,{});return await this.cache.put(new tL(t,e),i),new tB(e,i)}async dumpCache(){return await this.cache.dump()}async internalWriteState(t,e){return await this.cache.get(new tL(t,e))}async hasContractCached(t){return await this.cache.getLast(t)!=null}async lastCachedSortKey(){return await this.cache.getLastSortKey()}setCache(t){this.cache=t}getCache(){return this.cache}};x(),x();var rR=(t,e,r,n,i)=>{let a=tC.INST.create("WASM:Rust"),o={metering:{usegas:t.useGas},console:{log:function(e){a.debug(`${t.contract.id}: ${e}`)}},Block:{height:function(){return t.block.height},indep_hash:function(){return t.block.indep_hash},timestamp:function(){return t.block.timestamp}},Transaction:{id:function(){return t.transaction.id},owner:function(){return t.transaction.owner},target:function(){return t.transaction.target}},Contract:{id:function(){return t.contract.id},owner:function(){return t.contract.owner}},KV:{get:async function(e){return await t.kv.get(e)},put:async function(e,r){await t.kv.put(e,r)}},SmartWeave:{caller:function(){return t.caller},readContractState:async function(e){return await t.contracts.readContractState(e)},viewContractState:async function(e,r){return await t.contracts.viewContractState(e,r)},write:async function(e,r){return await t.contracts.write(e,r,!1)}},Vrf:{value:function(){return t.vrf.value},randomInt:function(e){return t.vrf.randomInt(e)}}},s=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();let l=null;function c(){return(null===l||0===l.byteLength)&&(l=new Uint8Array(r.exports.memory.buffer)),l}function u(t,e){return s.decode(c().subarray(t,t+e))}let h=Array(128).fill(void 0);h.push(void 0,null,!0,!1);let f=h.length;function g(t){f===h.length&&h.push(h.length+1);let e=f;if("number"!=typeof(f=h[e]))throw Error("corrupt heap");return h[e]=t,e}function d(t){if("boolean"!=typeof t)throw Error("expected a boolean argument")}function p(t){return null==t}function y(t){if("number"!=typeof t)throw Error("expected a number argument")}let w=null,b=null;function m(){return(null===b||0===b.byteLength)&&(b=new Int32Array(r.exports.memory.buffer)),b}let v=0,_=new TextEncoder("utf-8"),E="function"==typeof _.encodeInto?function(t,e){return _.encodeInto(t,e)}:function(t,e){let r=_.encode(t);return e.set(r),{read:t.length,written:r.length}};function T(t,e,r){if("string"!=typeof t)throw Error("expected a string argument");if(void 0===r){let r=_.encode(t),n=e(r.length);return c().subarray(n,n+r.length).set(r),v=r.length,n}let n=t.length,i=e(n),a=c(),o=0;for(;o<n;o++){let e=t.charCodeAt(o);if(e>127)break;a[i+o]=e}if(o!==n){0!==o&&(t=t.slice(o)),i=r(i,n,n=o+3*t.length);let e=E(t,c().subarray(i+o,i+n));if(e.read!==t.length)throw Error("failed to pass whole string");o+=e.written}return v=o,i}function S(t){let e=h[t];return t<132||(h[t]=f,f=t),e}let x=null;function k(t,e){try{return t.apply(this,e)}catch(t){throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",function(){try{return t instanceof Error?`${t.message}

Stack:
${t.stack}`:t.toString()}catch{return"<failed to stringify thrown value>"}}()),t}}function A(t,e,n){y(t),y(e),r.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__(t,e,g(n))}let I=128;function C(t){if(1==I)throw Error("out of js stack");return h[--I]=t,I}function O(t,e){try{return t.apply(this,e)}catch(t){r.exports.__wbindgen_exn_store(g(t))}}function L(t,e,n,i){y(t),y(e),r.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__(t,e,g(n),g(i))}let B={__wbindgen_json_parse:function(t,e){return g(JSON.parse(u(t,e)))},__wbindgen_json_serialize:function(t,e){let n=h[e],i=T(JSON.stringify(void 0===n?null:n),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),a=v;m()[t/4+1]=a,m()[t/4+0]=i},__wbindgen_error_new:function(t,e){return g(Error(u(t,e)))},__wbindgen_is_undefined:function(t){let e=void 0===h[t];return d(e),e},__wbindgen_in:function(t,e){let r=h[t]in h[e];return d(r),r},__wbindgen_number_get:function(t,e){let n=h[e],i="number"==typeof n?n:void 0;p(i)||y(i),((null===w||0===w.byteLength)&&(w=new Float64Array(r.exports.memory.buffer)),w)[t/8+1]=p(i)?0:i,m()[t/4+0]=!p(i)},__wbindgen_boolean_get:function(t){let e=h[t],r="boolean"==typeof e?e?1:0:2;return y(r),r},__wbindgen_is_null:function(t){let e=null===h[t];return d(e),e},__wbindgen_string_new:function(t,e){return g(u(t,e))},__wbindgen_string_get:function(t,e){let n=h[e],i="string"==typeof n?n:void 0;var a=p(i)?0:T(i,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),o=v;m()[t/4+1]=o,m()[t/4+0]=a},__wbindgen_is_bigint:function(t){let e="bigint"==typeof h[t];return d(e),e},__wbindgen_is_object:function(t){let e=h[t],r="object"==typeof e&&null!==e;return d(r),r},__wbindgen_object_clone_ref:function(t){return g(h[t])},__wbindgen_jsval_eq:function(t,e){let r=h[t]===h[e];return d(r),r},__wbindgen_bigint_from_i64:function(t){return g(t)},__wbindgen_bigint_from_u64:function(t){return g(BigInt.asUintN(64,t))},__wbg_readContractState:function(){return O(function(t,e){return g(o.SmartWeave.readContractState(u(t,e)))},arguments)},__wbg_viewContractState:function(){return O(function(t,e,r){return g(o.SmartWeave.viewContractState(u(t,e),S(r)))},arguments)},__wbg_write:function(){return O(function(t,e,r){return g(o.SmartWeave.write(u(t,e),S(r)))},arguments)},__wbg_refreshState:function(t,e){},__wbg_kvGet:function(){return O(function(t,e){return g(o.KV.get(u(t,e)))},arguments)},__wbg_kvPut:function(){return O(function(t,e,r){return g(o.KV.put(u(t,e),S(r)))},arguments)},__wbindgen_object_drop_ref:function(t){S(t)},__wbg_error:function(){return k(function(t,e){try{o.console.log(u(t,e))}finally{r.exports.__wbindgen_free(t,e)}},arguments)},__wbg_new_abda76e883ba8a5f:function(){return k(function(){return g(Error())},arguments)},__wbg_stack:function(){return k(function(t,e){let n=Error.stackTraceLimit;Error.stackTraceLimit=25;let i=T(h[e].stack,r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),a=v;m()[t/4+1]=a,m()[t/4+0]=i,Error.stackTraceLimit=n},arguments)},__wbg_indephash:function(){return k(function(t){let e=T(o.Block.indep_hash(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_height:function(){return k(function(){let t=o.Block.height();return y(t),t},arguments)},__wbg_timestamp:function(){return k(function(){let t=o.Block.timestamp();return y(t),t},arguments)},__wbg_contractId:function(){return k(function(t){let e=T(o.Contract.id(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_contractOwner:function(){return k(function(t){let e=T(o.Contract.owner(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_id:function(){return k(function(t){let e=T(o.Transaction.id(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_owner:function(){return k(function(t){let e=T(o.Transaction.owner(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_target:function(){return k(function(t){let e=T(o.Transaction.target(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_caller:function(){return k(function(t){let e=T(o.SmartWeave.caller(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_value_b245bf3240b21a48:function(){return k(function(t){let e=T(o.Vrf.value(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_value_7d69ddc3f1ad7876:function(){return k(function(t){let e=T(o.Vrf.value(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_vrfValue:function(){return k(function(t){let e=T(o.Vrf.value(),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),n=v;m()[t/4+1]=n,m()[t/4+0]=e},arguments)},__wbg_randomInt:function(){return k(function(t){let e=o.Vrf.randomInt(t);return y(e),e},arguments)},__wbg_log:function(){return k(function(t,e){o.console.log(u(t,e))},arguments)},__wbindgen_cb_drop:function(t){let e=S(t).original;return 1==e.cnt--?(e.a=0,!0):(d(!1),!1)},__wbg_debug:function(){return k(function(t){console.log(h[t])},arguments)},__wbg_String:function(){return k(function(t,e){let n=T(String(h[e]),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),i=v;m()[t/4+1]=i,m()[t/4+0]=n},arguments)},__wbg_getwithrefkey:function(){return k(function(t,e){return g(h[t][h[e]])},arguments)},__wbg_set_841ac57cff3d672b:function(){return k(function(t,e,r){h[t][S(e)]=S(r)},arguments)},__wbindgen_number_new:function(t){return g(t)},__wbindgen_jsval_loose_eq:function(t,e){let r=h[t]==h[e];return d(r),r},__wbg_get_27fe3dac1c4d0224:function(){return k(function(t,e){return g(h[t][e>>>0])},arguments)},__wbg_set_17224bc548dd1d7b:function(){return k(function(t,e,r){h[t][e>>>0]=S(r)},arguments)},__wbg_isArray:function(){return k(function(t){let e=Array.isArray(h[t]);return d(e),e},arguments)},__wbg_length_e498fbc24f9c1d4f:function(){return k(function(t){let e=h[t].length;return y(e),e},arguments)},__wbg_new_b525de17f44a8943:function(){return k(function(){return g([])},arguments)},__wbg_instanceof_ArrayBuffer:function(){return k(function(t){let e;try{e=h[t]instanceof ArrayBuffer}catch{e=!1}let r=e;return d(r),r},arguments)},__wbg_call_95d1ea488d03e4e8:function(){return O(function(t,e){return g(h[t].call(h[e]))},arguments)},__wbg_call_9495de66fdbe016b:function(){return O(function(t,e,r){return g(h[t].call(h[e],h[r]))},arguments)},__wbg_call_94697a95cb7e239c:function(){return O(function(t,e,r){return g(h[t].call(h[e],h[r]))},arguments)},__wbg_new_f841cc6f2098f4b5:function(){return k(function(){return g(new Map)},arguments)},__wbg_set_388c4c6422704173:function(){return k(function(t,e,r){return g(h[t].set(h[e],h[r]))},arguments)},__wbg_next_88560ec06a094dea:function(){return O(function(t){return g(h[t].next())},arguments)},__wbg_next_b7d530c04fd8b217:function(){return k(function(t){return g(h[t].next)},arguments)},__wbg_done:function(){return k(function(t){let e=h[t].done;return d(e),e},arguments)},__wbg_value_6ac8da5cc5b3efda:function(){return k(function(t){return g(h[t].value)},arguments)},__wbg_isSafeInteger:function(){return k(function(t){let e=Number.isSafeInteger(h[t]);return d(e),e},arguments)},__wbg_entries:function(){return k(function(t){return g(Object.entries(h[t]))},arguments)},__wbg_new_f9876326328f45ed:function(){return k(function(){return g({})},arguments)},__wbg_iterator:function(){return k(function(){return g(Symbol.iterator)},arguments)},__wbg_new_9d3a9ce4282a18a8:function(){return k(function(t,e){try{var r={a:t,b:e};let n=new Promise((t,e)=>{let n=r.a;r.a=0;try{return L(n,r.b,t,e)}finally{r.a=n}});return g(n)}finally{r.a=r.b=0}},arguments)},__wbg_new_4beacc9c71572250:function(){return k(function(t,e){try{var r={a:t,b:e};let n=new Promise((t,e)=>{let n=r.a;r.a=0;try{return L(n,r.b,t,e)}finally{r.a=n}});return g(n)}finally{r.a=r.b=0}},arguments)},__wbg_resolve:function(){return k(function(t){return g(Promise.resolve(h[t]))},arguments)},__wbg_then_ec5db6d509eb475f:function(){return k(function(t,e){return g(h[t].then(h[e]))},arguments)},__wbg_then_a6860c82b90816ca:function(){return k(function(t,e){return g(h[t].then(h[e]))},arguments)},__wbg_then_f753623316e2873a:function(){return k(function(t,e,r){return g(h[t].then(h[e],h[r]))},arguments)},__wbg_then_58a04e42527f52c6:function(){return k(function(t,e,r){return g(h[t].then(h[e],h[r]))},arguments)},__wbg_instanceof_Uint8Array:function(){return k(function(t){let e;try{e=h[t]instanceof Uint8Array}catch{e=!1}let r=e;return d(r),r},arguments)},__wbg_new_537b7341ce90bb31:function(){return k(function(t){return g(new Uint8Array(h[t]))},arguments)},__wbg_length_27a2afe8ab42b09f:function(){return k(function(t){let e=h[t].length;return y(e),e},arguments)},__wbg_set_17499e8aa4003ebd:function(){return k(function(t,e,r){h[t].set(h[e],r>>>0)},arguments)},__wbindgen_is_function:function(t){let e="function"==typeof h[t];return d(e),e},__wbindgen_is_string:function(t){let e="string"==typeof h[t];return d(e),e},__wbg_buffer:function(){return k(function(t){return g(h[t].buffer)},arguments)},__wbg_get_baf4855f9a986186:function(){return O(function(t,e){return g(Reflect.get(h[t],h[e]))},arguments)},__wbindgen_debug_string:function(t,e){let n=T(function t(e){let r=typeof e;if("number"==r||"boolean"==r||null==e)return`${e}`;if("string"==r)return`"${e}"`;if("symbol"==r){let t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==r){let t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){let r=e.length,n="[";r>0&&(n+=t(e[0]));for(let i=1;i<r;i++)n+=", "+t(e[i]);return n+"]"}let n=/\[object ([^\]]+)\]/.exec(toString.call(e)),i;if(!(n.length>1))return toString.call(e);if("Object"==(i=n[1]))try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:i}(h[e]),r.exports.__wbindgen_malloc,r.exports.__wbindgen_realloc),i=v;m()[t/4+1]=i,m()[t/4+0]=n},__wbindgen_bigint_get_as_i64:function(t,e){let n=h[e],i="bigint"==typeof n?n:void 0;p(i)||function(t){if("bigint"!=typeof t)throw Error("expected a bigint argument")}(i),((null===x||0===x.byteLength)&&(x=new BigInt64Array(r.exports.memory.buffer)),x)[t/8+1]=p(i)?BigInt(0):i,m()[t/4+0]=!p(i)},__wbindgen_throw:function(t,e){throw Error(u(t,e))},__wbindgen_memory:function(){return g(r.exports.memory)},__wbindgen_closure_wrapper:function(){return k(function(t,e,i){let a,o;return g((a={a:t,b:e,cnt:1,dtor:n},(o=(...t)=>{a.cnt++;let e=a.a;a.a=0;try{return A(e,a.b,...t)}finally{0==--a.cnt?r.exports.__wbindgen_export_2.get(a.dtor)(e,a.b):a.a=e}}).original=a,o))},arguments)},...function(t,e){let r={};for(let[n,i]of Object.entries(t.extensions))for(let[t,n]of Object.entries(i.rustImports?.(e)??{}))t.startsWith("__wbg_")?r[t]=n:r["__wbg_"+t]=function(t){return function(){return k(function(e){return g(t(S(e)))},arguments)}}(n);return r}(t,{_assertBoolean:d,_assertNum:y,addBorrowedObject:C,addHeapObject:g,getInt32Memory0:m,getObject:function(t){return h[t]},getStringFromWasm0:u,handleError:O,heap:()=>h,logError:k,notDefined:function(t){return()=>{throw Error(`${t} is not defined`)}},passStringToWasm0:T,takeObject:S,wasm:()=>r.exports,WASM_VECTOR_LEN:()=>v,__wbg_adapter_4:L,__wbg_adapter_3:A})},N=Object.keys(B),U=e.reduce((t,e)=>{let r=N.find(t=>e.startsWith(t));if(void 0===r)throw Error(`Cannot find import mapping for ${e}. Please file a bug.`);if(1!=N.filter(t=>e.startsWith(t)).length)throw Error(`Multiple import mappings for ${e}. Please file a bug.`);if(t.usedKeys.has(r))throw Error(`Multiple methods maps to ${r}. Please file a bug.`);return t.res[e]=B[r],t.usedKeys.add(r),t},{res:{},usedKeys:new Set}).res;"__WARP_CONTRACTS_VERSION_LEGACY"===i?(U.initStateLegacy=function(t){try{r.exports.initState(C(t))}finally{h[I++]=void 0}},U.handle=function(t){return S(r.exports.handle(g(t)))}):(U.initState=function(t){try{let i,a=r.exports.__wbindgen_add_to_stack_pointer(-16);r.exports.initState(a,C(t));var e=m()[a/4+0],n=m()[a/4+1];return 0!==e&&(i=u(e,n).slice(),r.exports.__wbindgen_free(e,1*n)),i}finally{r.exports.__wbindgen_add_to_stack_pointer(16),h[I++]=void 0}},U.warpContractWrite=function(t){return S(r.exports.warpContractWrite(g(t)))},U.warpContractView=function(t){return S(r.exports.warpContractView(g(t)))}),U.currentState=function(){return S(r.exports.currentState())},U.version=function(){return r.exports.version()},U.lang=function(){return r.exports.lang()};let R={};return R.__wbindgen_placeholder__=U,U.StateWrapper=class{__destroy_into_raw(){let t=this.ptr;return this.ptr=0,t}free(){let t=this.__destroy_into_raw();r.exports.__wbg_statewrapper_free(t)}},R.metering=o.metering,{imports:R,exports:U}};x();var r$=class{gasUsed;gasLimit;transaction;block;vrf;evaluationOptions;arweave;contract;unsafeClient;contracts;extensions;_activeTx;caller;kv;constructor(t,e,r,n,i){this.gasUsed=0,this.gasLimit=Number.MAX_SAFE_INTEGER,this.unsafeClient=t,this.arweave={ar:t.ar,utils:t.utils,wallets:t.wallets,crypto:t.crypto},this.evaluationOptions=r,this.contract=e,this.transaction=new rP(this),this.block=new rM(this),this.contracts={readContractState:(t,e,r)=>{throw Error("Not implemented - should be set by HandlerApi implementor")},viewContractState:(t,e)=>{throw Error("Not implemented - should be set by HandlerApi implementor")},write:(t,e,r)=>{throw Error("Not implemented - should be set by HandlerApi implementor")},refreshState:()=>{throw Error("Not implemented - should be set by HandlerApi implementor")}},this.vrf=new rD(this),this.useGas=this.useGas.bind(this),this.getBalance=this.getBalance.bind(this),this.extensions={},this.kv=new rK(i,n,this.transaction,this.contract.id)}useGas(t){if(t<0)throw Error("[RE:GNE] Gas number exception - gas < 0.");if(this.gasUsed+=t,this.gasUsed>this.gasLimit)throw Error(`[RE:OOG] Out of gas! Used: ${this.gasUsed}, limit: ${this.gasLimit}`)}async getBalance(t,e){if(!this._activeTx)throw Error("Cannot read balance - active tx is not set.");if(!this.block.height)throw Error("Cannot read balance - block height not set.");let r=e||this.block.height;return await fetch(`${this.evaluationOptions.walletBalanceUrl}block/height/${r}/wallet/${t}/balance`).then(t=>t.ok?t.text():Promise.reject(t)).catch(t=>{throw Error(`Unable to read wallet balance. ${t.status}. ${t.body?.message}`)})}},rP=class{constructor(t){this.smartWeaveGlobal=t}get id(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.id}get owner(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.owner.address}get target(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.recipient}get tags(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.tags}get sortKey(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.sortKey}get dryRun(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return!0===this.smartWeaveGlobal._activeTx.dry}get quantity(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.quantity.winston}get reward(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.fee.winston}get origin(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return"redstone-sequencer"===this.smartWeaveGlobal._activeTx.source?"L2":"L1"}},rM=class{constructor(t){this.smartWeaveGlobal=t}get height(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.height}get indep_hash(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.id}get timestamp(){if(!this.smartWeaveGlobal._activeTx)throw Error("No current tx");return this.smartWeaveGlobal._activeTx.block.timestamp}},rD=class{constructor(t){this.smartWeaveGlobal=t}get data(){return this.smartWeaveGlobal._activeTx.vrf}get value(){return this.smartWeaveGlobal._activeTx.vrf.bigint}randomInt(t){if(!Number.isInteger(t))throw Error("Integer max value required for random integer generation");let e=BigInt(this.smartWeaveGlobal._activeTx.vrf.bigint)%BigInt(t)+BigInt(1);if(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)throw Error("Random int cannot be cast to number");return Number(e)}},rK=class{constructor(t,e,r,n){this._storage=t,this._interactionState=e,this._transaction=r,this._contractTxId=n}async put(t,e){this.checkStorageAvailable(),await this._storage.put(new tL(t,this._transaction.sortKey),e)}async get(t){return this.checkStorageAvailable(),this._transaction.sortKey,await this._interactionState.getKV(this._contractTxId,new tL(t,this._transaction.sortKey))??((await this._storage.getLessOrEqual(t,this._transaction.sortKey))?.cachedValue||null)}async del(t){this.checkStorageAvailable(),this._transaction.sortKey;let e=await this._interactionState.delKV(this._contractTxId,new tL(t,this._transaction.sortKey));if(null!=e)return e;await this._storage.del(new tL(t,this._transaction.sortKey))}async keys(t){let e=this._transaction.sortKey;return await this._storage.keys(e,t)}async kvMap(t){let e=this._transaction.sortKey;return this._storage.kvMap(e,t)}async begin(){if(this._storage)return this._storage.begin()}async commit(){this._storage&&(this._transaction.dryRun?await this._storage.rollback():await this._storage.commit())}async rollback(){this._storage&&await this._storage.rollback()}open(){if(this._storage)return this._storage.open()}close(){if(this._storage)return this._storage.close()}checkStorageAvailable(){if(!this._storage)throw Error("KV Storage not available")}};x(),x();var rj=class{constructor(t,e){this.swGlobal=t,this.contractDefinition=e,this.assignReadContractState=this.assignReadContractState.bind(this),this.assignViewContractState=this.assignViewContractState.bind(this),this.assignWrite=this.assignWrite.bind(this),this.assignRefreshState=this.assignRefreshState.bind(this)}logger=tC.INST.create("ContractHandler");async dispose(){}assignWrite(t){this.swGlobal.contracts.write=async(e,r,n)=>{if(!t.evaluationOptions.internalWrites)throw Error("Internal writes feature switched off. Change EvaluationOptions.internalWrites flag to 'true'");let i=n??t.evaluationOptions.throwOnInternalWriteError,a={from:this.contractDefinition.txId,to:e,input:r};this.logger.debug("swGlobal.write call:",a);let o=t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"write"}),s=await o.applyInput(r,this.swGlobal._activeTx);this.logger.debug("Cache result?:",!this.swGlobal._activeTx.dry);let l="ok"!==s.type&&i&&(!this.swGlobal._activeTx.dry||this.swGlobal._activeTx.dry&&this.swGlobal._activeTx.strict),c=l?`Internal write auto error for call [${JSON.stringify(a)}]: ${s.errorMessage}`:s.errorMessage,u=c?{...s.originalErrorMessages,[this.swGlobal._activeTx.id]:c}:s.originalErrorMessages;if(o.interactionState().update(o.txId(),{state:s.state,validity:{...s.originalValidity,[this.swGlobal._activeTx.id]:"ok"==s.type},errorMessages:u}),l)throw new rH("error"===s.type&&s.error?s.error:c);return s}}assignViewContractState(t){this.swGlobal.contracts.viewContractState=async(e,r)=>(this.logger.debug("swGlobal.viewContractState call:",{from:this.contractDefinition.txId,to:e,input:r}),await t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"view"}).viewStateForTx(r,this.swGlobal._activeTx))}assignReadContractState(t,e){this.swGlobal.contracts.readContractState=async(r,n)=>{this.logger.debug("swGlobal.readContractState call:",{from:this.contractDefinition.txId,to:r,sortKey:e.sortKey,transaction:this.swGlobal.transaction.id});let{contract:i,warp:a}=t,o=await a.contract(r,i,{callingInteraction:e,callType:"read"}).readState(e.sortKey);if(o?.cachedValue?.errorMessages){let t=Reflect.ownKeys(o?.cachedValue?.errorMessages);if(t.length){let e=t[t.length-1],r=o?.cachedValue?.errorMessages[e];if(r.startsWith("[SkipUnsafeError]"))throw new rH(r)}}return n?{state:eo(o.cachedValue.state),validity:o.cachedValue.validity,errorMessages:o.cachedValue.errorMessages}:eo(o.cachedValue.state)}}assignRefreshState(t){this.swGlobal.contracts.refreshState=async()=>t.contract.interactionState().get(this.swGlobal.contract.id)?.state}},rW="__init",rF=(t,e)=>{let r=Error(e);throw r.name=t,r},rV=class extends rj{constructor(t,e,r){super(t,e),this.contractFunction=r}async handle(t,e,r){let{interaction:n,interactionTx:i}=r;return this.setupSwGlobal(r),this.enableInternalWrites(t,i),this.assertNotConstructorCall(n),await this.runContractFunction(t,n,e.state)}initState(t){}async maybeCallStateConstructor(t,e){if(!this.contractDefinition.manifest?.evaluationOptions?.useConstructor)return t;{let r={input:{function:rW,args:t},caller:this.contractDefinition.owner,interactionType:"write"},n={owner:{address:e.caller,key:null},sortKey:rT};this.setupSwGlobal({interaction:r,interactionTx:n});let i=this.configureSwGlobalForConstructor(),a=await this.runContractFunction(e,r,{});if(i(),"ok"!==a.type)throw Error(`Exception while calling constructor: ${JSON.stringify(r)}:
${a.errorMessage}`);return a.state}}assertNotConstructorCall(t){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor&&t.input.function===rW)throw Error(`You have enabled {useConstructor: true} option, so you can't call function ${rW}`)}configureSwGlobalForConstructor(){let t=t=>({get:(e,r)=>rF("ConstructorError",`SmartWeave.${t}.${String(r)} is not accessible in constructor context`)});this.swGlobal.contracts.readContractState=()=>rF("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.viewContractState=()=>rF("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.refreshState=()=>rF("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.write=()=>rF("ConstructorError","Internal writes feature is not available in constructor");let e=new rM(this.swGlobal);this.swGlobal.block=new Proxy(this.swGlobal.block,t("block"));let r=new rD(this.swGlobal);this.swGlobal.vrf=new Proxy(this.swGlobal.vrf,t("vrf"));let n=new rP(this.swGlobal);return this.swGlobal.transaction=new Proxy(this.swGlobal.vrf,t("transaction")),()=>{this.swGlobal.block=e,this.swGlobal.vrf=r,this.swGlobal.transaction=n}}async runContractFunction(t,e,r){var n;let i,a;let o=eo(r),{timeoutId:s,timeoutPromise:l}=(n=t.evaluationOptions.maxInteractionEvaluationTimeSeconds,i=null,a=new Promise((t,e)=>{i=setTimeout(()=>{clearTimeout(i),e("timeout")},1e3*n)}),{timeoutId:i,timeoutPromise:a});try{await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let t=await Promise.race([l,this.contractFunction(o,e)]);if(t&&(void 0!==t.state||void 0!==t.result))return await this.swGlobal.kv.commit(),{type:"ok",result:t.result,state:t.state||o};throw Error(`Unexpected result from contract: ${JSON.stringify(t)}`)}catch(t){switch(await this.swGlobal.kv.rollback(),t.name){case"ContractError":return{type:"error",errorMessage:t.message,state:r,result:null};case"ConstructorError":throw Error(`ConstructorError: ${t.message}`);default:return{type:"exception",errorMessage:`${t&&t.stack||t&&t.message||t}`,state:r,result:null}}}finally{s&&clearTimeout(s),await this.swGlobal.kv.close()}}setupSwGlobal({interaction:t,interactionTx:e}){this.swGlobal._activeTx=e,this.swGlobal.caller=t.caller}enableInternalWrites(t,e){this.assignReadContractState(t,e),this.assignViewContractState(t),this.assignWrite(t),this.assignRefreshState(t)}};x();var rG=class extends rj{constructor(t,e,r){super(t,e),this.wasmExports=r}async handle(t,e,r){try{let{interaction:e,interactionTx:n}=r;this.swGlobal._activeTx=n,this.swGlobal.caller=e.caller,this.swGlobal.gasLimit=t.evaluationOptions.gasLimit,this.swGlobal.gasUsed=0,this.assignReadContractState(t,n),this.assignViewContractState(t),this.assignWrite(t),await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let i=await this.doHandle(e);return"view"===r.interaction.interactionType?await this.swGlobal.kv.rollback():await this.swGlobal.kv.commit(),{type:"ok",result:i,state:this.doGetCurrentState(),gasUsed:this.swGlobal.gasUsed}}catch(r){await this.swGlobal.kv.rollback();let t={errorMessage:r.message,state:e.state,result:null};return r instanceof rH?{...t,error:r.error,type:"error"}:{...t,type:"exception"}}finally{await this.swGlobal.kv.close()}}initState(t){if("rust"===this.contractDefinition.srcWasmLang){if("initStateLegacy"in this.wasmExports){this.wasmExports.initStateLegacy(t);return}let e=this.wasmExports.initState(t);if(e)throw Error(e);return}throw Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}async doHandleLegacy(t){let e=await this.wasmExports.handle(t.input);if(!e)return;if(Object.prototype.hasOwnProperty.call(e,"Ok"))return e.Ok;let r,n="";throw"string"==typeof e.Err||e.Err instanceof String?r=e.Err:"kind"in e.Err?(r=e.Err.kind,n="data"in e.Err?" "+e.Err.data:""):(r=Object.keys(e.Err)[0],n=" "+e.Err[r]),"RuntimeError"==r?Error(`[RE:RE]${n}`):new rH(`[CE:${r}${n}]`)}async doHandle(t){if("rust"===this.contractDefinition.srcWasmLang){if("handle"in this.wasmExports)return await this.doHandleLegacy(t);let e="write"===t.interactionType?await this.wasmExports.warpContractWrite(t.input):await this.wasmExports.warpContractView(t.input);if(!e)return;if("ok"===e.type)return e.result;throw this.logger.error("Error from rust",e),"error"===e.type?new rH(e.error):Error(e.errorMessage)}throw Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}async maybeCallStateConstructor(t,e){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor)throw Error("Constructor is not implemented for wasm");return t}doGetCurrentState(){if("rust"===this.contractDefinition.srcWasmLang)return this.wasmExports.currentState();throw Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}};x();var rq=m(ti()),rz=ta(),rH=class extends Error{constructor(t,e){super(t.toString()),this.error=t,this.subtype=e,this.name="ContractError"}},rJ=class{constructor(t){this.arweave=t}logger=tC.INST.create("HandlerExecutorFactory");async create(t,e,r,n){var i,a,o;if(r.hasPlugin("contract-blacklist")){let e=r.loadPlugin("contract-blacklist"),n=!1;try{n=await e.process(t.txId)}catch(t){this.logger.error(t)}if(!0==n)throw new rH(`[SkipUnsafeError] Skipping evaluation of the blacklisted contract ${t.txId}.`,"blacklistedSkip")}let s=null;e.useKVStorage&&(s=r.kvStorageFactory(t.txId));let l=new r$(this.arweave,{id:t.txId,owner:t.owner},e,n,s);if(r.matchPlugins("^smartweave-extension-").forEach(t=>{r.loadPlugin(t).process(l.extensions)}),"wasm"==t.contractType){this.logger.info("Creating handler for wasm contract",t.txId);let e=tO.measure(),r,n=null,a=(i=t.srcBinary,new Response(i,{status:200,statusText:"OK",headers:{"Content-Type":"application/wasm"}}));if("rust"===t.srcWasmLang){let e={exports:null,modifiedExports:{wasm_bindgen__convert__closures__invoke2_mut__:null,_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__:null}},i=await rY(a,t.srcBinary),o=WebAssembly.Module.exports(i).filter(t=>"global"===t.kind&&t.name.startsWith("__WARP_CONTRACTS_VERSION_")).map(t=>t.name).shift()||"__WARP_CONTRACTS_VERSION_LEGACY",{imports:s,exports:c}=rR(l,WebAssembly.Module.imports(i).filter(t=>"__wbindgen_placeholder__"===t.module).map(t=>t.name),e,t.metadata.dtor,o);n=c,r=await WebAssembly.instantiate(i,s),e.exports=r.exports,Object.keys(r.exports).forEach(t=>{t.startsWith("wasm_bindgen__convert__closures__invoke2_mut__")&&(e.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__=r.exports[t]),t.startsWith("_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__")&&(e.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__=r.exports[t])})}else throw Error(`Support for ${t.srcWasmLang} not implemented yet.`);return this.logger.info(`WASM ${t.srcWasmLang} handler created in ${e.elapsed()}`),new rG(l,t,n||r.exports)}{let n,i,s;let c=(a=t.src,o=r.hasPlugin("vm2"),i=(n=a.trim().split(`
`))[0],s=n[n.length-1],(/\(\s*\(\)\s*=>\s*{/g.test(i)||/\s*\(\s*function\s*\(\)\s*{/g.test(i))&&/}\s*\)\s*\(\)\s*;/g.test(s)&&(n.shift(),n.pop(),a=n.join(`
`)),a=a.replace(/export\s+async\s+function\s+handle/gmu,"async function handle").replace(/export\s+function\s+handle/gmu,"function handle"),o?`
    ${a}
    module.exports = handle;`:`
    const window=void 0,document=void 0,Function=void 0,eval=void 0,globalThis=void 0;
    const [SmartWeave, BigNumber, logger${ec()?", Buffer, atob, btoa":""}] = arguments;
    class ContractError extends Error { constructor(message) { super(message); this.name = 'ContractError' } };
    function ContractAssert(cond, message) { if (!cond) throw new ContractError(message) };
    ${a};
    return handle;
  `);if(c.includes("unsafeClient"))switch(e.unsafeClient){case"allow":this.logger.warn(`Reading unsafe contract ${t.txId}, evaluation is non-deterministic!`);break;case"throw":throw Error(`[SkipUnsafeError] Using unsafeClient is not allowed by default. Use EvaluationOptions.unsafeClient flag to evaluate ${t.txId}.`);case"skip":throw new rH(`[SkipUnsafeError] Skipping evaluation of the unsafe contract ${t.txId}.`,"unsafeClientSkip");default:throw Error(`Unknown unsafeClient setting ${e.unsafeClient}`)}if(!e.allowBigInt&&c.includes("BigInt"))throw Error("Using BigInt is not allowed by default. Use EvaluationOptions.allowBigInt flag.");if(r.hasPlugin("vm2"))return r.loadPlugin("vm2").process({normalizedSource:c,swGlobal:l,logger:this.logger,contractDefinition:t});if(r.hasPlugin("ivm-handler-api"))return r.loadPlugin("ivm-handler-api").process({contractSource:t.src,evaluationOptions:e,arweave:this.arweave,swGlobal:l,contractDefinition:t});{let e=Function(c),r=ec()?e(l,rz,tC.INST.create(l.contract.id),rq.Buffer,atob,btoa):e(l,rz,tC.INST.create(l.contract.id));return new rV(l,t,r)}}}};async function rY(t,e){return WebAssembly.compileStreaming?await WebAssembly.compileStreaming(t):await WebAssembly.compile(e)}x();var rQ=m(ti()),rX=class{constructor(t,e,r=null){this.contractTxId=t,this.depth=e,this.innerCallType=r,this.id=rQ.Crypto.randomUUID()}interactions={};id;addInteractionData(t){let{interaction:e,interactionTx:r}=t,n=rZ.create(new r0(r.id,r.sortKey,r.block.height,r.block.timestamp,e?.caller,e?.input.function,e?.input,r.dry,{}));return this.interactions[r.id]=n,n}getInteraction(t){return this.interactions[t]}print(){return JSON.stringify(this,null,2)}},rZ=class{constructor(t){this.interactionInput=t}interactionOutput;static create(t){return new rZ(t)}update(t){this.interactionOutput=t}},r0=class{constructor(t,e,r,n,i,a,o,s,l={}){this.txId=t,this.sortKey=e,this.blockHeight=r,this.blockTimestamp=n,this.caller=i,this.functionName=a,this.functionArguments=o,this.dryWrite=s,this.foreignContractCalls=l}};x();var r1=m(tS());x(),x();var r2=((nC=r2||{}).CONTRACT_NOT_FOUND="CONTRACT_NOT_FOUND",nC),r6=class extends Error{type;otherInfo;constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.otherInfo=e}getType(){return this.type}},r4=class{logger=tC.INST.create("Evolve");constructor(){this.modify=this.modify.bind(this)}async modify(t,e){let{definitionLoader:r,executorFactory:n}=e.warp,i=e.contractDefinition.txId,a=r4.evolvedSrcTxId(t),o=e.contractDefinition.srcTxId;if(a&&o!==a)try{this.logger.info("Evolving to: ",a);let s=await r.load(i,a),l=await n.create(s,e.evaluationOptions,e.warp,e.contract.interactionState());return e.contractDefinition=s,e.handler=l,e.handler.initState(t),this.logger.debug("evolved to:",{evolve:a,newSrcTxId:e.contractDefinition.srcTxId,currentSrcTxId:o,contract:e.contractDefinition.txId}),e}catch(t){throw"ContractError"===t.name&&"unsafeClientSkip"===t.subtype?t:new r6("CONTRACT_NOT_FOUND",{message:`Error while evolving ${i} from ${o} to ${a}: ${t}`,requestedTxId:i})}return e}static evolvedSrcTxId(t){if(!function(t){if(!t)return!1;let e=r8(t);return void 0!==t.evolve||e.has("evolve")}(t))return;let e=r8(t),r=t.evolve||e.get("evolve"),n=t.canEvolve||e.get("canEvolve");if(null==n&&(n=!0),r&&/[a-z0-9_-]{43}/i.test(r)&&n)return r}};function r8(t){var e,r;let n=new Map;return t.settings&&(null!=(e=t.settings)&&"function"==typeof e[Symbol.iterator]?n=new Map(t.settings):"object"!=typeof(r=t.settings)||null===r||Array.isArray(r)||(n=new Map(Object.entries(t.settings)))),n}x(),x(),x();var r5=m(tx(),1);r5.default.configure;var r3=r5.default;async function r9(t,e,r,n,i,a="",o="0",s=!1,l,c){let u={data:Math.random().toString().slice(-4)};a&&a.length&&(u.target=a.toString(),o&&+o>0&&(u.quantity=o.toString())),s&&(u.reward="0",u.last_tx="p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"),c&&c.length&&(u.reward=c);let h=await t.createTransaction(u);return r7(r,n,l,i).forEach(t=>h.addTag(t.name,t.value)),e&&await e(h),h}function r7(t,e,r,n){let i=[];if(n&&n.length)for(let t of n)i.push(new ex(t.name.toString(),t.value.toString()));return i.push(new ex(eb.APP_NAME,"SmartWeaveAction")),i.push(new ex(eb.APP_VERSION,"0.3.0")),i.push(new ex(eb.SDK,"Warp")),i.push(new ex(eb.CONTRACT_TX_ID,t)),i.push(new ex(eb.INPUT,JSON.stringify(e))),r&&i.push(new ex(em.WARP_TESTNET,"1.0.0")),i}x(),x();var nt={target:"",winstonQty:"0"};x();var ne=class{eval(t){let e=[];return Object.keys(t.interactions).forEach(r=>{let n=t.interactions[r];this.evalForeignCalls(t.contractTxId,n,e)}),e}evalForeignCalls(t,e,r){Object.keys(e.interactionInput.foreignContractCalls).forEach(n=>{let i=e.interactionInput.foreignContractCalls[n];"write"==i.innerCallType&&Object.keys(i.interactions).forEach(e=>{let n=i.interactions[e];n.interactionInput.dryWrite&&!r.includes(i.contractTxId)&&t!==i.contractTxId&&r.push(i.contractTxId),this.evalForeignCalls(t,n,r)})})}};x(),x();var nr=Object.create,nn=Object.defineProperty,ni=Object.getOwnPropertyDescriptor,na=Object.getOwnPropertyNames,no=Object.getPrototypeOf,ns=Object.prototype.hasOwnProperty,nl=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),nc=(t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of na(e))ns.call(t,i)||i===r||nn(t,i,{get:()=>e[i],enumerable:!(n=ni(e,i))||n.enumerable});return t},nu=(t,e,r)=>(r=null!=t?nr(no(t)):{},nc(!e&&t&&t.__esModule?r:nn(r,"default",{value:t,enumerable:!0}),t)),nh=nl(t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var e=t.length,r=e%4;if(!r)return t;var n=e,i=4-r,a=e+i,o=s.Buffer.alloc(a);for(o.write(t);i--;)o.write("=",n++);return o.toString()}}),nf=nl(t=>{Object.defineProperty(t,"__esModule",{value:!0});var e=nh();function r(t,e){return void 0===e&&(e="utf8"),s.Buffer.isBuffer(t)?i(t.toString("base64")):i(s.Buffer.from(t,e).toString("base64"))}function n(t){return t=t.toString(),e.default(t).replace(/\-/g,"+").replace(/_/g,"/")}function i(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}r.encode=r,r.decode=function(t,e){return void 0===e&&(e="utf8"),s.Buffer.from(n(t),"base64").toString(e)},r.toBase64=n,r.fromBase64=i,r.toBuffer=function(t){return s.Buffer.from(n(t),"base64")},t.default=r}),ng=nl((t,e)=>{e.exports=nf().default,e.exports.default=e.exports}),nd=nl(t=>{t.byteLength=function(t){var e=s(t),r=e[0],n=e[1];return(r+n)*3/4-n},t.toByteArray=function(t){var e,r,n=s(t),o=n[0],l=n[1],c=new a((o+l)*3/4-l),u=0,h=l>0?o-4:o;for(r=0;r<h;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],c[u++]=e>>16&255,c[u++]=e>>8&255,c[u++]=255&e;return 2===l&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,c[u++]=255&e),1===l&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,c[u++]=e>>8&255,c[u++]=255&e),c},t.fromByteArray=function(t){for(var e,r=t.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(function(t,e,r){for(var i,a=[],o=e;o<r;o+=3)a.push(n[(i=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]))>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}(t,o,o+16383>s?s:o+16383));return 1===i?a.push(n[(e=t[r-1])>>2]+n[e<<4&63]+"=="):2===i&&a.push(n[(e=(t[r-2]<<8)+t[r-1])>>10]+n[e>>4&63]+n[e<<2&63]+"="),a.join("")};var e,r,n=[],i=[],a="u">typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(e=0,r=o.length;e<r;++e)n[e]=o[e],i[o.charCodeAt(e)]=e;function s(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63}),np=nl(t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.b64UrlDecode=t.b64UrlEncode=t.bufferTob64Url=t.bufferTob64=t.b64UrlToBuffer=t.stringToB64Url=t.stringToBuffer=t.bufferToString=t.b64UrlToString=t.concatBuffers=void 0;var e=nd();function r(t){return new TextDecoder("utf-8",{fatal:!0}).decode(t)}function n(t){return new TextEncoder().encode(t)}function i(t){return new Uint8Array(e.toByteArray(l(t)))}function a(t){return e.fromByteArray(new Uint8Array(t))}function o(t){return s(a(t))}function s(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}function l(t){let e;return e=(t=t.replace(/\-/g,"+").replace(/\_/g,"/")).length%4==0?0:4-t.length%4,t.concat("=".repeat(e))}t.concatBuffers=function(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r].byteLength;let r=new Uint8Array(e),n=0;r.set(new Uint8Array(t[0]),n),n+=t[0].byteLength;for(let e=1;e<t.length;e++)r.set(new Uint8Array(t[e]),n),n+=t[e].byteLength;return r},t.b64UrlToString=function(t){return r(i(t))},t.bufferToString=r,t.stringToBuffer=n,t.stringToB64Url=function(t){return o(n(t))},t.b64UrlToBuffer=i,t.bufferTob64=a,t.bufferTob64Url=o,t.b64UrlEncode=s,t.b64UrlDecode=l}),ny=nl(t=>{Object.defineProperty(t,"__esModule",{value:!0});var e=np(),r=class{keyLength=4096;publicExponent=65537;hashAlgorithm="sha256";driver;constructor(){if(!this.detectWebCrypto())throw Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:r}={}){let n=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(n)}async hash(t,e="SHA-256"){let r=await this.driver.digest(e,t);return new Uint8Array(r)}async verify(t,e,r){let n=await this.jwkToPublicCryptoKey({kty:"RSA",e:"AQAB",n:t}),i=await this.driver.digest("SHA-256",e),a=await this.driver.verify({name:"RSA-PSS",saltLength:0},n,r,e),o=await this.driver.verify({name:"RSA-PSS",saltLength:32},n,r,e),s=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((n.algorithm.modulusLength-1)/8)-i.byteLength-2},n,r,e);return a||o||s}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let t=crypto?.subtle;return void 0!==t&&["generateKey","importKey","exportKey","digest","sign"].every(e=>"function"==typeof t[e])}async encrypt(t,r,n){let i=await this.driver.importKey("raw","string"==typeof r?e.stringToBuffer(r):r,{name:"PBKDF2",length:32},!1,["deriveKey"]),a=await this.driver.deriveKey({name:"PBKDF2",salt:n?e.stringToBuffer(n):e.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),o=new Uint8Array(16);crypto.getRandomValues(o);let s=await this.driver.encrypt({name:"AES-CBC",iv:o},a,t);return e.concatBuffers([o,s])}async decrypt(t,r,n){let i=await this.driver.importKey("raw","string"==typeof r?e.stringToBuffer(r):r,{name:"PBKDF2",length:32},!1,["deriveKey"]),a=await this.driver.deriveKey({name:"PBKDF2",salt:n?e.stringToBuffer(n):e.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),o=t.slice(0,16),s=await this.driver.decrypt({name:"AES-CBC",iv:o},a,t.slice(16));return e.concatBuffers([s])}};t.default=r}),nw=nl(t=>{t.read=function(t,e,r,n,i){var a,o,s=8*i-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=r?i-1:0,f=r?-1:1,g=t[e+h];for(h+=f,a=g&(1<<-u)-1,g>>=-u,u+=s;u>0;a=256*a+t[e+h],h+=f,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+t[e+h],h+=f,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:(g?-1:1)*(1/0);o+=Math.pow(2,n),a-=c}return(g?-1:1)*o*Math.pow(2,a-n)},t.write=function(t,e,r,n,i,a){var o,s,l,c=8*a-i-1,u=(1<<c)-1,h=u>>1,f=23===i?5960464477539062e-23:0,g=n?0:a-1,d=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(s=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+h>=1?e+=f/l:e+=f*Math.pow(2,1-h),e*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(e*l-1)*Math.pow(2,i),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+g]=255&s,g+=d,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;t[r+g]=255&o,g+=d,o/=256,c-=8);t[r+g-d]|=128*p}}),nb=nl(t=>{var e=nd(),r=nw(),n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function i(t){if(t>2147483647)throw RangeError('The value "'+t+'" is invalid for option "size"');let e=new Uint8Array(t);return Object.setPrototypeOf(e,a.prototype),e}function a(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return l(t)}return o(t,e,r)}function o(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!a.isEncoding(e))throw TypeError("Unknown encoding: "+e);let r=0|f(t,e),n=i(r),o=n.write(t,e);return o!==r&&(n=n.slice(0,o)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(R(t,Uint8Array)){let e=new Uint8Array(t);return u(e.buffer,e.byteOffset,e.byteLength)}return c(t)}(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(R(t,ArrayBuffer)||t&&R(t.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(R(t,SharedArrayBuffer)||t&&R(t.buffer,SharedArrayBuffer)))return u(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');let n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return a.from(n,e,r);let o=function(t){var e;if(a.isBuffer(t)){let e=0|h(t.length),r=i(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?i(0):c(t):"Buffer"===t.type&&Array.isArray(t.data)?c(t.data):void 0}(t);if(o)return o;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return a.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function s(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return s(t),i(t<0?0:0|h(t))}function c(t){let e=t.length<0?0:0|h(t.length),r=i(e);for(let n=0;n<e;n+=1)r[n]=255&t[n];return r}function u(t,e,r){let n;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),a.prototype),n}function h(t){if(t>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function f(t,e){if(a.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||R(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);let r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return B(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return N(t).length;default:if(i)return n?-1:B(t).length;e=(""+e).toLowerCase(),i=!0}}function g(t,r,n){let i=!1;if((void 0===r||r<0)&&(r=0),r>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0)||(n>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){let n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=e;n<r;++n)i+=$[t[n]];return i}(this,r,n);case"utf8":case"utf-8":return w(this,r,n);case"ascii":return function(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,r,n);case"latin1":case"binary":return function(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,r,n);case"base64":var a,o;return a=r,o=n,0===a&&o===this.length?e.fromByteArray(this):e.fromByteArray(this.slice(a,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){let n=t.slice(e,r),i="";for(let t=0;t<n.length-1;t+=2)i+=String.fromCharCode(n[t]+256*n[t+1]);return i}(this,r,n);default:if(i)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function d(t,e,r){let n=t[e];t[e]=t[r],t[r]=n}function p(t,e,r,n,i){var o;if(0===t.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(o=r=+r)!=o&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return -1;r=t.length-1}else if(r<0){if(!i)return -1;r=0}if("string"==typeof e&&(e=a.from(e,n)),a.isBuffer(e))return 0===e.length?-1:y(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):y(t,[e],r,n,i);throw TypeError("val must be string, number or Buffer")}function y(t,e,r,n,i){let a,o=1,s=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;o=2,s/=2,l/=2,r/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){let n=-1;for(a=r;a<s;a++)if(c(t,a)===c(e,-1===n?0:a-n)){if(-1===n&&(n=a),a-n+1===l)return n*o}else -1!==n&&(a-=a-n),n=-1}else for(r+l>s&&(r=s-l),a=r;a>=0;a--){let r=!0;for(let n=0;n<l;n++)if(c(t,a+n)!==c(e,n)){r=!1;break}if(r)return a}return -1}function w(t,e,r){r=Math.min(t.length,r);let n=[],i=e;for(;i<r;){let e=t[i],a=null,o=e>239?4:e>223?3:e>191?2:1;if(i+o<=r){let r,n,s,l;switch(o){case 1:e<128&&(a=e);break;case 2:(192&(r=t[i+1]))==128&&(l=(31&e)<<6|63&r)>127&&(a=l);break;case 3:r=t[i+1],n=t[i+2],(192&r)==128&&(192&n)==128&&(l=(15&e)<<12|(63&r)<<6|63&n)>2047&&(l<55296||l>57343)&&(a=l);break;case 4:r=t[i+1],n=t[i+2],s=t[i+3],(192&r)==128&&(192&n)==128&&(192&s)==128&&(l=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&s)>65535&&l<1114112&&(a=l)}}null===a?(a=65533,o=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=o}return function(t){let e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}function b(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function m(t,e,r,n,i,o){if(!a.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function v(t,e,r,n,i){I(e,n,i,t,r,7);let a=Number(e&BigInt(4294967295));t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,r}function _(t,e,r,n,i){I(e,n,i,t,r,7);let a=Number(e&BigInt(4294967295));t[r+7]=a,a>>=8,t[r+6]=a,a>>=8,t[r+5]=a,a>>=8,t[r+4]=a;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=o,o>>=8,t[r+2]=o,o>>=8,t[r+1]=o,o>>=8,t[r]=o,r+8}function E(t,e,r,n,i,a){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function T(t,e,n,i,a){return e=+e,n>>>=0,a||E(t,e,n,4,34028234663852886e22,-34028234663852886e22),r.write(t,e,n,i,23,4),n+4}function S(t,e,n,i,a){return e=+e,n>>>=0,a||E(t,e,n,8,17976931348623157e292,-17976931348623157e292),r.write(t,e,n,i,52,8),n+8}t.Buffer=a,t.SlowBuffer=function(t){return+t!=t&&(t=0),a.alloc(+t)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=2147483647,a.TYPED_ARRAY_SUPPORT=function(){try{let t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch{return!1}}(),!a.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(t,e,r){return o(t,e,r)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(t,e,r){return s(t),t<=0?i(t):void 0!==e?"string"==typeof r?i(t).fill(e,r):i(t).fill(e):i(t)},a.allocUnsafe=function(t){return l(t)},a.allocUnsafeSlow=function(t){return l(t)},a.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==a.prototype},a.compare=function(t,e){if(R(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),R(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(t)||!a.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,n=e.length;for(let i=0,a=Math.min(r,n);i<a;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){let r;if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;let n=a.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){let e=t[r];if(R(e,Uint8Array))i+e.length>n.length?(a.isBuffer(e)||(e=a.from(e)),e.copy(n,i)):Uint8Array.prototype.set.call(n,e,i);else if(a.isBuffer(e))e.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=e.length}return n},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){let t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)d(this,e,e+1);return this},a.prototype.swap32=function(){let t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},a.prototype.swap64=function(){let t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},a.prototype.toString=function(){let t=this.length;return 0===t?"":0==arguments.length?w(this,0,t):g.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(t){if(!a.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){let e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(t,e,r,n,i){if(R(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;let o=i-n,s=r-e,l=Math.min(o,s),c=this.slice(n,i),u=t.slice(e,r);for(let t=0;t<l;++t)if(c[t]!==u[t]){o=c[t],s=u[t];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},a.prototype.indexOf=function(t,e,r){return p(this,t,e,r,!0)},a.prototype.lastIndexOf=function(t,e,r){return p(this,t,e,r,!1)},a.prototype.write=function(t,e,r,n){var i,a,o,s,l,c,u,h;if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let f=this.length-e;if((void 0===r||r>f)&&(r=f),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let g=!1;for(;;)switch(n){case"hex":return function(t,e,r,n){let i;r=Number(r)||0;let a=t.length-r;n?(n=Number(n))>a&&(n=a):n=a;let o=e.length;for(n>o/2&&(n=o/2),i=0;i<n;++i){let n=parseInt(e.substr(2*i,2),16);if(n!=n)break;t[r+i]=n}return i}(this,t,e,r);case"utf8":case"utf-8":return i=e,a=r,U(B(t,this.length-i),this,i,a);case"ascii":case"latin1":case"binary":return o=e,s=r,U(function(t){let e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(t),this,o,s);case"base64":return l=e,c=r,U(N(t),this,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=e,h=r,U(function(t,e){let r,n,i=[];for(let a=0;a<t.length&&!((e-=2)<0);++a)n=(r=t.charCodeAt(a))>>8,i.push(r%256),i.push(n);return i}(t,this.length-u),this,u,h);default:if(g)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),g=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(t,e){let r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);let n=this.subarray(t,e);return Object.setPrototypeOf(n,a.prototype),n},a.prototype.readUintLE=a.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);let n=this[t],i=1,a=0;for(;++a<e&&(i*=256);)n+=this[t+a]*i;return n},a.prototype.readUintBE=a.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);let n=this[t+--e],i=1;for(;e>0&&(i*=256);)n+=this[t+--e]*i;return n},a.prototype.readUint8=a.prototype.readUInt8=function(t,e){return t>>>=0,e||b(t,1,this.length),this[t]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readBigUInt64LE=P(function(t){C(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&O(t,this.length-8);let n=e+256*this[++t]+65536*this[++t]+16777216*this[++t],i=this[++t]+256*this[++t]+65536*this[++t]+16777216*r;return BigInt(n)+(BigInt(i)<<BigInt(32))}),a.prototype.readBigUInt64BE=P(function(t){C(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&O(t,this.length-8);let n=16777216*e+65536*this[++t]+256*this[++t]+this[++t],i=16777216*this[++t]+65536*this[++t]+256*this[++t]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),a.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);let n=this[t],i=1,a=0;for(;++a<e&&(i*=256);)n+=this[t+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},a.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);let n=e,i=1,a=this[t+--n];for(;n>0&&(i*=256);)a+=this[t+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*e)),a},a.prototype.readInt8=function(t,e){return t>>>=0,e||b(t,1,this.length),128&this[t]?-((255-this[t]+1)*1):this[t]},a.prototype.readInt16LE=function(t,e){t>>>=0,e||b(t,2,this.length);let r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt16BE=function(t,e){t>>>=0,e||b(t,2,this.length);let r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},a.prototype.readInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readBigInt64LE=P(function(t){C(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&O(t,this.length-8),(BigInt(this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24))<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+16777216*this[++t])}),a.prototype.readBigInt64BE=P(function(t){C(t>>>=0,"offset");let e=this[t],r=this[t+7];return(void 0===e||void 0===r)&&O(t,this.length-8),(BigInt((e<<24)+65536*this[++t]+256*this[++t]+this[++t])<<BigInt(32))+BigInt(16777216*this[++t]+65536*this[++t]+256*this[++t]+r)}),a.prototype.readFloatLE=function(t,e){return t>>>=0,e||b(t,4,this.length),r.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return t>>>=0,e||b(t,4,this.length),r.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return t>>>=0,e||b(t,8,this.length),r.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return t>>>=0,e||b(t,8,this.length),r.read(this,t,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;m(this,t,e,r,n,0)}let i=1,a=0;for(this[e]=255&t;++a<r&&(i*=256);)this[e+a]=t/i&255;return e+r},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;m(this,t,e,r,n,0)}let i=r-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+r},a.prototype.writeUint8=a.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,1,255,0),this[e]=255&t,e+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeBigUInt64LE=P(function(t,e=0){return v(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=P(function(t,e=0){return _(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){let n=Math.pow(2,8*r-1);m(this,t,e,r,n-1,-n)}let i=0,a=1,o=0;for(this[e]=255&t;++i<r&&(a*=256);)t<0&&0===o&&0!==this[e+i-1]&&(o=1),this[e+i]=(t/a>>0)-o&255;return e+r},a.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){let n=Math.pow(2,8*r-1);m(this,t,e,r,n-1,-n)}let i=r-1,a=1,o=0;for(this[e+i]=255&t;--i>=0&&(a*=256);)t<0&&0===o&&0!==this[e+i+1]&&(o=1),this[e+i]=(t/a>>0)-o&255;return e+r},a.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},a.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||m(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeBigInt64LE=P(function(t,e=0){return v(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=P(function(t,e=0){return _(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeFloatLE=function(t,e,r){return T(this,t,e,!0,r)},a.prototype.writeFloatBE=function(t,e,r){return T(this,t,e,!1,r)},a.prototype.writeDoubleLE=function(t,e,r){return S(this,t,e,!0,r)},a.prototype.writeDoubleBE=function(t,e,r){return S(this,t,e,!1,r)},a.prototype.copy=function(t,e,r,n){if(!a.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);let i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},a.prototype.fill=function(t,e,r,n){let i;if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!a.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){let e=t.charCodeAt(0);("utf8"===n&&e<128||"latin1"===n)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{let o=a.isBuffer(t)?t:a.from(t,n),s=o.length;if(0===s)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=o[i%s]}return this};var x={};function k(t,e,r){x[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function A(t){let e="",r=t.length,n="-"===t[0]?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function I(t,e,r,n,i,a){if(t>r||t<e){let n="bigint"==typeof e?"n":"",i;throw i=a>3?0===e||e===BigInt(0)?`>= 0${n} and < 2${n} ** ${(a+1)*8}${n}`:`>= -(2${n} ** ${(a+1)*8-1}${n}) and < 2 ** ${(a+1)*8-1}${n}`:`>= ${e}${n} and <= ${r}${n}`,new x.ERR_OUT_OF_RANGE("value",i,t)}C(i,"offset"),(void 0===n[i]||void 0===n[i+a])&&O(i,n.length-(a+1))}function C(t,e){if("number"!=typeof t)throw new x.ERR_INVALID_ARG_TYPE(e,"number",t)}function O(t,e,r){throw Math.floor(t)!==t?(C(t,r),new x.ERR_OUT_OF_RANGE(r||"offset","an integer",t)):e<0?new x.ERR_BUFFER_OUT_OF_BOUNDS:new x.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}k("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),k("ERR_INVALID_ARG_TYPE",function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`},TypeError),k("ERR_OUT_OF_RANGE",function(t,e,r){let n=`The value of "${t}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>4294967296?i=A(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=A(i)),i+="n"),n+=` It must be ${e}. Received ${i}`},RangeError);var L=/[^+/0-9A-Za-z-_]/g;function B(t,e){e=e||1/0;let r,n=t.length,i=null,a=[];for(let o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319||o+1===n){(e-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return a}function N(t){return e.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(L,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function U(t,e,r,n){let i;for(i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function R(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}var $=function(){let t="0123456789abcdef",e=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)e[n+i]=t[r]+t[i]}return e}();function P(t){return typeof BigInt>"u"?M:t}function M(){throw Error("BigInt not supported")}}),nm=nl((t,e)=>{"u">typeof window?(window.global=window,c.fetch=window.fetch,e.exports={Buffer:nb().Buffer,Crypto:window.crypto}):e.exports={Buffer:nb().Buffer,Crypto:crypto}}),nv={};((t,e)=>{for(var r in e)nn(t,r,{get:e[r],enumerable:!0})})(nv,{AVSCTap:()=>nW,ArweaveSigner:()=>n$,DataItem:()=>nX,MAX_TAG_BYTES:()=>nY,MIN_BINARY_SIZE:()=>nQ,SIG_CONFIG:()=>nR,SignatureConfig:()=>i,Signer:()=>n_,createData:()=>n0,deserializeTags:()=>nG,indexToType:()=>nP,serializeTags:()=>nF,tagsExceedLimit:()=>nV});var n_=class{signer;publicKey;signatureType;signatureLength;ownerLength;pem;static verify(t,e,r,n){throw Error("You must implement verify method on child")}},nE=nu(ng(),1),nT=nu(np(),1);async function nS(t){if(Array.isArray(t)){let e=(0,nT.concatBuffers)([(0,nT.stringToBuffer)("list"),(0,nT.stringToBuffer)(t.length.toString())]);return await nx(t,await nU().hash(e,"SHA-384"))}let e=(0,nT.concatBuffers)([(0,nT.stringToBuffer)("blob"),(0,nT.stringToBuffer)(t.byteLength.toString())]),r=(0,nT.concatBuffers)([await nU().hash(e,"SHA-384"),await nU().hash(t,"SHA-384")]);return await nU().hash(r,"SHA-384")}async function nx(t,e){if(t.length<1)return e;let r=(0,nT.concatBuffers)([e,await nS(t[0])]),n=await nU().hash(r,"SHA-384");return await nx(t.slice(1),n)}var nk,nA,nI,nC,nO,nL=nu(ny(),1),nB=nL.default.default?nL.default.default:nL.default,nN=class extends nB{getPublicKey(t){throw Error("Unimplemented")}};function nU(){return nO??=new nN}(n=i||(i={}))[n.ARWEAVE=1]="ARWEAVE",n[n.ED25519=2]="ED25519",n[n.ETHEREUM=3]="ETHEREUM",n[n.SOLANA=4]="SOLANA",n[n.INJECTEDAPTOS=5]="INJECTEDAPTOS",n[n.MULTIAPTOS=6]="MULTIAPTOS",n[n.TYPEDETHEREUM=7]="TYPEDETHEREUM";var nR={[i.ARWEAVE]:{sigLength:512,pubLength:512,sigName:"arweave"},[i.ED25519]:{sigLength:64,pubLength:32,sigName:"ed25519"},[i.ETHEREUM]:{sigLength:65,pubLength:65,sigName:"ethereum"},[i.SOLANA]:{sigLength:64,pubLength:32,sigName:"solana"},[i.INJECTEDAPTOS]:{sigLength:64,pubLength:32,sigName:"injectedAptos"},[i.MULTIAPTOS]:{sigLength:2052,pubLength:1025,sigName:"multiAptos"},[i.TYPEDETHEREUM]:{sigLength:65,pubLength:42,sigName:"typedEthereum"}},n$=class{signatureType=1;ownerLength=nR[1].pubLength;signatureLength=nR[1].sigLength;jwk;pk;constructor(t){this.pk=t.n,this.jwk=t}get publicKey(){return nE.default.toBuffer(this.pk)}sign(t){return nU().sign(this.jwk,t)}static async verify(t,e,r){return await nU().verify(t,e,r)}},nP={1:n$},nM=nu(ng(),1);async function nD(t){return nS([(0,nT.stringToBuffer)("dataitem"),(0,nT.stringToBuffer)("1"),(0,nT.stringToBuffer)(t.signatureType.toString()),t.rawOwner,t.rawTarget,t.rawAnchor,t.rawTags,t.rawData])}async function nK(t,e){let r=await nD(t),n=await e.sign(r),i=await nU().hash(n);return{signature:s.Buffer.from(n),id:s.Buffer.from(i)}}async function nj(t,e){let{signature:r,id:n}=await nK(t,e);return t.getRaw().set(r,2),n}var nW=class{buf;pos;constructor(t=s.Buffer.alloc(nY),e=0){this.buf=t,this.pos=e}writeTags(t){if(!Array.isArray(t))throw Error("input must be array");let e=t.length,r;if(e)for(this.writeLong(e),r=0;r<e;r++){let e=t[r];if(e?.name===void 0||e?.value===void 0)throw Error(`Invalid tag format for ${e}, expected {name:string, value: string}`);this.writeString(e.name),this.writeString(e.value)}this.writeLong(0)}toBuffer(){let t=s.Buffer.alloc(this.pos);if(this.pos>this.buf.length)throw Error(`Too many tag bytes (${this.pos} > ${this.buf.length})`);return this.buf.copy(t,0,0,this.pos),t}tagsExceedLimit(){return this.pos>this.buf.length}writeLong(t){let e=this.buf,r,n;if(t>=-1073741824&&t<1073741824){n=t>=0?t<<1:~t<<1|1;do e[this.pos]=127&n,n>>=7;while(n&&(e[this.pos++]|=128))}else{r=t>=0?2*t:-(2*t)-1;do e[this.pos]=127&r,r/=128;while(r>=1&&(e[this.pos++]|=128))}this.pos++,this.buf=e}writeString(t){let e=s.Buffer.byteLength(t),r=this.buf;this.writeLong(e);let n=this.pos;if(this.pos+=e,!(this.pos>r.length)){if(e>64)this.buf.write(t,this.pos-e,e,"utf8");else{let i,a,o;for(i=0;i<e;i++)(a=t.charCodeAt(i))<128?r[n++]=a:a<2048?(r[n++]=a>>6|192,r[n++]=63&a|128):(64512&a)==55296&&(64512&(o=t.charCodeAt(i+1)))==56320?(a=65536+((1023&a)<<10)+(1023&o),i++,r[n++]=a>>18|240,r[n++]=a>>12&63|128,r[n++]=a>>6&63|128,r[n++]=63&a|128):(r[n++]=a>>12|224,r[n++]=a>>6&63|128,r[n++]=63&a|128)}this.buf=r}}readLong(){let t=0,e=0,r=this.buf,n,i,a,o;do i=128&(n=r[this.pos++]),t|=(127&n)<<e,e+=7;while(i&&e<28);if(i){a=t,o=268435456;do a+=(127&(n=r[this.pos++]))*o,o*=128;while(128&n);return(a%2?-(a+1):a)/2}return t>>1^-(1&t)}skipLong(){let t=this.buf;for(;128&t[this.pos++];);}readTags(){let t=[],e;for(;e=this.readLong();)for(e<0&&(e=-e,this.skipLong());e--;){let e=this.readString(),r=this.readString();t.push({name:e,value:r})}return t}readString(){let t=this.readLong(),e=this.pos,r=this.buf;if(this.pos+=t,!(this.pos>r.length))return this.buf.slice(e,e+t).toString()}};function nF(t){let e=new nW;return e.writeTags(t),e.toBuffer()}function nV(t){let e=new nW;return e.writeTags(t),e.tagsExceedLimit()}function nG(t){return new nW(t).readTags()}function nq(t){let e=0;for(let r=t.length-1;r>=0;r--)e=256*e+t[r];return e}function nz(t){let e=[0,0,0,0,0,0,0,0];for(let r=0;r<e.length;r++){let n=255&t;e[r]=n,t=(t-n)/256}return Uint8Array.from(e)}var nH=nu(nm(),1),nJ=nu(nb(),1),nY=4096,nQ=80,nX=class{binary;_id;constructor(t){this.binary=t}static isDataItem(t){return void 0!==t.binary}get signatureType(){let t=nq(this.binary.subarray(0,2));if(i?.[t]!==void 0)return t;throw Error("Unknown signature type: "+t)}async isValid(){return nX.verify(this.binary)}get id(){return(async()=>nM.default.encode(await this.rawId))()}set id(t){this._id=nM.default.toBuffer(t)}get rawId(){return(async()=>nJ.Buffer.from(await nH.Crypto.subtle.digest("SHA-256",this.rawSignature)))()}set rawId(t){this._id=t}get rawSignature(){return this.binary.subarray(2,2+this.signatureLength)}get signature(){return nM.default.encode(this.rawSignature)}set rawOwner(t){if(t.byteLength!=this.ownerLength)throw Error(`Expected raw owner (pubkey) to be ${this.ownerLength} bytes, got ${t.byteLength} bytes.`);this.binary.set(t,2+this.signatureLength)}get rawOwner(){return this.binary.subarray(2+this.signatureLength,2+this.signatureLength+this.ownerLength)}get signatureLength(){return nR[this.signatureType].sigLength}get owner(){return nM.default.encode(this.rawOwner)}get ownerLength(){return nR[this.signatureType].pubLength}get rawTarget(){let t=this.getTargetStart();return 1==this.binary[t]?this.binary.subarray(t+1,t+33):nJ.Buffer.alloc(0)}get target(){return nM.default.encode(this.rawTarget)}get rawAnchor(){let t=this.getAnchorStart();return 1==this.binary[t]?this.binary.subarray(t+1,t+33):nJ.Buffer.alloc(0)}get anchor(){return this.rawAnchor.toString()}get rawTags(){let t=this.getTagsStart(),e=nq(this.binary.subarray(t+8,t+16));return this.binary.subarray(t+16,t+16+e)}get tags(){let t=this.getTagsStart();if(0==nq(this.binary.subarray(t,t+8)))return[];let e=nq(this.binary.subarray(t+8,t+16));return nG(nJ.Buffer.from(this.binary.subarray(t+16,t+16+e)))}get tagsB64Url(){return this.tags.map(t=>({name:nM.default.encode(t.name),value:nM.default.encode(t.value)}))}getStartOfData(){let t=this.getTagsStart(),e=nq(this.binary.subarray(t+8,t+16));return t+16+e}get rawData(){let t=this.getTagsStart(),e=nq(this.binary.subarray(t+8,t+16)),r=t+16+e;return this.binary.subarray(r,this.binary.length)}get data(){return nM.default.encode(this.rawData)}getRaw(){return this.binary}async sign(t){return this._id=await nj(this,t),this.rawId}async setSignature(t){this.binary.set(t,2),this._id=nJ.Buffer.from(await nU().hash(t))}isSigned(){return(this._id?.length??0)>0}toJSON(){return{signature:this.signature,owner:this.owner,target:this.target,tags:this.tags.map(t=>({name:nM.default.encode(t.name),value:nM.default.encode(t.value)})),data:this.data}}static async verify(t){if(t.byteLength<nQ)return!1;let e=new nX(t),r=e.signatureType,n=e.getTagsStart(),i=nq(t.subarray(n,n+8)),a=nq(t.subarray(n+8,n+16));if(a>nY)return!1;if(i>0)try{if(nG(nJ.Buffer.from(t.subarray(n+16,n+16+a))).length!==i)return!1}catch{return!1}let o=nP[r],s=await nD(e);return await o.verify(e.rawOwner,s,e.rawSignature)}async getSignatureData(){return nD(this)}getTagsStart(){let t=this.getTargetStart(),e=1==this.binary[t],r=t+(e?33:1),n=1==this.binary[r];return r+(n?33:1)}getTargetStart(){return 2+this.signatureLength+this.ownerLength}getAnchorStart(){return this.getTargetStart()+1+(1==this.binary[this.getTargetStart()]?32:0)}},nZ=nu(ng(),1);function n0(t,e,r){let n=e.publicKey,i=r?.target?nZ.default.toBuffer(r.target):null,a=1+(i?.byteLength??0),o=r?.anchor?s.Buffer.from(r.anchor):null,l=1+(o?.byteLength??0),c=(r?.tags?.length??0)>0?nF(r.tags):null,u=16+(c?c.byteLength:0),h=s.Buffer.from(t),f=h.byteLength,g=2+e.signatureLength+e.ownerLength+a+l+u+f,d=s.Buffer.alloc(g);if(d.set(function(t){if(t>29)throw Error("Short too long");let e=[0,0];for(let r=0;r<e.length;r++){let n=255&t;e[r]=n,t=(t-n)/256}return Uint8Array.from(e)}(e.signatureType),0),d.set(new Uint8Array(e.signatureLength).fill(0),2),n.byteLength!==e.ownerLength)throw Error(`Owner must be ${e.ownerLength} bytes, but was incorrectly ${n.byteLength}`);d.set(n,2+e.signatureLength);let p=2+e.signatureLength+e.ownerLength;if(d[p]=i?1:0,i){if(32!==i.byteLength)throw Error(`Target must be 32 bytes but was incorrectly ${i.byteLength}`);d.set(i,p+1)}let y=p+a,w=y+1;if(d[y]=o?1:0,o){if(w+=o.byteLength,32!==o.byteLength)throw Error("Anchor must be 32 bytes");d.set(o,y+1)}d.set(nz(r?.tags?.length??0),w);let b=nz(c?.byteLength??0);d.set(b,w+8),c&&d.set(c,w+16);let m=w+u;return d.set(h,m),new nX(d)}var n1={...nv};globalThis.arbundles??=n1;var n2=class{signer;bundlerSigner;type;warp;signatureProviderType;wallet;cachedAddress;constructor(t,e){this.warp=t,this.isCustomSignature(e)?(this.assertEnvForCustomSigner(e.type),this.signer=e.signer,this.type=e.type,this.signatureProviderType="CustomSignature"):this.isValidBundlerSignature(e)?(this.signatureProviderType="BundlerSigner",this.type=function(t){if(3===t)return"ethereum";if(1===t)return"arweave";throw Error(`Not supported arbundle SignatureType : ${t}`)}(e.signatureType),this.bundlerSigner=e):(this.assignArweaveSigner(e),this.bundlerSigner="string"==typeof e?null:new n$(e),this.signatureProviderType="ArWallet",this.type="arweave"),this.wallet=e}async getAddress(){if(this.cachedAddress)return this.cachedAddress;switch(this.signatureProviderType){case"CustomSignature":return this.wallet.getAddress?this.cachedAddress=await this.wallet.getAddress():this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"ArWallet":case"BundlerSigner":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;default:throw Error("Unknown Signature::signatureProvider : "+this.signatureProviderType)}}async deduceSignerBySigning(){let{arweave:t}=this.warp;if("BundlerSigner"==this.signatureProviderType)try{return await this.bundlerSigner.getAddress()}catch{throw Error("Could not get address from the signer. Is the 'getAddress' implementation correct?'")}else if("ArWallet"==this.signatureProviderType||"CustomSignature"==this.signatureProviderType){let e=await t.createTransaction({data:Math.random().toString().slice(-4),reward:"72600854",last_tx:"p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"});return await this.signer(e),t.wallets.ownerToAddress(e.owner)}else throw Error("Unknown Signature::type")}checkNonArweaveSigningAvailability(t){if("arweave"!==this.type&&!t)throw Error(`Unable to use signing function of type: ${this.type} when bundling is disabled.`)}checkBundlerSignerAvailability(t){if((!t||"local"==this.warp.environment)&&"BundlerSigner"==this.signatureProviderType)throw Error("Only wallet of type 'ArWallet' or 'CustomSignature' is allowed when bundling is disabled or in local environment.")}assignArweaveSigner(t){this.signer=async e=>{await this.warp.arweave.transactions.sign(e,t)}}assertEnvForCustomSigner(t){if("warp"===this.warp.interactionsLoader.type())throw Error("Unable to use signing function when bundling is enabled.");if("ethereum"==t)throw Error(`Unable to use signing function with signature of type: ${t}.`)}isCustomSignature(t){return void 0!==t.signer&&void 0!==t.type}isValidBundlerSignature(t){let e=!!t.signatureType&&!!t.ownerLength&&!!t.signatureLength;if(e&&!t.publicKey)throw Error("It seems that you are using BundlerSigner, but publicKey is not set! Maybe try calling await bundlerSigner.setPublicKey() before using it.");return e}};x();var n6=class{rootOptions;saferEvaluationOptions={internalWrites:t=>{if(void 0===t.internalWrites||this.rootOptions.internalWrites==t.internalWrites)return this.rootOptions.internalWrites;if(this.rootOptions.internalWrites&&!t.internalWrites||!this.rootOptions.internalWrites&&t.internalWrites)return t.internalWrites;throw Error('Could not determine "internalWrites" value ')},throwOnInternalWriteError:t=>void 0===t.throwOnInternalWriteError?this.rootOptions.throwOnInternalWriteError:t.throwOnInternalWriteError,unsafeClient:t=>{if(void 0===t.unsafeClient||this.rootOptions.unsafeClient==t.unsafeClient||"throw"===this.rootOptions.unsafeClient||"skip"===this.rootOptions.unsafeClient)return this.rootOptions.unsafeClient;if("allow"===this.rootOptions.unsafeClient)return"throw"===t.unsafeClient?"skip":t.unsafeClient;throw Error('Could not determine "unsafeClient" value')},ignoreExceptions:t=>{if(void 0===t.ignoreExceptions||this.rootOptions.ignoreExceptions==t.ignoreExceptions||this.rootOptions.ignoreExceptions&&!t.ignoreExceptions||!this.rootOptions.ignoreExceptions&&t.ignoreExceptions)return this.rootOptions.ignoreExceptions;throw Error('Could not determine "ignoreExceptions" value')},waitForConfirmation:()=>this.rootOptions.waitForConfirmation,updateCacheForEachInteraction:()=>this.rootOptions.updateCacheForEachInteraction,maxCallDepth:()=>this.rootOptions.maxCallDepth,maxInteractionEvaluationTimeSeconds:()=>this.rootOptions.maxInteractionEvaluationTimeSeconds,stackTrace:()=>this.rootOptions.stackTrace,sourceType:()=>this.rootOptions.sourceType,sequencerUrl:()=>this.rootOptions.sequencerUrl,gasLimit:()=>this.rootOptions.gasLimit,allowBigInt:()=>this.rootOptions.allowBigInt,walletBalanceUrl:()=>this.rootOptions.walletBalanceUrl,mineArLocalBlocks:()=>this.rootOptions.mineArLocalBlocks,cacheEveryNInteractions:()=>this.rootOptions.cacheEveryNInteractions,remoteStateSyncEnabled:()=>this.rootOptions.remoteStateSyncEnabled,remoteStateSyncSource:()=>this.rootOptions.remoteStateSyncSource,useKVStorage:t=>t.useKVStorage,useConstructor:t=>t.useConstructor};notConflictingEvaluationOptions=["useKVStorage","sourceType","useConstructor"];constructor(t,e){if(e){let r=[];for(let n in e){let i=n,a=e[n],o=t[n];if(!this.notConflictingEvaluationOptions.includes(i)){if("internalWrites"===i){if(!1===o&&!0===a)throw Error("Cannot proceed with contract evaluation. User is blocking internal writes, while contract requires them.")}else if("unsafeClient"===i){if("throw"===o&&"throw"!==a||"skip"===o&&"allow"===a)throw Error(`Cannot proceed with contract evaluation. User requires to ${o} on any unsafeClient usage, while contract uses ${a} option.`)}else t[n]!==e[n]&&r.push(`Option {${n}} differs. EvaluationOptions: [${t[n]}], manifest: [${e[n]}]. Use contract.setEvaluationOptions({${n}: ${e[n]}}) to evaluate contract state.`)}}if(r.length)throw Error(r.join(`
`))}this.rootOptions=Object.freeze(Object.assign({},t,e||{}))}forForeignContract(t){let e=eo(this.rootOptions);if(t)for(let r in t)e[r]=this.saferEvaluationOptions[r](t);return Object.freeze(e)}};x();var n4=class{constructor(t){this.warp=t,this.warp=t}name="WarpFetchWrapper";logger=tC.INST.create(this.name);fetch(t,e){let r;if(this.warp.hasPlugin("fetch-options")){let n=this.warp.loadPlugin("fetch-options");try{let i=n.process({input:t,init:e||{}});r={...e,...i}}catch(t){throw t.message&&this.logger.error(t.message),Error(`Unable to process fetch options: ${t.message}`)}}else r=e;return fetch(t,r)}};x(),Error("timeout while waiting for mutex to become available"),Error("mutex already locked");var n8=Error("request for lock canceled"),n5=class{constructor(t,e=n8){this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}acquire(t=1){if(t<=0)throw Error(`invalid weight ${t}: must be positive`);return new Promise((e,r)=>{this._weightedQueues[t-1]||(this._weightedQueues[t-1]=[]),this._weightedQueues[t-1].push({resolve:e,reject:r}),this._dispatch()})}runExclusive(t,e=1){var r,n,i,a;return r=this,n=void 0,i=void 0,a=function*(){let[r,n]=yield this.acquire(e);try{return yield t(r)}finally{n()}},new(i||(i=Promise))(function(t,e){function o(t){try{l(a.next(t))}catch(t){e(t)}}function s(t){try{l(a.throw(t))}catch(t){e(t)}}function l(e){var r;e.done?t(e.value):((r=e.value)instanceof i?r:new i(function(t){t(r)})).then(o,s)}l((a=a.apply(r,n||[])).next())})}waitForUnlock(t=1){if(t<=0)throw Error(`invalid weight ${t}: must be positive`);return new Promise(e=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),this._weightedWaiters[t-1].push(e),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatch()}release(t=1){if(t<=0)throw Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatch()}cancel(){this._weightedQueues.forEach(t=>t.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var t;for(let e=this._value;e>0;e--){let r=null===(t=this._weightedQueues[e-1])||void 0===t?void 0:t.shift();if(!r)continue;let n=this._value,i=e;this._value-=e,e=this._value+1,r.resolve([n,this._newReleaser(i)])}this._drainUnlockWaiters()}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){for(let t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach(t=>t()),this._weightedWaiters[t-1]=[])}},n3=class{constructor(t){this._semaphore=new n5(1,t)}acquire(){var t,e,r,n;return t=this,e=void 0,r=void 0,n=function*(){let[,t]=yield this._semaphore.acquire();return t},new(r||(r=Promise))(function(i,a){function o(t){try{l(n.next(t))}catch(t){a(t)}}function s(t){try{l(n.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?i(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(o,s)}l((n=n.apply(t,e||[])).next())})}runExclusive(t){return this._semaphore.runExclusive(()=>t())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};x();var n9=class{constructor(t){this._warp=t}_json=new Map;_initialJson=new Map;_kv=new Map;has(t){return this._json.has(t)}get(t){return this._json.get(t)||null}async getKV(t,e){return this._kv.has(t)&&(await this._kv.get(t).get(e))?.cachedValue||null}async delKV(t,e){this._kv.has(t)&&await this._kv.get(t).del(e)}getKvKeys(t,e,r){return this._warp.kvStorageFactory(t).keys(e,r)}getKvRange(t,e,r){return this._warp.kvStorageFactory(t).kvMap(e,r)}async commit(t){if(t.dry)return await this.rollbackKVs(),this.reset();try{await this.doStoreJson(this._json,t),await this.commitKVs()}finally{this.reset()}}async commitKV(){await this.commitKVs(),this._kv.clear()}async rollback(t){try{await this.doStoreJson(this._initialJson,t),await this.rollbackKVs()}finally{this.reset()}}setInitial(t,e){this._initialJson.set(t,e),this._json.set(t,e)}update(t,e){this._json.set(t,e)}async updateKV(t,e,r){await (await this.getOrInitKvStorage(t)).put(e,r)}async getOrInitKvStorage(t){if(this._kv.has(t))return this._kv.get(t);let e=this._warp.kvStorageFactory(t);return this._kv.set(t,e),await e.open(),e}reset(){this._json.clear(),this._initialJson.clear(),this._kv.clear()}async doStoreJson(t,e){if(t.size>1)for(let[r,n]of t)await this._warp.stateEvaluator.putInCache(r,e,n)}async rollbackKVs(){for(let t of this._kv.values())try{await t.rollback()}finally{await t.close()}}async commitKVs(){for(let t of this._kv.values())try{await t.commit()}finally{await t.close()}}},n7=m(ti()),it=m(tS()),ie=class{constructor(t,e,r=null,n=null){if(this._contractTxId=t,this.warp=e,this._parentContract=r,this._innerCallData=n,this.waitForConfirmation=this.waitForConfirmation.bind(this),this._arweaveWrapper=new ek(e),this._sorter=new rS(e.arweave),null!=r){this._evaluationOptions=this.getRoot().evaluationOptions(),this._callDepth=r.callDepth()+1;let e=r.getCallStack().getInteraction(n.callingInteraction.id);if(this._callDepth>this._evaluationOptions.maxCallDepth)throw Error(`Max call depth of ${this._evaluationOptions.maxCallDepth} has been exceeded for interaction ${JSON.stringify(e.interactionInput)}`);if(this.logger.debug("Calling interaction",{id:n.callingInteraction.id,sortKey:n.callingInteraction.sortKey,type:n.callType}),e.interactionInput?.foreignContractCalls[t]?.innerCallType==="write"&&"read"===n.callType)throw Error("Calling a readContractState after performing an inner write is wrong - instead use a state from the result of an internal write.");let i=new rX(t,this._callDepth,n?.callType);e.interactionInput.foreignContractCalls[t]=i,this._callStack=i,this._rootSortKey=r.rootSortKey,r._children.push(this)}else this._callDepth=0,this._callStack=new rX(t,0),this._rootSortKey=null,this._evaluationOptions=new ed,this._children=[],this._interactionState=new n9(e);this.getCallStack=this.getCallStack.bind(this),this._warpFetchWrapper=new n4(this.warp)}logger=tC.INST.create("HandlerBasedContract");ecLogger=tC.INST.create("ExecutionContext");_innerWritesEvaluator=new ne;_callDepth;_arweaveWrapper;_mutex=new n3;_callStack;_evaluationOptions;_eoEvaluator;_benchmarkStats=null;_sorter;_rootSortKey;_signature;_warpFetchWrapper;_children=[];_interactionState;_dreStates=new Map;async readState(t,e,r){if(this.logger.info("Read state for",{contractTxId:this._contractTxId,sortKeyOrBlockHeight:t}),!this.isRoot()&&null==t)throw Error("SortKey MUST be always set for non-root contract calls");let{stateEvaluator:n}=this.warp,i="number"==typeof t?this._sorter.generateLastSortKey(t):t;if(i&&!this.isRoot()&&this.interactionState().has(this.txId())){let t=this.interactionState().get(this.txId());return new tB(i,t)}let a=await this._mutex.acquire();try{let t=tO.measure();this.maybeResetRootContract();let e=await this.createExecutionContext(this._contractTxId,i,!1,r);this.logger.info("Execution Context",{srcTxId:e.contractDefinition?.srcTxId,missingInteractions:e.sortedInteractions?.length,cachedSortKey:e.cachedState?.sortKey}),t.stop();let a=tO.measure(),o=await n.eval(e);a.stop();let s=t.elapsed(!0)+a.elapsed(!0);return this._benchmarkStats={gatewayCommunication:t.elapsed(!0),stateEvaluation:a.elapsed(!0),total:s},this.logger.info("Benchmark",{"Gateway communication  ":t.elapsed(),"Contract evaluation    ":a.elapsed(),"Total:                 ":`${s.toFixed(0)}ms`}),i&&!this.isRoot()&&this.interactionState().update(this.txId(),o.cachedValue),o}finally{a()}}async readStateFor(t,e){return this.readState(t,void 0,e)}async viewState(t,e=[],r=nt,n){return this.logger.info("View state for",this._contractTxId),await this.callContract(t,"view",n,void 0,e,r)}async viewStateForTx(t,e){return this.logger.info(`View state for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"view")}async dryWrite(t,e,r,n,i){return this.logger.info("Dry-write for",this._contractTxId),await this.callContract(t,"write",e,void 0,r,n,void 0,i)}async applyInput(t,e){return this.logger.info(`Apply-input from transaction ${e.id} for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"write")}async writeInteraction(t,e){if(this.logger.info("Write interaction",{input:t,options:e}),!this._signature)throw Error("Wallet not connected. Use 'connect' method first.");let{arweave:r,interactionsLoader:n,environment:i}=this.warp;await this.warp.definitionLoader.load(this._contractTxId);let a=e?.tags||[],o=e?.transfer||nt,s=e?.strict===!0,l=e?.vrf===!0,c=e?.disableBundling===!0,u=e?.reward,h="warp"==n.type()&&!c;if(this._signature.checkNonArweaveSigningAvailability(h),this._signature.checkBundlerSignerAvailability(h),h&&o.target!=nt.target&&o.winstonQty!=nt.winstonQty)throw Error("Ar Transfers are not allowed for bundled interactions");if(l&&!h&&"mainnet"===i)throw Error("Vrf generation is only available for bundle interaction");if(!t)throw Error(`Input should be a truthy value: ${JSON.stringify(t)}`);if(h)return await this.bundleInteraction(t,{tags:a,strict:s,vrf:l});{let e=await this.createInteraction(t,a,o,s,!1,l&&"mainnet"!==i,u),n=await r.transactions.post(e);if(200!==n.status)return this.logger.error("Error while posting transaction",n),null;if(this._evaluationOptions.waitForConfirmation){this.logger.info("Waiting for confirmation of",e.id);let t=tO.measure();await this.waitForConfirmation(e.id),this.logger.info("Transaction confirmed after",t.elapsed())}return"local"==this.warp.environment&&this._evaluationOptions.mineArLocalBlocks&&await this.warp.testing.mineBlock(),{originalTxId:e.id}}}async bundleInteraction(t,e){this.logger.info("Bundle interaction input",t);let r=await this.createInteractionDataItem(t,e.tags,nt,e.strict,e.vrf),n=this._warpFetchWrapper.fetch(`${es(this._evaluationOptions.sequencerUrl)}/gateway/v2/sequencer/register`,{method:"POST",headers:{"Content-Type":"application/octet-stream",Accept:"application/json"},body:r.getRaw()}),i=await r.id;return{bundlrResponse:await eu(n),originalTxId:i}}async createInteractionDataItem(t,e,r,n,i=!1){let a;this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,n,i),i&&e.push(new ex(em.REQUEST_VRF,"true"));let o=r7(this._contractTxId,t,"testnet"===this.warp.environment,e);if(nV(o))throw Error("Interaction tags exceed limit of 4096 bytes.");let s=Math.random().toString().slice(-4),l=this._signature.bundlerSigner;if(!l)throw Error("Signer not set correctly. If you connect wallet through 'use_wallet', please remember that it only works when bundling is disabled.");return ec()&&l.signer?.signDataItem?a=await l.signDataItem(s,o):(a=n0(s,l,{tags:o}),await a.sign(l)),!this._evaluationOptions.internalWrites&&n&&await this.checkInteractionInStrictMode(a.owner,t,e,r,n,i),a}async createInteraction(t,e,r,n,i=!1,a=!1,o){this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,n,a),a&&e.push(new ex(em.REQUEST_VRF,"true"));let s=await r9(this.warp.arweave,this._signature.signer,this._contractTxId,t,e,r.target,r.winstonQty,i,"testnet"===this.warp.environment,o);return!this._evaluationOptions.internalWrites&&n&&await this.checkInteractionInStrictMode(s.owner,t,e,r,n,a),s}async checkInteractionInStrictMode(t,e,r,n,i,a){let{arweave:o}=this.warp,s="arweave"==this._signature.type?await o.wallets.ownerToAddress(t):t,l=await this.callContract(e,"write",s,void 0,r,n,i,a);if("ok"!==l.type)throw Error("Cannot create interaction: "+JSON.stringify(l.error||l.errorMessage))}txId(){return this._contractTxId}getCallStack(){return this._callStack}connect(t){return this._signature=new n2(this.warp,t),this}setEvaluationOptions(t){if(!this.isRoot())throw Error("Evaluation options can be set only for the root contract");return this._evaluationOptions={...this._evaluationOptions,...t},this}async waitForConfirmation(t){let{arweave:e}=this.warp,r=await e.transactions.getStatus(t);return null===r.confirmed?(this.logger.info(`Transaction ${t} not yet confirmed. Waiting another 20 seconds before next check.`),await ei(2e4),this.waitForConfirmation(t)):(this.logger.info(`Transaction ${t} confirmed`,r),r)}async createExecutionContext(t,e,r=!1,n){let{definitionLoader:i,interactionsLoader:a,stateEvaluator:o}=this.warp,s=tO.measure(),l=await o.latestAvailableState(t,e);this.logger.debug("cache lookup",s.elapsed()),s.reset();let c=r4.evolvedSrcTxId(l?.cachedValue?.state),u,h,f,g,d=n||[];if(this.logger.debug("Cached state",l,e),l&&l.sortKey==e)this.logger.debug("State fully cached, not loading interactions."),(r||c||n?.length)&&(h=await i.load(t,c),n?.length&&(d=(await this._sorter.sort(n.map(t=>({node:t,cursor:null})))).map(t=>t.node)));else{if(n?.length)throw Error(`Cannot apply requested interactions at ${e}`);if(h=await i.load(t,c),(f=this.resolveEvaluationOptions(h.manifest?.evaluationOptions)).remoteStateSyncEnabled&&!f.useKVStorage){g=await this.getRemoteContractState(t),l=await this.maybeSyncStateWithRemoteSource(g,e,l);let r=r4.evolvedSrcTxId(l?.cachedValue?.state);r&&r!==h.srcTxId&&(h=await i.load(t,r))}g||0!=d.length||(d=await a.load(t,l?.sortKey,this.getToSortKey(e),f)),l?.sortKey&&(d=d.filter(t=>t.sortKey.localeCompare(l?.sortKey)>0)),e&&(d=d.filter(t=>0>=t.sortKey.localeCompare(e))),this.logger.debug("contract and interactions load",s.elapsed()),this.isRoot()&&d.length&&(this._rootSortKey=d[d.length-1].sortKey)}return h&&(f||(f=this.resolveEvaluationOptions(h.manifest?.evaluationOptions)),this.ecLogger.debug(`Evaluation options ${t}:`,f),u=await this.warp.executorFactory.create(h,f,this.warp,this.interactionState())),{warp:this.warp,contract:this,contractDefinition:h,sortedInteractions:d,evaluationOptions:f||this.evaluationOptions(),handler:u,cachedState:l,requestedSortKey:e}}resolveEvaluationOptions(t){return this.isRoot()?(this._eoEvaluator=new n6(this.evaluationOptions(),t),this._eoEvaluator.rootOptions):this.getRootEoEvaluator().forForeignContract(t)}async getRemoteContractState(t){if(this.hasDreState(t))return this.getDreState(t);{let e=await this.fetchRemoteContractState(t);return null!=e?this.setDREState(t,e):null}}async fetchRemoteContractState(t){return eu(this._warpFetchWrapper.fetch(`${this._evaluationOptions.remoteStateSyncSource}?id=${t}&events=false`))}getToSortKey(t){return this._parentContract?.rootSortKey?t?this._parentContract.rootSortKey.localeCompare(t)>0?this._parentContract.rootSortKey:t:this._parentContract.rootSortKey:t}async createExecutionContextFromTx(t,e){let r=e.owner.address,n=e.sortKey;return{...await this.createExecutionContext(t,n,!0),caller:r}}maybeResetRootContract(){this.isRoot()&&(this.logger.debug("Clearing call stack for the root contract"),this._callStack=new rX(this.txId(),0),this._rootSortKey=null,this.warp.interactionsLoader.clearCache(),this._children=[],this._interactionState=new n9(this.warp),this._dreStates=new Map)}async callContract(t,e,r,n,i=[],a=nt,o=!1,s=!1,l=!0){var c,u;let h;this.logger.info("Call contract input",t),this.maybeResetRootContract(),this._signature||this.logger.warn("Wallet not set.");let{arweave:f,stateEvaluator:g}=this.warp,d=await this.createExecutionContext(this._contractTxId,n,!0),p="mainnet"==this.warp.environment?await this._arweaveWrapper.warpGwBlock():await f.blocks.getCurrent(),y;y=r||(this._signature?await this._signature.getAddress():""),this.logger.info("effectiveCaller",y),d={...d,caller:y};let w=await g.eval(d);this.logger.info("Current state",w.cachedValue.state);let b={input:t,caller:d.caller,interactionType:e};this.logger.debug("interaction",b);let m=(c=await r9(f,l?this._signature?.signer:void 0,this._contractTxId,t,i,a.target,a.winstonQty,!0,"testnet"===this.warp.environment),u=d.caller,h=new eA().decodeTags(c),{id:c.id,owner:{address:u,key:""},recipient:c.target,tags:h,fee:{winston:c.reward,ar:""},quantity:{winston:c.quantity,ar:""},block:{id:p.indep_hash,height:p.height,timestamp:p.timestamp,previous:null},dry:!0,anchor:null,signature:null,data:null,parent:null,bundledIn:null});if(this.logger.debug("Creating sortKey for",{blockId:m.block.id,id:m.id,height:m.block.height}),m.sortKey=await this._sorter.createSortKey(m.block.id,m.id,m.block.height,!0),m.strict=o,s){it.default.utils;let t=this.warp.maybeLoadPlugin("vrf");t?m.vrf=t.process().generateMockVrf(m.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')}let v=await this.evalInteraction({interaction:b,interactionTx:m},d,w.cachedValue);return"ok"!==v.type&&this.logger.fatal("Error while interacting with contract",{type:v.type,error:v.errorMessage}),v}async doApplyInputOnTx(t,e,r){this.maybeResetRootContract();let n,i=await this.createExecutionContextFromTx(this._contractTxId,e);!this.isRoot()&&this.interactionState().has(this.txId())?n=new tB(e.sortKey,this.interactionState().get(this.txId())):(n=await this.warp.stateEvaluator.eval(i),this.interactionState().update(this.txId(),n.cachedValue)),this.logger.debug("callContractForTx - evalStateResult",{result:n.cachedValue.state,txId:this._contractTxId});let a={interaction:{input:t,caller:this._parentContract.txId(),interactionType:r},interactionTx:e},o=await this.evalInteraction(a,i,n.cachedValue);return o.originalValidity=n.cachedValue.validity,o.originalErrorMessages=n.cachedValue.errorMessages,o}async evalInteraction(t,e,r){let n=this.getCallStack().addInteractionData(t),i=tO.measure();await e.handler.initState(r.state);let a=await e.handler.handle(e,r,t);return n.update({cacheHit:!1,outputState:this._evaluationOptions.stackTrace.saveState?a.state:void 0,executionTime:i.elapsed(!0),valid:"ok"===a.type,errorMessage:a.errorMessage,gasUsed:a.gasUsed}),a}parent(){return this._parentContract}callDepth(){return this._callDepth}evaluationOptions(){return this._evaluationOptions}lastReadStateStats(){return this._benchmarkStats}async stateHash(t){let e=r3(t),r=await n7.Crypto.subtle.digest("SHA-256",s.Buffer.from(e,"utf-8"));return s.Buffer.from(r).toString("hex")}async syncState(t,e){let{stateEvaluator:r}=this.warp,n=await this._warpFetchWrapper.fetch(`${t}?${new URLSearchParams({id:this._contractTxId,...e})}`).then(t=>t.ok?t.json():Promise.reject(t)).catch(t=>{throw t.body?.message&&this.logger.error(t.body.message),Error(`Unable to retrieve state. ${t.status}: ${t.body?.message}`)});return await r.syncState(this._contractTxId,n.sortKey,n.state,n.validity),this}async evolve(t,e){return await this.writeInteraction({function:"evolve",value:t},e)}get rootSortKey(){return this._rootSortKey}getRootEoEvaluator(){return this.getRoot()._eoEvaluator}isRoot(){return null==this._parentContract}async getStorageValues(t){let e=await this.warp.stateEvaluator.getCache().getLast(this.txId());if(null==e)return new tB(null,new Map);let r=this.warp.kvStorageFactory(this.txId()),n=new Map;try{for(let i of(await r.open(),t)){let t=await r.getLessOrEqual(i,e.sortKey);n.set(i,null==t?null:t.cachedValue)}return new tB(e.sortKey,n)}finally{await r.close()}}interactionState(){return this.getRoot()._interactionState}getRoot(){let t=this;for(;!t.isRoot();)t=t.parent();return t}async maybeSyncStateWithRemoteSource(t,e,r){let{stateEvaluator:n}=this.warp;return this.isStateHigherThanAndUpTo(t,r?.sortKey,e)?await n.syncState(this._contractTxId,t.sortKey,t.cachedValue.state,t.cachedValue.validity):r}isStateHigherThanAndUpTo(t,e,r){return t&&(!r||r>=t.sortKey)&&(!e||t.sortKey>e)}setDREState(t,e){let r=new tB(e.sortKey,new eg(e.state,{},e.errorMessages));return this.getRoot()._dreStates.set(t,r),r}getDreState(t){return this.getRoot()._dreStates.get(t)}hasDreState(t){return this.getRoot()._dreStates.has(t)}async discoverInternalWrites(t,e,r,n,i){let a=await this.callContract(t,"write",void 0,void 0,e,r,n,i,!1);if(n&&"ok"!==a.type)throw Error("Cannot create interaction: "+JSON.stringify(a.error||a.errorMessage));let o=this.getCallStack(),s=this._innerWritesEvaluator.eval(o);this.logger.debug("Input",t),this.logger.debug("Callstack",o.print()),s.forEach(t=>{e.push(new ex(em.INTERACT_WRITE,t))}),this.logger.debug("Tags with inner calls",e)}};x();var ir=class extends ie{async currentBalance(t){let e=await this.viewState({function:"balance",target:t});if("ok"!==e.type)throw Error(e.errorMessage);return e.result}async currentState(){return(await super.readState()).cachedValue.state}async transfer(t,e){return await this.writeInteraction({function:"transfer",...t},e)}};x();var ii=class{constructor(t){this.arweave=t}async mineBlock(){this.validateEnv(),await this.arweave.api.get("mine")}async addFunds(t){let e=await this.arweave.wallets.getAddress(t);await this.arweave.api.get(`/mint/${e}/1000000000000000`)}async isArlocal(){return(await fetch(`${this.arweave.api.config.protocol}://${this.arweave.api.config.host}:${this.arweave.api.config.port}/info`).then(t=>t.ok?t.json():Promise.reject()).catch(t=>{throw Error(`Unable to get network info: ${t.message}`)})).network.includes("arlocal")}async validateEnv(){if(!await this.isArlocal())throw Error("Testing features are not available in a non testing environment")}};x(),x();var ia=class{constructor(t,e){this.baseImplementation=t,this.sourceCode=e}async create(t,e,r,n){return Object.prototype.hasOwnProperty.call(this.sourceCode,t.txId)&&(t={...t,src:this.sourceCode[t.txId]}),await this.baseImplementation.create(t,e,r,n)}},io=class{constructor(t,e,r="custom"){this._arweave=t,this._stateCache=e,this._environment=r}_definitionLoader;_interactionsLoader;_executorFactory;_stateEvaluator;setDefinitionLoader(t){return this._definitionLoader=t,this}setInteractionsLoader(t){return this._interactionsLoader=t,this}setExecutorFactory(t){return this._executorFactory=t,this}setStateEvaluator(t){return this._stateEvaluator=t,this}overwriteSource(t){if(null==this._executorFactory)throw Error("Set base ExecutorFactory first");return this._executorFactory=new ia(this._executorFactory,t),this.build()}useWarpGateway(t,e){this._interactionsLoader=new rL(new ef(t.confirmationStatus,t.source));let r=new t$({...e,dbLocation:`${e.dbLocation}/contracts`}),n=new t$({...e,dbLocation:`${e.dbLocation}/source`});return this._definitionLoader=new rw(this._arweave,r,n,this._environment),this}useArweaveGateway(){return this._definitionLoader=new rp(this._arweave,this._environment),this._interactionsLoader=new rL(new rO(this._arweave,this._environment)),this}build(){let t=new ic(this._arweave,this._definitionLoader,this._interactionsLoader,this._executorFactory,this._stateEvaluator,this._environment);return this._definitionLoader.warp=t,this._interactionsLoader.warp=t,t}};x();var is=["^smartweave-extension-"],il=["evm-signature-verification","subscription","ivm-handler-api","evaluation-progress","fetch-options","deploy","contract-blacklist","vm2","vrf"],ic=class{constructor(t,e,r,n,i,a="custom"){this.arweave=t,this.definitionLoader=e,this.interactionsLoader=r,this.executorFactory=n,this.stateEvaluator=i,this.environment=a,this.testing=new ii(t),this.kvStorageFactory=t=>new t$({inMemory:!1,dbLocation:`${ig}/kv/ldb/${t}`})}_createContract;_gwUrl=ih;get createContract(){if(!this._createContract){if(this.plugins.has("deploy")){let t=this.loadPlugin("deploy");this._createContract=t.process(this)}else throw Error("In order to use CreateContract methods please attach DeployPlugin.")}return this._createContract}testing;kvStorageFactory;whoAmI;plugins=new Map;static builder(t,e,r){return new io(t,e,r)}contract(t,e,r){return new ie(t,this,e,r)}async deploy(t,e){return await this.createContract.deploy(t,e)}async deployFromSourceTx(t,e){return await this.createContract.deployFromSourceTx(t,e)}async deployBundled(t){return await this.createContract.deployBundled(t)}async register(t,e){return await this.createContract.register(t,e)}async createSource(t,e,r=!1){return await this.createContract.createSource(t,e,r)}async saveSource(t,e){return await this.createContract.saveSource(t,e)}pst(t){return new ir(t,this)}useStateCache(t){return this.stateEvaluator.setCache(t),this}useContractCache(t,e){return this.definitionLoader.setSrcCache(e),this.definitionLoader.setCache(t),this}use(t){let e=t.type();if(!this.isPluginType(e))throw Error(`Unknown plugin type ${e}.`);return this.plugins.set(e,t),this}hasPlugin(t){return this.plugins.has(t)}matchPlugins(t){return[...this.plugins.keys()].filter(e=>e.match(t))}loadPlugin(t){if(!this.hasPlugin(t))throw Error(`Plugin ${t} not registered.`);return this.plugins.get(t)}maybeLoadPlugin(t){return this.hasPlugin(t)?this.plugins.get(t):null}async close(){return Promise.all([this.definitionLoader.getSrcCache().close(),this.definitionLoader.getCache().close(),this.stateEvaluator.getCache().close()]).then()}async generateWallet(){let t=await this.arweave.wallets.generate();return await this.testing.isArlocal()&&await this.testing.addFunds(t),{jwk:t,address:await this.arweave.wallets.jwkToAddress(t)}}isPluginType(t){return il.includes(t)||is.some(e=>t.match(e))}useKVStorageFactory(t){return this.kvStorageFactory=t,this}useGwUrl(t){return this._gwUrl=t,this}gwUrl(){return this._gwUrl}},iu={confirmationStatus:{notCorrupted:!0},source:"both"},ih="https://gw.warp.cc",ig="./cache/warp",id={inMemory:!1,dbLocation:ig},ip=class{static forLocal(t=1984,e=r1.default.init({host:"localhost",port:t,protocol:"http"}),r={...id,inMemory:!0}){return this.customArweaveGw(e,r,"local")}static forTestnet(t=id,e=!1,r=r1.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"testnet"):this.customWarpGw(r,iu,t,"testnet")}static forMainnet(t=id,e=!1,r=r1.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"mainnet"):this.customWarpGw(r,iu,t,"mainnet")}static custom(t,e,r){let n=new t$({...e,dbLocation:`${e.dbLocation}/state`}),i=new rJ(t),a=new rU(t,n,[new r4]);return ic.builder(t,n,r).setExecutorFactory(i).setStateEvaluator(a)}static customArweaveGw(t,e=id,r){return this.custom(t,e,r).useArweaveGateway().build()}static customWarpGw(t,e=iu,r=id,n){return this.custom(t,r,n).useWarpGateway(e,r).build()}};x(),x();var iy=m(tS());function iw(t,e,r){let n=t.find(({name:t})=>t===e);return n?n.value:r}var ib=class{constructor(t){this.env=t}arweaveWrapper;arweaveTransactions;logger=tC.INST.create(ib.name);async load(t,e){let r=tO.measure(),n=await this.fetchContractTx(t);this.logger.debug("Contract tx fetch time",r.elapsed());let i=n.owner.address,a=e||iw(n.tags,eb.CONTRACT_SRC_TX_ID),o=iw(n.tags,em.WARP_TESTNET)||null;if(o&&"testnet"!==this.env)throw Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!o&&"testnet"===this.env)throw Error("Trying to use non-testnet contract in a testnet env.");let s=iw(n.tags,eb.MIN_FEE),l=iw(n.tags,em.MANIFEST)?JSON.parse(iw(n.tags,em.MANIFEST)):null;this.logger.debug("Tags decoding",r.elapsed());let c=await this.evalInitialState(n);this.logger.debug("init state",c);let u=JSON.parse(c);this.logger.debug("Parsing src and init state",r.elapsed());let{src:h,srcBinary:f,srcWasmLang:g,contractType:d,metadata:p,srcTx:y}=await this.loadContractSource(a),w={txId:t,srcTxId:a,src:h,srcBinary:f,srcWasmLang:g,initState:u,minFee:s,owner:i,contractType:d,metadata:p,manifest:l,contractTx:await this.convertToWarpCompatibleContractTx(n),srcTx:await this.convertToWarpCompatibleContractTx(y),testnet:o};return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),w}async fetchContractTx(t){return await this.arweaveTransactions.transaction(t)??await this.arweaveTransactions.transactionUsingUploaderTag(t)}async convertToWarpCompatibleContractTx(t){return{tags:t.tags.map(({name:t,value:e})=>({name:s.Buffer.from(t).toString("base64url"),value:s.Buffer.from(e).toString("base64url")})),owner:t.owner.key,target:t.recipient,signature:t.signature,data:(await this.arweaveWrapper.txData(t.id)).toString("base64url")}}async loadContractSource(t){let e=tO.measure(),r=await this.fetchContractTx(t),n=iw(r.tags,eb.CONTENT_TYPE);if(!ep.includes(n))throw Error(`Contract source content type ${n} not supported`);let i="application/javascript"===n?"js":"wasm",a=await this.contractSource(r,i),o,s,l;if("wasm"==i){if(s=new rd(a),!(o=iw(r.tags,em.WASM_LANG)))throw Error(`Wasm lang not set for wasm contract src ${r.id}`);l=JSON.parse(iw(r.tags,em.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:"js"==i?a:null,srcBinary:"wasm"==i?s.wasmBinary():null,srcWasmLang:o,contractType:i,metadata:l,srcTx:r}}async contractSource(t,e){if(null!=iw(t.tags,em.UPLOADER_TX_ID)){let r=await this.arweaveWrapper.txDataString(t.id);if("wasm"===e)throw Error("WASM contracts in legacy format are not supported using AR GW");return iy.default.utils.b64UrlToString(JSON.parse(r).data)}return"js"===e?await this.arweaveWrapper.txDataString(t.id):await this.arweaveWrapper.txData(t.id)}async evalInitialState(t){if(iw(t.tags,em.INIT_STATE))return iw(t.tags,em.INIT_STATE);if(!iw(t.tags,em.INIT_STATE_TX))return this.arweaveWrapper.txDataString(t.id);{let e=iw(t.tags,em.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}}setCache(){throw Error("Method not implemented.")}setSrcCache(){throw Error("Method not implemented.")}getCache(){throw Error("Method not implemented.")}getSrcCache(){throw Error("Method not implemented.")}type(){return"arweave"}set warp(t){this.arweaveWrapper=new ek(t),this.arweaveTransactions=new rI(t)}};x();var im=class{constructor(t,e){this.arweave=t,this.environment=e,this.sorter=new rS(t)}logger=tC.INST.create(im.name);arweaveFetcher;arweaveWrapper;_warp;sorter;tagsParser=new eA;async load(t,e,r,n){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let i=this.sorter.extractBlockHeight(e)||0,a=this.sorter.extractBlockHeight(r)||await this.currentBlockHeight(),o={tags:[{name:eb.APP_NAME,values:["SmartWeaveAction"]},{name:eb.CONTRACT_TX_ID,values:[t]},{name:em.SEQUENCER,values:["RedStone"]}],blockFilter:{min:i,max:a+100},first:100},s=tO.measure(),l=await this.arweaveFetcher.transactions(o);n.internalWrites&&(l=await this.appendInternalWriteInteractions(t,i,a,l)),s.stop(),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:l.length,time:s.elapsed()}),l.forEach(t=>{t.node.sortKey=t.node.sortKey??t.node?.tags?.find(t=>t.name===em.SEQUENCER_SORT_KEY)?.value});let c=await this.sorter.sort(l),u="local"===this.environment||"testnet"===this.environment,h=this._warp.maybeLoadPlugin("vrf");return c.filter(t=>this.isNewerThenSortKeyBlockHeight(t)).filter(t=>this.isSortKeyInBounds(e,r,t)).map(t=>this.attachSequencerDataToInteraction(t)).map(t=>this.maybeAddMockVrf(u,t,h)).map((t,e,r)=>this.verifySortKeyIntegrity(t,e,r)).map(({node:t})=>t)}verifySortKeyIntegrity(t,e,r){if(0!==e){let n=r[e-1],i=r[e];if(this.logger.debug(`prev: ${n.node.id} | current: ${i.node.id}`),i.node.block.height<=1057409||i.node.lastSortKey?.split(",")[1]===rv)return t;"redstone-sequencer"===n.node.source&&n.node.sortKey!==i.node.lastSortKey&&this.logger.warn(`Interaction loading error: interaction ${i.node.id} lastSortKey is not pointing on prev interaction ${n.node.id}`)}return t}isSortKeyInBounds(t,e,r){return t&&e?r.node.sortKey.localeCompare(t)>0&&0>=r.node.sortKey.localeCompare(e):t&&!e?r.node.sortKey.localeCompare(t)>0:!!t||!e||0>=r.node.sortKey.localeCompare(e)}attachSequencerDataToInteraction(t){let e=e=>t.node.tags.find(t=>t.name===e)?.value,r=e(em.SEQUENCER_TX_ID),n=e(em.SEQUENCER_OWNER),i=e(em.SEQUENCER_BLOCK_ID),a=e(em.SEQUENCER_BLOCK_HEIGHT),o=e(em.SEQUENCER_PREV_SORT_KEY)||e(em.SEQUENCER_LAST_SORT_KEY),s=e(em.SEQUENCER_SORT_KEY),l=e(em.SEQUENCER_BLOCK_TIMESTAMP),c=ea(a);if(!n||!i||!a||!o&&c>1057409||!r||!s)throw Error(`Interaction ${t.node.id} is not sequenced by sequencer aborting. Only Sequenced transactions are supported by loader ${im.name}`);return{...t,node:{...t.node,owner:{address:n,key:null},block:{...t.node.block,height:ea(a),id:i,timestamp:l?ea(l):t.node.block.timestamp},sortKey:s,lastSortKey:o,id:r,source:"redstone-sequencer"}}}async appendInternalWriteInteractions(t,e,r,n){let i={tags:[{name:em.INTERACT_WRITE,values:[t]}],blockFilter:{min:e,max:r},first:100},a=await this.arweaveFetcher.transactions(i);return this.logger.debug("Inner writes interactions length:",a.length),n=n.concat(a)}maybeAddMockVrf(t,e,r){return t&&this.tagsParser.hasVrfTag(e.node)&&(r?e.node.vrf=r.process().generateMockVrf(e.node.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),e}isNewerThenSortKeyBlockHeight(t){if(t.node.sortKey){let e=Number.parseInt(t.node.sortKey.split(",")[0]);return Number(t.node.block.height)-e>=0}return!0}async currentBlockHeight(){return(await this.arweaveWrapper.info()).height}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveWrapper=new ek(t),this.arweaveFetcher=new rI(t),this._warp=t}};/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

run-parallel-limit/index.js:
  (*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

warp-arbundles/build/web/esm/bundle.js:
  (*! Bundled license information:
  
  ieee754/index.js:
    (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  
  buffer/index.js:
    (*!
     * The buffer module from node.js, for the browser.
     *
     * @author   Feross Aboukhadijeh <https://feross.org>
     * @license  MIT
     *)
  *)
*/}}]);